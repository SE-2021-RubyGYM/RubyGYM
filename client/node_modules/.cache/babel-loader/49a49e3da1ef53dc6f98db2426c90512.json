{"ast":null,"code":"import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\n/**\r\n * Virtual Scroll\r\n */\n\nvar VirtualScroll =\n/** @class */\nfunction () {\n  function VirtualScroll(parent) {\n    this.translateY = 0;\n    this.itemSize = 60;\n    this.bufferCount = 3;\n    this.renderedLength = 0;\n    this.averageRowHeight = 0;\n    this.isScrollHeightNull = true;\n    this.parent = parent;\n    this.addEventListener();\n  }\n\n  VirtualScroll.prototype.addEventListener = function () {\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.virtualScroll, this.virtualScrolling, this);\n  };\n\n  VirtualScroll.prototype.removeEventListener = function () {\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.virtualScroll, this.virtualScrolling);\n  };\n\n  VirtualScroll.prototype.getRenderedCount = function () {\n    this.setItemSize();\n    return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\n  };\n\n  VirtualScroll.prototype.setTranslateValue = function () {\n    var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n    this.renderVirtualTrackHeight(conWrap, resWrap);\n    this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n  };\n\n  VirtualScroll.prototype.renderVirtualTrackHeight = function (contentWrap, resourceWrap) {\n    this.parent.resourceBase.setExpandedResources();\n\n    if (this.isScrollHeightNull) {\n      var wrap = createElement('div', {\n        className: cls.VIRTUAL_TRACK_CLASS\n      });\n      var resWrap = [].slice.call(resourceWrap.querySelectorAll('table td'));\n      var startIndex_1 = parseInt(resWrap[0].getAttribute('data-group-index'), 10);\n      var endIndex_1 = parseInt(resWrap[resWrap.length - 1].getAttribute('data-group-index'), 10);\n      this.parent.resourceBase.renderedResources = this.parent.resourceBase.expandedResources.filter(function (resource) {\n        return resource.groupIndex >= startIndex_1 && resource.groupIndex <= endIndex_1;\n      });\n      this.setItemSize();\n      wrap.style.height = this.parent.resourceBase.expandedResources.length * this.itemSize + 'px';\n      this.isScrollHeightNull = false;\n      var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n\n      if (!isNullOrUndefined(virtual)) {\n        remove(virtual);\n      }\n\n      contentWrap.appendChild(wrap);\n    }\n  };\n\n  VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\n    var wrap = createElement('div', {\n      className: cls.VIRTUAL_TRACK_CLASS\n    });\n    wrap.style.height = this.parent.resourceBase.expandedResources.length * this.itemSize + 'px';\n    contentWrap.appendChild(wrap);\n  };\n\n  VirtualScroll.prototype.updateVirtualScrollHeight = function () {\n    var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n    var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n\n    if (lastRenderIndex !== lastResourceIndex) {\n      var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n      this.renderedLength = conTable.querySelector('tbody').children.length;\n      virtual.style.height = conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - this.renderedLength) * conTable.offsetHeight / this.renderedLength + 'px';\n    } else {\n      virtual.style.height = '';\n    }\n\n    this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\n  };\n\n  VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\n    var resourceCount = this.parent.resourceBase.renderedResources.length;\n\n    if (resourceCount !== this.getRenderedCount()) {\n      wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\n      var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n      var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n      var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n      this.translateY = 0;\n      this.setTranslate(resWrap, conWrap, eventWrap);\n    } else {\n      var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\n      var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n      var renderedResCount = resourceCount + (lastCollIndex - lastRenderIndex);\n      renderedResCount = renderedResCount > this.parent.resourceBase.expandedResources.length ? this.parent.resourceBase.expandedResources.length : renderedResCount;\n      wrap.style.height = renderedResCount * this.itemSize + 'px';\n    }\n  };\n\n  VirtualScroll.prototype.setItemSize = function () {\n    this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\n  };\n\n  VirtualScroll.prototype.renderEvents = function () {\n    this.setTabIndex();\n    this.parent.refreshEvents(false);\n    this.parent.notify(events.contentReady, {});\n    this.parent.hideSpinner();\n  };\n\n  VirtualScroll.prototype.virtualScrolling = function () {\n    var _this = this;\n\n    if (this.parent.quickPopup) {\n      this.parent.quickPopup.quickPopupHide();\n      this.parent.quickPopup.morePopup.hide();\n    }\n\n    var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n    var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n    this.renderedLength = resWrap.querySelector('tbody').children.length;\n    var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\n    var scrollHeight = this.parent.rowAutoHeight ? conTable.offsetHeight - conWrap.offsetHeight : this.bufferCount * this.itemSize;\n    addClass([conWrap], 'e-transition');\n    var resCollection = [];\n\n    if (conWrap.scrollTop - this.translateY < 0) {\n      resCollection = this.upScroll(conWrap, firstTDIndex);\n    } else if (conWrap.scrollTop - this.translateY > scrollHeight) {\n      resCollection = this.downScroll(conWrap, firstTDIndex);\n    }\n\n    if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\n      this.parent.showSpinner();\n      var selectedEle = this.parent.getSelectedElements();\n      this.focusedEle = selectedEle[selectedEle.length - 1] || this.focusedEle;\n      this.updateContent(resWrap, conWrap, eventWrap, resCollection);\n      this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n\n      if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\n        this.parent.dragAndDropModule.navigationWrapper();\n      }\n\n      window.clearTimeout(this.timeValue);\n      this.timeValue = window.setTimeout(function () {\n        _this.renderEvents();\n      }, 250);\n    }\n  };\n\n  VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\n    var index = 0;\n    index = ~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize) - this.renderedLength;\n\n    if (this.parent.rowAutoHeight) {\n      index = index > firstTDIndex ? firstTDIndex - this.bufferCount : index;\n    }\n\n    index = index > 0 ? index : 0;\n    var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\n    this.parent.resourceBase.renderedResources = prevSetCollection;\n\n    if (firstTDIndex === 0) {\n      this.translateY = conWrap.scrollTop;\n    } else {\n      var height = this.parent.rowAutoHeight ? this.averageRowHeight : this.itemSize;\n      height = height > 0 ? height : this.itemSize;\n      this.translateY = conWrap.scrollTop - this.bufferCount * height > 0 ? conWrap.scrollTop - this.bufferCount * height : 0;\n    }\n\n    return prevSetCollection;\n  };\n\n  VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\n    var lastResource = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n\n    if (lastResource === lastResourceIndex) {\n      return null;\n    }\n\n    var nextSetResIndex = 0;\n    nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\n\n    if (this.parent.rowAutoHeight) {\n      nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\n      nextSetResIndex = nextSetResIndex > firstTDIndex + this.bufferCount ? nextSetResIndex : firstTDIndex + this.bufferCount;\n    }\n\n    var lastIndex = nextSetResIndex + this.renderedLength;\n    lastIndex = lastIndex > this.parent.resourceBase.expandedResources.length ? nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\n    var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\n    this.translateY = conWrap.scrollTop;\n    return nextSetCollection;\n  };\n\n  VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\n    var renderedLength = resWrap.querySelector('tbody').children.length;\n\n    if (document.activeElement && document.activeElement.classList.contains(cls.RESOURCE_CELLS_CLASS)) {\n      this.isResourceCell = true;\n      this.parent.element.focus();\n    }\n\n    for (var i = 0; i < renderedLength; i++) {\n      remove(resWrap.querySelector('tbody tr'));\n      remove(conWrap.querySelector('tbody tr'));\n      remove(eventWrap.querySelector('div'));\n    }\n\n    this.parent.resourceBase.renderedResources = resCollection;\n    var resourceRows = this.parent.resourceBase.getContentRows(resCollection, true);\n    var contentRows = this.parent.activeView.getContentRows();\n    var eventRows = this.parent.activeView.getEventRows(resCollection.length);\n    append(resourceRows, resWrap.querySelector('tbody'));\n    append(contentRows, conWrap.querySelector('tbody'));\n    append(eventRows, eventWrap);\n  };\n\n  VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\n    return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\n  };\n\n  VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\n    setStyleAttribute(resWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(conWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(eventWrap, {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n\n    if (!isNullOrUndefined(timeIndicator)) {\n      setStyleAttribute(timeIndicator, {\n        transform: \"translateY(\" + this.translateY + \"px)\"\n      });\n    }\n  };\n\n  VirtualScroll.prototype.updateFocusedWorkCell = function () {\n    if (this.focusedEle) {\n      var date = parseInt(this.focusedEle.getAttribute('data-date'), 10);\n      var groupIndex = parseInt(this.focusedEle.getAttribute('data-group-index'), 10);\n      var ele = this.parent.element.querySelector(\".\" + cls.WORK_CELLS_CLASS + \"[data-date=\\\"\" + date + \"\\\"][data-group-index=\\\"\" + groupIndex + \"\\\"]\");\n\n      if (ele) {\n        this.parent.addSelectedClass([ele], ele, true);\n      }\n\n      this.focusedEle = null;\n    }\n  };\n\n  VirtualScroll.prototype.setTabIndex = function () {\n    var resColWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var resCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.RESOURCE_CELLS_CLASS));\n\n    if (resCells && resColWrap) {\n      resCells.forEach(function (element) {\n        if (element.getBoundingClientRect().top >= resColWrap.getBoundingClientRect().top) {\n          element.setAttribute('tabindex', '0');\n        }\n      });\n    }\n\n    var focusResCell = this.parent.element.querySelector(\".\" + cls.RESOURCE_CELLS_CLASS + \"[tabindex=\\\"\" + 0 + \"\\\"]\");\n\n    if (this.isResourceCell && focusResCell) {\n      focusResCell.focus();\n      this.isResourceCell = false;\n    }\n  };\n\n  VirtualScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return VirtualScroll;\n}();\n\nexport { VirtualScroll };","map":{"version":3,"sources":["D:/4_PROJECTS/RubyGYM/client/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/virtual-scroll.js"],"names":["append","addClass","remove","isNullOrUndefined","setStyleAttribute","createElement","events","cls","util","VirtualScroll","parent","translateY","itemSize","bufferCount","renderedLength","averageRowHeight","isScrollHeightNull","addEventListener","prototype","isDestroyed","on","virtualScroll","virtualScrolling","removeEventListener","off","getRenderedCount","setItemSize","Math","ceil","element","clientHeight","setTranslateValue","resWrap","querySelector","RESOURCE_COLUMN_WRAP_CLASS","conWrap","CONTENT_WRAP_CLASS","eventWrap","EVENT_TABLE_CLASS","timeIndicator","CURRENT_TIMELINE_CLASS","renderVirtualTrackHeight","setTranslate","contentWrap","resourceWrap","resourceBase","setExpandedResources","wrap","className","VIRTUAL_TRACK_CLASS","slice","call","querySelectorAll","startIndex_1","parseInt","getAttribute","endIndex_1","length","renderedResources","expandedResources","filter","resource","groupIndex","style","height","virtual","appendChild","renderVirtualTrack","updateVirtualScrollHeight","lastResourceIndex","lastRenderIndex","conTable","CONTENT_TABLE_CLASS","children","offsetHeight","updateVirtualTrackHeight","resourceCount","lastCollIndex","renderedResCount","getElementHeightFromClass","activeView","WORK_CELLS_CLASS","renderEvents","setTabIndex","refreshEvents","notify","contentReady","hideSpinner","_this","quickPopup","quickPopupHide","morePopup","hide","firstTDIndex","scrollHeight","rowAutoHeight","resCollection","scrollTop","upScroll","downScroll","showSpinner","selectedEle","getSelectedElements","focusedEle","updateContent","dragAndDropModule","actionObj","action","navigationWrapper","window","clearTimeout","timeValue","setTimeout","index","prevSetCollection","getBufferCollection","lastResource","nextSetResIndex","lastIndex","nextSetCollection","document","activeElement","classList","contains","RESOURCE_CELLS_CLASS","isResourceCell","focus","i","resourceRows","getContentRows","contentRows","eventRows","getEventRows","startIndex","endIndex","transform","updateFocusedWorkCell","date","ele","addSelectedClass","resColWrap","resCells","forEach","getBoundingClientRect","top","setAttribute","focusResCell","destroy"],"mappings":"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","sourcesContent":["import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\r\nimport * as events from '../base/constant';\r\nimport * as cls from '../base/css-constant';\r\nimport * as util from '../base/util';\r\n/**\r\n * Virtual Scroll\r\n */\r\nvar VirtualScroll = /** @class */ (function () {\r\n    function VirtualScroll(parent) {\r\n        this.translateY = 0;\r\n        this.itemSize = 60;\r\n        this.bufferCount = 3;\r\n        this.renderedLength = 0;\r\n        this.averageRowHeight = 0;\r\n        this.isScrollHeightNull = true;\r\n        this.parent = parent;\r\n        this.addEventListener();\r\n    }\r\n    VirtualScroll.prototype.addEventListener = function () {\r\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\r\n            return;\r\n        }\r\n        this.parent.on(events.virtualScroll, this.virtualScrolling, this);\r\n    };\r\n    VirtualScroll.prototype.removeEventListener = function () {\r\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\r\n            return;\r\n        }\r\n        this.parent.off(events.virtualScroll, this.virtualScrolling);\r\n    };\r\n    VirtualScroll.prototype.getRenderedCount = function () {\r\n        this.setItemSize();\r\n        return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\r\n    };\r\n    VirtualScroll.prototype.setTranslateValue = function () {\r\n        var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\r\n        var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\r\n        var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\r\n        var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\r\n        this.renderVirtualTrackHeight(conWrap, resWrap);\r\n        this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\r\n    };\r\n    VirtualScroll.prototype.renderVirtualTrackHeight = function (contentWrap, resourceWrap) {\r\n        this.parent.resourceBase.setExpandedResources();\r\n        if (this.isScrollHeightNull) {\r\n            var wrap = createElement('div', { className: cls.VIRTUAL_TRACK_CLASS });\r\n            var resWrap = [].slice.call((resourceWrap).querySelectorAll('table td'));\r\n            var startIndex_1 = parseInt(resWrap[0].getAttribute('data-group-index'), 10);\r\n            var endIndex_1 = parseInt(resWrap[resWrap.length - 1].getAttribute('data-group-index'), 10);\r\n            this.parent.resourceBase.renderedResources = this.parent.resourceBase.expandedResources.filter(function (resource) {\r\n                return (resource.groupIndex >= startIndex_1 && resource.groupIndex <= endIndex_1);\r\n            });\r\n            this.setItemSize();\r\n            wrap.style.height = (this.parent.resourceBase.expandedResources.length * this.itemSize) + 'px';\r\n            this.isScrollHeightNull = false;\r\n            var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\r\n            if (!isNullOrUndefined(virtual)) {\r\n                remove(virtual);\r\n            }\r\n            contentWrap.appendChild(wrap);\r\n        }\r\n    };\r\n    VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\r\n        var wrap = createElement('div', { className: cls.VIRTUAL_TRACK_CLASS });\r\n        wrap.style.height = (this.parent.resourceBase.expandedResources.length * this.itemSize) + 'px';\r\n        contentWrap.appendChild(wrap);\r\n    };\r\n    VirtualScroll.prototype.updateVirtualScrollHeight = function () {\r\n        var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\r\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\r\n        var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\r\n        if (lastRenderIndex !== lastResourceIndex) {\r\n            var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\r\n            this.renderedLength = conTable.querySelector('tbody').children.length;\r\n            virtual.style.height = (conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - (this.renderedLength)) *\r\n                conTable.offsetHeight / this.renderedLength) + 'px';\r\n        }\r\n        else {\r\n            virtual.style.height = '';\r\n        }\r\n        this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\r\n    };\r\n    VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\r\n        var resourceCount = this.parent.resourceBase.renderedResources.length;\r\n        if (resourceCount !== this.getRenderedCount()) {\r\n            wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\r\n            var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\r\n            var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\r\n            var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\r\n            this.translateY = 0;\r\n            this.setTranslate(resWrap, conWrap, eventWrap);\r\n        }\r\n        else {\r\n            var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\r\n            var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\r\n            var renderedResCount = resourceCount + (lastCollIndex - lastRenderIndex);\r\n            renderedResCount = (renderedResCount > this.parent.resourceBase.expandedResources.length) ?\r\n                this.parent.resourceBase.expandedResources.length : renderedResCount;\r\n            wrap.style.height = (renderedResCount * this.itemSize) + 'px';\r\n        }\r\n    };\r\n    VirtualScroll.prototype.setItemSize = function () {\r\n        this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\r\n    };\r\n    VirtualScroll.prototype.renderEvents = function () {\r\n        this.setTabIndex();\r\n        this.parent.refreshEvents(false);\r\n        this.parent.notify(events.contentReady, {});\r\n        this.parent.hideSpinner();\r\n    };\r\n    VirtualScroll.prototype.virtualScrolling = function () {\r\n        var _this = this;\r\n        if (this.parent.quickPopup) {\r\n            this.parent.quickPopup.quickPopupHide();\r\n            this.parent.quickPopup.morePopup.hide();\r\n        }\r\n        var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\r\n        var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\r\n        var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\r\n        var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\r\n        var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\r\n        this.renderedLength = resWrap.querySelector('tbody').children.length;\r\n        var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\r\n        var scrollHeight = this.parent.rowAutoHeight ?\r\n            (conTable.offsetHeight - conWrap.offsetHeight) : this.bufferCount * this.itemSize;\r\n        addClass([conWrap], 'e-transition');\r\n        var resCollection = [];\r\n        if ((conWrap.scrollTop) - this.translateY < 0) {\r\n            resCollection = this.upScroll(conWrap, firstTDIndex);\r\n        }\r\n        else if (conWrap.scrollTop - this.translateY > scrollHeight) {\r\n            resCollection = this.downScroll(conWrap, firstTDIndex);\r\n        }\r\n        if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\r\n            this.parent.showSpinner();\r\n            var selectedEle = this.parent.getSelectedElements();\r\n            this.focusedEle = selectedEle[selectedEle.length - 1] || this.focusedEle;\r\n            this.updateContent(resWrap, conWrap, eventWrap, resCollection);\r\n            this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\r\n            if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\r\n                this.parent.dragAndDropModule.navigationWrapper();\r\n            }\r\n            window.clearTimeout(this.timeValue);\r\n            this.timeValue = window.setTimeout(function () { _this.renderEvents(); }, 250);\r\n        }\r\n    };\r\n    VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\r\n        var index = 0;\r\n        index = (~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize)) - this.renderedLength;\r\n        if (this.parent.rowAutoHeight) {\r\n            index = (index > firstTDIndex) ? firstTDIndex - this.bufferCount : index;\r\n        }\r\n        index = (index > 0) ? index : 0;\r\n        var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\r\n        this.parent.resourceBase.renderedResources = prevSetCollection;\r\n        if (firstTDIndex === 0) {\r\n            this.translateY = conWrap.scrollTop;\r\n        }\r\n        else {\r\n            var height = (this.parent.rowAutoHeight) ? this.averageRowHeight : this.itemSize;\r\n            height = (height > 0) ? height : this.itemSize;\r\n            this.translateY = (conWrap.scrollTop - (this.bufferCount * height) > 0) ?\r\n                conWrap.scrollTop - (this.bufferCount * height) : 0;\r\n        }\r\n        return prevSetCollection;\r\n    };\r\n    VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\r\n        var lastResource = this.parent.resourceBase.\r\n            renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\r\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\r\n        if (lastResource === lastResourceIndex) {\r\n            return null;\r\n        }\r\n        var nextSetResIndex = 0;\r\n        nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\r\n        if (this.parent.rowAutoHeight) {\r\n            nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\r\n            nextSetResIndex = (nextSetResIndex > firstTDIndex + this.bufferCount) ? nextSetResIndex : firstTDIndex + this.bufferCount;\r\n        }\r\n        var lastIndex = nextSetResIndex + this.renderedLength;\r\n        lastIndex = (lastIndex > this.parent.resourceBase.expandedResources.length) ?\r\n            nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\r\n        var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\r\n        this.translateY = conWrap.scrollTop;\r\n        return nextSetCollection;\r\n    };\r\n    VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\r\n        var renderedLength = resWrap.querySelector('tbody').children.length;\r\n        if (document.activeElement && document.activeElement.classList.contains(cls.RESOURCE_CELLS_CLASS)) {\r\n            this.isResourceCell = true;\r\n            this.parent.element.focus();\r\n        }\r\n        for (var i = 0; i < renderedLength; i++) {\r\n            remove(resWrap.querySelector('tbody tr'));\r\n            remove(conWrap.querySelector('tbody tr'));\r\n            remove(eventWrap.querySelector('div'));\r\n        }\r\n        this.parent.resourceBase.renderedResources = resCollection;\r\n        var resourceRows = this.parent.resourceBase.getContentRows(resCollection, true);\r\n        var contentRows = this.parent.activeView.getContentRows();\r\n        var eventRows = this.parent.activeView.getEventRows(resCollection.length);\r\n        append(resourceRows, resWrap.querySelector('tbody'));\r\n        append(contentRows, conWrap.querySelector('tbody'));\r\n        append(eventRows, eventWrap);\r\n    };\r\n    VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\r\n        return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\r\n    };\r\n    VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\r\n        setStyleAttribute(resWrap.querySelector('table'), { transform: \"translateY(\" + this.translateY + \"px)\" });\r\n        setStyleAttribute(conWrap.querySelector('table'), { transform: \"translateY(\" + this.translateY + \"px)\" });\r\n        setStyleAttribute(eventWrap, { transform: \"translateY(\" + this.translateY + \"px)\" });\r\n        if (!isNullOrUndefined(timeIndicator)) {\r\n            setStyleAttribute(timeIndicator, { transform: \"translateY(\" + this.translateY + \"px)\" });\r\n        }\r\n    };\r\n    VirtualScroll.prototype.updateFocusedWorkCell = function () {\r\n        if (this.focusedEle) {\r\n            var date = parseInt(this.focusedEle.getAttribute('data-date'), 10);\r\n            var groupIndex = parseInt(this.focusedEle.getAttribute('data-group-index'), 10);\r\n            var ele = this.parent.element.querySelector(\".\" + cls.WORK_CELLS_CLASS + \"[data-date=\\\"\" + date + \"\\\"][data-group-index=\\\"\" + groupIndex + \"\\\"]\");\r\n            if (ele) {\r\n                this.parent.addSelectedClass([ele], ele, true);\r\n            }\r\n            this.focusedEle = null;\r\n        }\r\n    };\r\n    VirtualScroll.prototype.setTabIndex = function () {\r\n        var resColWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\r\n        var resCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.RESOURCE_CELLS_CLASS));\r\n        if (resCells && resColWrap) {\r\n            resCells.forEach(function (element) {\r\n                if (element.getBoundingClientRect().top >= resColWrap.getBoundingClientRect().top) {\r\n                    element.setAttribute('tabindex', '0');\r\n                }\r\n            });\r\n        }\r\n        var focusResCell = this.parent.element.querySelector(\".\" + cls.RESOURCE_CELLS_CLASS + \"[tabindex=\\\"\" + 0 + \"\\\"]\");\r\n        if (this.isResourceCell && focusResCell) {\r\n            focusResCell.focus();\r\n            this.isResourceCell = false;\r\n        }\r\n    };\r\n    VirtualScroll.prototype.destroy = function () {\r\n        this.removeEventListener();\r\n    };\r\n    return VirtualScroll;\r\n}());\r\nexport { VirtualScroll };\r\n"]},"metadata":{},"sourceType":"module"}