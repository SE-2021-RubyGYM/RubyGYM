{"ast":null,"code":"import { Worksheets } from './worksheets';\nimport { Worksheet, FreezePane, MergeCell, MergeCells, HyperLink, Grouping } from './worksheet';\nimport { CellStyle, Font, Borders, CellXfs, Alignment, NumFmt, CellStyleXfs, CellStyles } from './cell-style';\nimport { Column } from './column';\nimport { Row, Rows } from './row';\nimport { Image } from './image';\nimport { Cell, Cells } from './cell';\nimport { ZipArchive, ZipArchiveItem } from '@syncfusion/ej2-compression';\nimport { CsvHelper } from './csv-helper';\nimport { Internationalization, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { BlobHelper } from './blob-helper';\nimport { AutoFilters } from './auto-filters';\n/**\r\n * Workbook class\r\n */\n\nvar Workbook =\n/** @class */\nfunction () {\n  /* tslint:disable:no-any */\n  function Workbook(json, saveType, culture, currencyString, separator) {\n    this.sharedStringCount = 0;\n    this.unitsProportions = [96 / 75.0, 96 / 300.0, 96, 96 / 25.4, 96 / 2.54, 1, 96 / 72.0, 96 / 72.0 / 12700];\n    /* tslint:disable:no-any */\n\n    this.hyperlinkStyle = {\n      fontColor: '#0000FF',\n      underline: true\n    };\n\n    if (culture !== undefined) {\n      this.culture = culture;\n    } else {\n      this.culture = 'en-US';\n    }\n\n    if (currencyString !== undefined) {\n      this.currency = currencyString;\n    } else {\n      this.currency = 'USD';\n    }\n\n    this.intl = new Internationalization(this.culture);\n    this.mSaveType = saveType;\n\n    if (saveType === 'xlsx') {\n      this.mArchive = new ZipArchive();\n      this.sharedString = [];\n      this.mFonts = [];\n      this.mBorders = [];\n      this.mStyles = [];\n      this.printTitles = new Map();\n      this.cellStyles = new Map();\n      this.mNumFmt = new Map();\n      this.mFills = new Map();\n      this.mStyles.push(new CellStyle());\n      this.mFonts.push(new Font());\n      /* tslint:disable */\n\n      this.cellStyles.set('Normal', new CellStyles());\n      /* tslint:enable */\n\n      this.mCellXfs = [];\n      this.mCellStyleXfs = [];\n      this.drawingCount = 0;\n      this.imageCount = 0;\n\n      if (json.styles !== null && json.styles !== undefined) {\n        /* tslint:disable-next-line:no-any */\n        this.globalStyles = new Map();\n\n        for (var i = 0; i < json.styles.length; i++) {\n          if (json.styles[i].name !== undefined) {\n            if (!this.cellStyles.has(json.styles[i].name)) {\n              var cellStyle = new CellStyle();\n              cellStyle.isGlobalStyle = true;\n              this.parserCellStyle(json.styles[i], cellStyle, 'none');\n              var cellStylesIn = new CellStyles();\n              cellStylesIn.name = cellStyle.name;\n              cellStylesIn.xfId = cellStyle.index - 1;\n              this.cellStyles.set(cellStylesIn.name, cellStylesIn);\n              /* tslint:disable-next-line:no-any */\n\n              var tFormat = {};\n\n              if (json.styles[i].numberFormat !== undefined) {\n                tFormat.format = json.styles[i].numberFormat;\n              }\n\n              if (json.styles[i].type !== undefined) {\n                tFormat.type = json.styles[i].type;\n              } else {\n                tFormat.type = 'datetime';\n              }\n\n              if (tFormat.format !== undefined) {\n                this.globalStyles.set(json.styles[i].name, tFormat);\n              }\n            } else {\n              throw Error('Style name ' + json.styles[i].name + ' is already existed');\n            }\n          }\n        }\n      } // Parses Worksheets data to DOM.        \n\n\n      if (json.worksheets !== null && json.worksheets !== undefined) {\n        this.parserWorksheets(json.worksheets);\n      } else {\n        throw Error('Worksheet is expected.');\n      } // Parses the BuiltInProperties data to DOM.        \n\n\n      if (json.builtInProperties !== null && json.builtInProperties !== undefined) {\n        this.builtInProperties = new BuiltInProperties();\n        this.parserBuiltInProperties(json.builtInProperties, this.builtInProperties);\n      }\n    } else {\n      this.csvHelper = new CsvHelper(json, separator);\n    }\n  }\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserBuiltInProperties = function (jsonBuiltInProperties, builtInProperties) {\n    //Author\n    if (jsonBuiltInProperties.author !== null && jsonBuiltInProperties.author !== undefined) {\n      builtInProperties.author = jsonBuiltInProperties.author;\n    } //Comments\n\n\n    if (jsonBuiltInProperties.comments !== null && jsonBuiltInProperties.comments !== undefined) {\n      builtInProperties.comments = jsonBuiltInProperties.comments;\n    } //Category\n\n\n    if (jsonBuiltInProperties.category !== null && jsonBuiltInProperties.category !== undefined) {\n      builtInProperties.category = jsonBuiltInProperties.category;\n    } //Company\n\n\n    if (jsonBuiltInProperties.company !== null && jsonBuiltInProperties.company !== undefined) {\n      builtInProperties.company = jsonBuiltInProperties.company;\n    } //Manager\n\n\n    if (jsonBuiltInProperties.manager !== null && jsonBuiltInProperties.manager !== undefined) {\n      builtInProperties.manager = jsonBuiltInProperties.manager;\n    } //Subject\n\n\n    if (jsonBuiltInProperties.subject !== null && jsonBuiltInProperties.subject !== undefined) {\n      builtInProperties.subject = jsonBuiltInProperties.subject;\n    } //Title\n\n\n    if (jsonBuiltInProperties.title !== null && jsonBuiltInProperties.title !== undefined) {\n      builtInProperties.title = jsonBuiltInProperties.title;\n    } //Creation date\n\n\n    if (jsonBuiltInProperties.createdDate !== null && jsonBuiltInProperties.createdDate !== undefined) {\n      builtInProperties.createdDate = jsonBuiltInProperties.createdDate;\n    } //Modified date\n\n\n    if (jsonBuiltInProperties.modifiedDate !== null && jsonBuiltInProperties.modifiedDate !== undefined) {\n      builtInProperties.modifiedDate = jsonBuiltInProperties.modifiedDate;\n    } //Tags\n\n\n    if (jsonBuiltInProperties.tags !== null && jsonBuiltInProperties.tags !== undefined) {\n      builtInProperties.tags = jsonBuiltInProperties.tags;\n    } //Status\n\n\n    if (jsonBuiltInProperties.status !== null && jsonBuiltInProperties.status !== undefined) {\n      builtInProperties.status = jsonBuiltInProperties.status;\n    }\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserWorksheets = function (json) {\n    this.worksheets = new Worksheets();\n    var length = json.length;\n\n    for (var i = 0; i < length; i++) {\n      var jsonSheet = json[i];\n      var sheet = new Worksheet();\n      this.mergeCells = new MergeCells();\n      this.mergedCellsStyle = new Map();\n      this.mHyperLinks = []; //Name\n\n      if (jsonSheet.name !== null && jsonSheet.name !== undefined) {\n        sheet.name = jsonSheet.name;\n      } else {\n        sheet.name = 'Sheet' + (i + 1).toString();\n      }\n\n      if (jsonSheet.enableRtl !== null && jsonSheet.enableRtl !== undefined) {\n        sheet.enableRtl = jsonSheet.enableRtl;\n      }\n\n      sheet.index = i + 1; //Columns\n\n      if (jsonSheet.columns !== null && jsonSheet.columns !== undefined) {\n        this.parserColumns(jsonSheet.columns, sheet);\n      } //Rows\n\n\n      if (jsonSheet.rows !== null && jsonSheet.rows !== undefined) {\n        this.parserRows(jsonSheet.rows, sheet);\n      } //showGridLines\n\n\n      if (jsonSheet.showGridLines !== null && jsonSheet.showGridLines !== undefined) {\n        sheet.showGridLines = jsonSheet.showGridLines;\n      } //FreezePanes\n\n\n      if (jsonSheet.freeze !== null && jsonSheet.freeze !== undefined) {\n        this.parserFreezePanes(jsonSheet.freeze, sheet);\n      } //Print Title\n\n\n      if (jsonSheet.printTitle !== null && jsonSheet.printTitle !== undefined) {\n        this.parserPrintTitle(jsonSheet.printTitle, sheet);\n      }\n\n      if (jsonSheet.pageSetup !== undefined) {\n        if (jsonSheet.pageSetup.isSummaryRowBelow !== undefined) {\n          sheet.isSummaryRowBelow = jsonSheet.pageSetup.isSummaryRowBelow;\n        }\n      }\n\n      if (jsonSheet.images !== undefined) {\n        this.parserImages(jsonSheet.images, sheet);\n      }\n\n      if (jsonSheet.autoFilters !== null && jsonSheet.autoFilters !== undefined) {\n        this.parseFilters(jsonSheet.autoFilters, sheet);\n      }\n\n      sheet.index = i + 1;\n      sheet.mergeCells = this.mergeCells;\n      sheet.hyperLinks = this.mHyperLinks;\n      this.worksheets.push(sheet);\n    }\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.mergeOptions = function (fromJson, toJson) {\n    /* tslint:disable:no-any */\n    var result = {};\n    this.applyProperties(fromJson, result);\n    this.applyProperties(toJson, result);\n    return result;\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.applyProperties = function (sourceJson, destJson) {\n    var keys = Object.keys(sourceJson);\n\n    for (var index = 0; index < keys.length; index++) {\n      if (keys[index] !== 'name') {\n        destJson[keys[index]] = sourceJson[keys[index]];\n      }\n    }\n  };\n\n  Workbook.prototype.getCellName = function (row, column) {\n    return this.getColumnName(column) + row.toString();\n  };\n\n  Workbook.prototype.getColumnName = function (col) {\n    col--;\n    var strColumnName = '';\n\n    do {\n      var iCurrentDigit = col % 26;\n      col = col / 26 - 1;\n      strColumnName = String.fromCharCode(65 + iCurrentDigit) + strColumnName;\n    } while (col >= 0);\n\n    return strColumnName;\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserPrintTitle = function (json, sheet) {\n    var printTitleName = '';\n    var titleRowName;\n\n    if (json.fromRow !== null && json.fromRow !== undefined) {\n      var fromRow = json.fromRow;\n      var toRow = void 0;\n\n      if (json.toRow !== null && json.toRow !== undefined) {\n        toRow = json.toRow;\n      } else {\n        toRow = json.fromRow;\n      }\n\n      titleRowName = '$' + fromRow + ':$' + toRow;\n    }\n\n    var titleColName;\n\n    if (json.fromColumn !== null && json.fromColumn !== undefined) {\n      var fromColumn = json.fromColumn;\n      var toColumn = void 0;\n\n      if (json.toColumn !== null && json.toColumn !== undefined) {\n        toColumn = json.toColumn;\n      } else {\n        toColumn = json.fromColumn;\n      }\n\n      titleColName = '$' + this.getColumnName(fromColumn) + ':$' + this.getColumnName(toColumn);\n    }\n\n    if (titleRowName !== undefined) {\n      printTitleName += sheet.name + '!' + titleRowName;\n    }\n\n    if (titleColName !== undefined && titleRowName !== undefined) {\n      printTitleName += ',' + (sheet.name + '!' + titleColName);\n    } else if (titleColName !== undefined) {\n      printTitleName += sheet.name + '!' + titleColName;\n    }\n\n    if (printTitleName !== '') {\n      this.printTitles.set(sheet.index - 1, printTitleName);\n    }\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserFreezePanes = function (json, sheet) {\n    sheet.freezePanes = new FreezePane();\n\n    if (json.row !== null && json.row !== undefined) {\n      sheet.freezePanes.row = json.row;\n    } else {\n      sheet.freezePanes.row = 0;\n    }\n\n    if (json.column !== null && json.column !== undefined) {\n      sheet.freezePanes.column = json.column;\n    } else {\n      sheet.freezePanes.column = 0;\n    }\n\n    sheet.freezePanes.leftCell = this.getCellName(sheet.freezePanes.row + 1, sheet.freezePanes.column + 1);\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserColumns = function (json, sheet) {\n    var columnsLength = json.length;\n    sheet.columns = [];\n\n    for (var column = 0; column < columnsLength; column++) {\n      var col = new Column();\n\n      if (json[column].index !== null && json[column].index !== undefined) {\n        col.index = json[column].index;\n      } else {\n        throw Error('Column index is missing.');\n      }\n\n      if (json[column].width !== null && json[column].width !== undefined) {\n        col.width = json[column].width;\n      }\n\n      sheet.columns.push(col);\n    }\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserRows = function (json, sheet) {\n    var rowsLength = json.length;\n    sheet.rows = new Rows();\n    var rowId = 0;\n\n    for (var r = 0; r < rowsLength; r++) {\n      var row = this.parserRow(json[r], rowId);\n      rowId = row.index;\n      sheet.rows.add(row);\n    }\n\n    this.insertMergedCellsStyle(sheet);\n  };\n\n  Workbook.prototype.insertMergedCellsStyle = function (sheet) {\n    var _this = this;\n\n    if (this.mergeCells.length > 0) {\n      this.mergedCellsStyle.forEach(function (value, key) {\n        var row = sheet.rows.filter(function (item) {\n          return item.index === value.y;\n        })[0];\n\n        if (!isNullOrUndefined(row)) {\n          var cell = row.cells.filter(function (item) {\n            return item.index === value.x;\n          })[0];\n\n          if (!isNullOrUndefined(cell)) {\n            cell.styleIndex = value.styleIndex;\n          } else {\n            var cells = row.cells.filter(function (item) {\n              return item.index <= value.x;\n            });\n            var insertIndex = 0;\n\n            if (cells.length > 0) {\n              insertIndex = row.cells.indexOf(cells[cells.length - 1]) + 1;\n            }\n\n            row.cells.splice(insertIndex, 0, _this.createCell(value, key));\n          }\n        } else {\n          var rows = sheet.rows.filter(function (item) {\n            return item.index <= value.y;\n          });\n          var rowToInsert = new Row();\n          rowToInsert.index = value.y;\n          rowToInsert.cells = new Cells();\n          rowToInsert.cells.add(_this.createCell(value, key));\n          var insertIndex = 0;\n\n          if (rows.length > 0) {\n            insertIndex = sheet.rows.indexOf(rows[rows.length - 1]) + 1;\n          }\n\n          sheet.rows.splice(insertIndex, 0, rowToInsert);\n        }\n      });\n    }\n  };\n\n  Workbook.prototype.createCell = function (value, key) {\n    var cellToInsert = new Cell();\n    cellToInsert.refName = key;\n    cellToInsert.index = value.x;\n    cellToInsert.cellStyle = new CellStyle();\n    cellToInsert.styleIndex = value.styleIndex;\n    return cellToInsert;\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserRow = function (json, rowIndex) {\n    var row = new Row(); //Row Height\n\n    if (json.height !== null && json.height !== undefined) {\n      row.height = json.height;\n    } //Row index\n\n\n    if (json.index !== null && json.index !== undefined) {\n      row.index = json.index;\n    } else {\n      throw Error('Row index is missing.');\n    }\n\n    if (json.grouping !== null && json.grouping !== undefined) {\n      this.parseGrouping(json.grouping, row);\n    }\n\n    this.parseCells(json.cells, row);\n    return row;\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parseGrouping = function (json, row) {\n    row.grouping = new Grouping();\n\n    if (json.outlineLevel !== undefined) {\n      row.grouping.outlineLevel = json.outlineLevel;\n    }\n\n    if (json.isCollapsed !== undefined) {\n      row.grouping.isCollapsed = json.isCollapsed;\n    }\n\n    if (json.isHidden !== undefined) {\n      row.grouping.isHidden = json.isHidden;\n    }\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parseCells = function (json, row) {\n    row.cells = new Cells();\n    var cellsLength = json !== undefined ? json.length : 0;\n    var spanMin = 1;\n    var spanMax = 1;\n    var curCellIndex = 0;\n\n    for (var cellId = 0; cellId < cellsLength; cellId++) {\n      /* tslint:disable:no-any */\n      var jsonCell = json[cellId];\n      var cell = new Cell(); //cell index\n\n      if (jsonCell.index !== null && jsonCell.index !== undefined) {\n        cell.index = jsonCell.index;\n      } else {\n        throw Error('Cell index is missing.');\n      }\n\n      if (cell.index < spanMin) {\n        spanMin = cell.index;\n      } else if (cell.index > spanMax) {\n        spanMax = cell.index;\n      } //Update the Cell name\n\n\n      cell.refName = this.getCellName(row.index, cell.index); //Row span\n\n      if (jsonCell.rowSpan !== null && jsonCell.rowSpan !== undefined) {\n        cell.rowSpan = jsonCell.rowSpan - 1;\n      } else {\n        cell.rowSpan = 0;\n      } //Column span\n\n\n      if (jsonCell.colSpan !== null && jsonCell.colSpan !== undefined) {\n        cell.colSpan = jsonCell.colSpan - 1;\n      } else {\n        cell.colSpan = 0;\n      } //Hyperlink\n\n\n      if (jsonCell.hyperlink !== null && jsonCell.hyperlink !== undefined) {\n        var hyperLink = new HyperLink();\n\n        if (jsonCell.hyperlink.target !== undefined) {\n          hyperLink.target = jsonCell.hyperlink.target;\n\n          if (jsonCell.hyperlink.displayText !== undefined) {\n            cell.value = jsonCell.hyperlink.displayText;\n          } else {\n            cell.value = jsonCell.hyperlink.target;\n          }\n\n          cell.type = this.getCellValueType(cell.value);\n          hyperLink.ref = cell.refName;\n          hyperLink.rId = this.mHyperLinks.length + 1;\n          this.mHyperLinks.push(hyperLink);\n          cell.cellStyle = new CellStyle();\n          /* tslint:disable-next-line:max-line-length */\n\n          this.parserCellStyle(jsonCell.style !== undefined ? this.mergeOptions(jsonCell.style, this.hyperlinkStyle) : this.hyperlinkStyle, cell.cellStyle, 'string');\n          cell.styleIndex = cell.cellStyle.index;\n        }\n      } // formulas\n\n\n      if (jsonCell.formula !== null && jsonCell.formula !== undefined) {\n        cell.formula = jsonCell.formula;\n        cell.type = 'formula';\n      } //Cell value\n\n\n      if (jsonCell.value !== null && jsonCell.value !== undefined) {\n        if (cell.formula !== undefined) {\n          cell.value = 0;\n        } else {\n          cell.value = jsonCell.value;\n          cell.type = this.getCellValueType(cell.value);\n        }\n      }\n\n      if (jsonCell.style !== null && jsonCell.style !== undefined && cell.styleIndex === undefined) {\n        cell.cellStyle = new CellStyle();\n\n        if (cell.value instanceof Date) {\n          this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type, 14);\n        } else {\n          this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type);\n        }\n\n        cell.styleIndex = cell.cellStyle.index;\n      } else if (cell.value instanceof Date) {\n        cell.cellStyle = new CellStyle();\n        this.parserCellStyle({}, cell.cellStyle, cell.type, 14);\n        cell.styleIndex = cell.cellStyle.index;\n      }\n\n      this.parseCellType(cell);\n      this.mergeCells = this.processMergeCells(cell, row.index, this.mergeCells);\n      row.cells.add(cell);\n      curCellIndex = cell.index + 1;\n    }\n\n    row.spans = spanMin + ':' + spanMax;\n  };\n\n  Workbook.prototype.GetColors = function () {\n    var colors;\n    colors = new Map();\n    /* tslint:disable */\n\n    colors.set('WHITE', 'FFFFFFFF');\n    /* tslint:disable */\n\n    colors.set('SILVER', 'FFC0C0C0');\n    /* tslint:disable */\n\n    colors.set('GRAY', 'FF808080');\n    /* tslint:disable */\n\n    colors.set('BLACK', 'FF000000');\n    /* tslint:disable */\n\n    colors.set('RED', 'FFFF0000');\n    /* tslint:disable */\n\n    colors.set('MAROON', 'FF800000');\n    /* tslint:disable */\n\n    colors.set('YELLOW', 'FFFFFF00');\n    /* tslint:disable */\n\n    colors.set('OLIVE', 'FF808000');\n    /* tslint:disable */\n\n    colors.set('LIME', 'FF00FF00');\n    /* tslint:disable */\n\n    colors.set('GREEN', 'FF008000');\n    /* tslint:disable */\n\n    colors.set('AQUA', 'FF00FFFF');\n    /* tslint:disable */\n\n    colors.set('TEAL', 'FF008080');\n    /* tslint:disable */\n\n    colors.set('BLUE', 'FF0000FF');\n    /* tslint:disable */\n\n    colors.set('NAVY', 'FF000080');\n    /* tslint:disable */\n\n    colors.set('FUCHSIA', 'FFFF00FF');\n    /* tslint:disable */\n\n    colors.set('PURPLE', 'FF800080');\n    return colors;\n  };\n\n  Workbook.prototype.processColor = function (colorVal) {\n    if (colorVal.indexOf('#') === 0) {\n      return colorVal.replace('#', 'FF');\n    }\n\n    colorVal = colorVal.toUpperCase();\n    this.rgbColors = this.GetColors();\n\n    if (this.rgbColors.has(colorVal)) {\n      colorVal = this.rgbColors.get(colorVal);\n    } else {\n      colorVal = 'FF000000';\n    }\n\n    return colorVal;\n  };\n\n  Workbook.prototype.processCellValue = function (value, cell) {\n    var cellValue = value;\n\n    if (value.indexOf(\"<font\") !== -1 || value.indexOf(\"<a\") !== -1 || value.indexOf(\"<b>\") !== -1 || value.indexOf(\"<i>\") !== -1 || value.indexOf(\"<u>\") !== -1) {\n      var processedVal = '';\n      var startindex = value.indexOf('<', 0);\n      var endIndex = value.indexOf('>', startindex + 1);\n\n      if (startindex >= 0 && endIndex >= 0) {\n        if (startindex !== 0) {\n          processedVal += '<r><t xml:space=\"preserve\">' + this.processString(value.substring(0, startindex)) + '</t></r>';\n        }\n\n        while (startindex >= 0 && endIndex >= 0) {\n          endIndex = value.indexOf('>', startindex + 1);\n\n          if (endIndex >= 0) {\n            var subString = value.substring(startindex + 1, endIndex);\n            startindex = value.indexOf('<', endIndex + 1);\n\n            if (startindex < 0) {\n              startindex = cellValue.length;\n            }\n\n            var text = cellValue.substring(endIndex + 1, startindex);\n\n            if (text.length !== 0) {\n              var subSplit = subString.split(' ');\n\n              if (subSplit.length > 0) {\n                processedVal += '<r><rPr>';\n              }\n\n              if (subSplit.length > 1) {\n                for (var _i = 0, subSplit_1 = subSplit; _i < subSplit_1.length; _i++) {\n                  var element = subSplit_1[_i];\n                  var start = element.trim().substring(0, 5);\n\n                  switch (start) {\n                    case 'size=':\n                      processedVal += '<sz val=\"' + element.substring(6, element.length - 1) + '\"/>';\n                      break;\n\n                    case 'face=':\n                      processedVal += '<rFont val=\"' + element.substring(6, element.length - 1) + '\"/>';\n                      break;\n\n                    case 'color':\n                      processedVal += '<color rgb=\"' + this.processColor(element.substring(7, element.length - 1)) + '\"/>';\n                      break;\n\n                    case 'href=':\n                      var hyperLink = new HyperLink();\n                      hyperLink.target = element.substring(6, element.length - 1).trim();\n                      hyperLink.ref = cell.refName;\n                      hyperLink.rId = this.mHyperLinks.length + 1;\n                      this.mHyperLinks.push(hyperLink);\n                      processedVal += '<color rgb=\"FF0000FF\"/><u/><b/>';\n                      break;\n                  }\n                }\n              } else if (subSplit.length === 1) {\n                var style = subSplit[0].trim();\n\n                switch (style) {\n                  case 'b':\n                    processedVal += '<b/>';\n                    break;\n\n                  case 'i':\n                    processedVal += '<i/>';\n                    break;\n\n                  case 'u':\n                    processedVal += '<u/>';\n                    break;\n                }\n              }\n\n              processedVal += '</rPr><t xml:space=\"preserve\">' + this.processString(text) + '</t></r>';\n            }\n          }\n        }\n\n        if (processedVal === '') {\n          return cellValue;\n        }\n\n        return processedVal;\n      } else {\n        return cellValue;\n      }\n    } else {\n      return cellValue;\n    }\n  };\n\n  Workbook.prototype.applyGlobalStyle = function (json, cellStyle) {\n    var index = 0;\n\n    if (this.cellStyles.has(json.name)) {\n      cellStyle.index = this.mStyles.filter(function (a) {\n        return a.name === json.name;\n      })[0].index;\n      cellStyle.name = json.name;\n    }\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserCellStyle = function (json, cellStyle, cellType, defStyleIndex) {\n    //name\n    if (json.name !== null && json.name !== undefined) {\n      if (cellStyle.isGlobalStyle) {\n        cellStyle.name = json.name;\n      } else {\n        this.applyGlobalStyle(json, cellStyle);\n        return;\n      }\n    } //background color\n\n\n    if (json.backColor !== null && json.backColor !== undefined) {\n      cellStyle.backColor = json.backColor;\n    } //borders\n    //leftBorder\n\n\n    cellStyle.borders = new Borders(); //AllBorder\n\n    if (json.borders !== null && json.borders !== undefined) {\n      this.parserBorder(json.borders, cellStyle.borders.all);\n    } //leftborder\n\n\n    if (json.leftBorder !== null && json.leftBorder !== undefined) {\n      this.parserBorder(json.leftBorder, cellStyle.borders.left);\n    } //rightBorder\n\n\n    if (json.rightBorder !== null && json.rightBorder !== undefined) {\n      this.parserBorder(json.rightBorder, cellStyle.borders.right);\n    } //topBorder\n\n\n    if (json.topBorder !== null && json.topBorder !== undefined) {\n      this.parserBorder(json.topBorder, cellStyle.borders.top);\n    } //bottomBorder\n\n\n    if (json.bottomBorder !== null && json.bottomBorder !== undefined) {\n      this.parserBorder(json.bottomBorder, cellStyle.borders.bottom);\n    } //fontName\n\n\n    if (json.fontName !== null && json.fontName !== undefined) {\n      cellStyle.fontName = json.fontName;\n    } //fontSize\n\n\n    if (json.fontSize !== null && json.fontSize !== undefined) {\n      cellStyle.fontSize = json.fontSize;\n    } //fontColor\n\n\n    if (json.fontColor !== null && json.fontColor !== undefined) {\n      cellStyle.fontColor = json.fontColor;\n    } //italic\n\n\n    if (json.italic !== null && json.italic !== undefined) {\n      cellStyle.italic = json.italic;\n    } //bold\n\n\n    if (json.bold !== null && json.bold !== undefined) {\n      cellStyle.bold = json.bold;\n    } //hAlign\n\n\n    if (json.hAlign !== null && json.hAlign !== undefined) {\n      cellStyle.hAlign = json.hAlign.toLowerCase();\n    } //indent\n\n\n    if (json.indent !== null && json.indent !== undefined) {\n      cellStyle.indent = json.indent;\n\n      if (!(cellStyle.hAlign === 'left' || cellStyle.hAlign === 'right')) {\n        cellStyle.hAlign = 'left';\n      }\n    }\n\n    if (json.rotation !== null && json.rotation !== undefined) {\n      cellStyle.rotation = json.rotation;\n    } //vAlign\n\n\n    if (json.vAlign !== null && json.vAlign !== undefined) {\n      cellStyle.vAlign = json.vAlign.toLowerCase();\n    } //underline\n\n\n    if (json.underline !== null && json.underline !== undefined) {\n      cellStyle.underline = json.underline;\n    } //wrapText\n\n\n    if (json.wrapText !== null && json.wrapText !== undefined) {\n      cellStyle.wrapText = json.wrapText;\n    } //numberFormat\n\n\n    if (json.numberFormat !== null && json.numberFormat !== undefined) {\n      if (json.type !== null && json.type !== undefined) {\n        cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, json.type);\n      } else {\n        cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, cellType);\n      }\n    } else if (defStyleIndex !== undefined) {\n      cellStyle.numFmtId = 14;\n      cellStyle.numberFormat = 'GENERAL';\n    } else {\n      cellStyle.numberFormat = 'GENERAL';\n    }\n\n    cellStyle.index = this.processCellStyle(cellStyle);\n  };\n\n  Workbook.prototype.switchNumberFormat = function (numberFormat, type) {\n    var format = this.getNumberFormat(numberFormat, type);\n\n    if (format !== numberFormat) {\n      var numFmt = this.mNumFmt.get(numberFormat);\n\n      if (numFmt !== undefined) {\n        numFmt.formatCode = format;\n\n        if (this.mNumFmt.has(format)) {\n          for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\n            var cellStyleXfs = _a[_i];\n\n            if (cellStyleXfs.numFmtId === numFmt.numFmtId) {\n              cellStyleXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\n            }\n          }\n\n          for (var _b = 0, _c = this.mCellXfs; _b < _c.length; _b++) {\n            var cellXfs = _c[_b];\n\n            if (cellXfs.numFmtId === numFmt.numFmtId) {\n              cellXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\n            }\n          }\n        }\n      }\n    }\n  };\n\n  Workbook.prototype.getNumberFormat = function (numberFormat, type) {\n    var returnFormat;\n\n    switch (type) {\n      case 'number':\n        try {\n          returnFormat = this.intl.getNumberPattern({\n            format: numberFormat,\n            currency: this.currency,\n            useGrouping: true\n          }, true);\n        } catch (error) {\n          returnFormat = numberFormat;\n        }\n\n        break;\n\n      case 'datetime':\n        try {\n          returnFormat = this.intl.getDatePattern({\n            skeleton: numberFormat,\n            type: 'dateTime'\n          }, true);\n        } catch (error) {\n          try {\n            returnFormat = this.intl.getDatePattern({\n              format: numberFormat,\n              type: 'dateTime'\n            }, true);\n          } catch (error) {\n            returnFormat = numberFormat;\n          }\n        }\n\n        break;\n\n      case 'date':\n        try {\n          returnFormat = this.intl.getDatePattern({\n            skeleton: numberFormat,\n            type: 'date'\n          }, true);\n        } catch (error) {\n          try {\n            returnFormat = this.intl.getDatePattern({\n              format: numberFormat,\n              type: 'date'\n            }, true);\n          } catch (error) {\n            returnFormat = numberFormat;\n          }\n        }\n\n        break;\n\n      case 'time':\n        try {\n          returnFormat = this.intl.getDatePattern({\n            skeleton: numberFormat,\n            type: 'time'\n          }, true);\n        } catch (error) {\n          try {\n            returnFormat = this.intl.getDatePattern({\n              format: numberFormat,\n              type: 'time'\n            }, true);\n          } catch (error) {\n            returnFormat = numberFormat;\n          }\n        }\n\n        break;\n\n      default:\n        returnFormat = numberFormat;\n        break;\n    }\n\n    return returnFormat;\n  };\n  /* tslint:disable:no-any */\n\n\n  Workbook.prototype.parserBorder = function (json, border) {\n    if (json.color !== null && json.color !== undefined) {\n      border.color = json.color;\n    } else {\n      border.color = '#000000';\n    }\n\n    if (json.lineStyle !== null && json.lineStyle !== undefined) {\n      border.lineStyle = json.lineStyle;\n    } else {\n      border.lineStyle = 'thin';\n    }\n  };\n\n  Workbook.prototype.processCellStyle = function (style) {\n    if (style.isGlobalStyle) {\n      this.processNumFormatId(style);\n      this.mStyles.push(style);\n      return this.mStyles.length;\n    } else {\n      var compareResult = this.compareStyle(style);\n\n      if (!compareResult.result) {\n        this.processNumFormatId(style);\n        this.mStyles.push(style);\n        return this.mStyles.length;\n      } else {\n        //Return the index of the already existing style.\n        return compareResult.index;\n      }\n    }\n  };\n\n  Workbook.prototype.processNumFormatId = function (style) {\n    if (style.numberFormat !== 'GENERAL' && !this.mNumFmt.has(style.numberFormat)) {\n      var id = this.mNumFmt.size + 164;\n      this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\n    }\n  };\n\n  Workbook.prototype.isNewFont = function (toCompareStyle) {\n    var result = false;\n    var index = 0;\n\n    for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\n      var font = _a[_i];\n      index++;\n      var fontColor = undefined;\n\n      if (toCompareStyle.fontColor !== undefined) {\n        fontColor = 'FF' + toCompareStyle.fontColor.replace('#', '');\n      }\n\n      result = font.color === fontColor && font.b === toCompareStyle.bold && font.i === toCompareStyle.italic && font.u === toCompareStyle.underline && font.name === toCompareStyle.fontName && font.sz === toCompareStyle.fontSize;\n\n      if (result) {\n        break;\n      }\n    }\n\n    index = index - 1;\n    return {\n      index: index,\n      result: result\n    };\n  };\n\n  Workbook.prototype.isNewBorder = function (toCompareStyle) {\n    var bStyle = new CellStyle();\n\n    if (this.isAllBorder(toCompareStyle.borders)) {\n      return bStyle.borders.all.color === toCompareStyle.borders.all.color && bStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle;\n    } else {\n      return bStyle.borders.left.color === toCompareStyle.borders.left.color && bStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle && bStyle.borders.right.color === toCompareStyle.borders.right.color && bStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle && bStyle.borders.top.color === toCompareStyle.borders.top.color && bStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle && bStyle.borders.bottom.color === toCompareStyle.borders.bottom.color && bStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle;\n    }\n  };\n\n  Workbook.prototype.isAllBorder = function (toCompareBorder) {\n    var allBorderStyle = new CellStyle();\n    return allBorderStyle.borders.all.color !== toCompareBorder.all.color && allBorderStyle.borders.all.lineStyle !== toCompareBorder.all.lineStyle;\n  };\n\n  Workbook.prototype.compareStyle = function (toCompareStyle) {\n    var result = true;\n    var index = 0;\n    var globalStyleIndex = 0;\n\n    for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\n      var baseStyle = _a[_i];\n      result = baseStyle.isGlobalStyle ? false : baseStyle.backColor === toCompareStyle.backColor && baseStyle.bold === toCompareStyle.bold && baseStyle.numFmtId === toCompareStyle.numFmtId && baseStyle.numberFormat === toCompareStyle.numberFormat && baseStyle.type === toCompareStyle.type && baseStyle.fontColor === toCompareStyle.fontColor && baseStyle.fontName === toCompareStyle.fontName && baseStyle.fontSize === toCompareStyle.fontSize && baseStyle.hAlign === toCompareStyle.hAlign && baseStyle.italic === toCompareStyle.italic && baseStyle.underline === toCompareStyle.underline && baseStyle.vAlign === toCompareStyle.vAlign && baseStyle.indent === toCompareStyle.indent && baseStyle.rotation === toCompareStyle.rotation && baseStyle.wrapText === toCompareStyle.wrapText && baseStyle.borders.all.color === toCompareStyle.borders.all.color && baseStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle && baseStyle.borders.left.color === toCompareStyle.borders.left.color && baseStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle && baseStyle.borders.right.color === toCompareStyle.borders.right.color && baseStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle && baseStyle.borders.top.color === toCompareStyle.borders.top.color && baseStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle && baseStyle.borders.bottom.color === toCompareStyle.borders.bottom.color && baseStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle;\n\n      if (result) {\n        index = baseStyle.index;\n        break;\n      }\n    }\n\n    return {\n      index: index,\n      result: result\n    };\n  };\n\n  Workbook.prototype.contains = function (array, item) {\n    var index = array.indexOf(item);\n    return index > -1 && index < array.length;\n  };\n\n  Workbook.prototype.getCellValueType = function (value) {\n    if (value instanceof Date) {\n      return 'datetime';\n    } else if (typeof value === 'boolean') {\n      return 'boolean';\n    } else if (typeof value === 'number') {\n      return 'number';\n    } else {\n      return 'string';\n    }\n  };\n\n  Workbook.prototype.parseCellType = function (cell) {\n    var type = cell.type;\n    var saveType;\n    var value = cell.value;\n\n    switch (type) {\n      case 'datetime':\n        value = this.toOADate(value);\n\n        if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\n          if (this.globalStyles.has(cell.cellStyle.name)) {\n            var value_1 = this.globalStyles.get(cell.cellStyle.name);\n            this.switchNumberFormat(value_1.format, value_1.type);\n          }\n        }\n\n        saveType = 'n';\n        break;\n      //TODO: Update the number format index and style\n\n      case 'boolean':\n        value = value ? 1 : 0;\n        saveType = 'b';\n        break;\n\n      case 'number':\n        saveType = 'n';\n\n        if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\n          if (this.globalStyles.has(cell.cellStyle.name)) {\n            this.switchNumberFormat(this.globalStyles.get(cell.cellStyle.name).format, 'number');\n          }\n        }\n\n        break;\n\n      case 'string':\n        this.sharedStringCount++;\n        saveType = 's';\n        var sstvalue = this.processCellValue(value, cell);\n\n        if (!this.contains(this.sharedString, sstvalue)) {\n          this.sharedString.push(sstvalue);\n        }\n\n        value = this.sharedString.indexOf(sstvalue);\n        break;\n\n      default:\n        break;\n    }\n\n    cell.saveType = saveType;\n    cell.value = value;\n  };\n\n  Workbook.prototype.parserImages = function (json, sheet) {\n    var imagesLength = json.length;\n    sheet.images = [];\n    var imageId = 0;\n\n    for (var p = 0; p < imagesLength; p++) {\n      var image = this.parserImage(json[p]);\n      sheet.images.push(image);\n    }\n  };\n\n  Workbook.prototype.parseFilters = function (json, sheet) {\n    sheet.autoFilters = new AutoFilters();\n    if (json.row !== null && json.row !== undefined) sheet.autoFilters.row = json.row;else throw new Error('Argument Null Exception: row null or empty');\n    if (json.lastRow !== null && json.lastRow !== undefined) sheet.autoFilters.lastRow = json.lastRow;else throw new Error('Argument Null Exception: lastRow cannot be null or empty');\n    if (json.column !== null && json.column !== undefined) sheet.autoFilters.column = json.column;else throw new Error('Argument Null Exception: column cannot be null or empty');\n    if (json.lastColumn !== null && json.row !== undefined) sheet.autoFilters.lastColumn = json.lastColumn;else throw new Error('Argument Null Exception: lastColumn cannot be null or empty');\n  };\n\n  Workbook.prototype.parserImage = function (json) {\n    var image = new Image();\n\n    if (json.image !== null && json.image !== undefined) {\n      image.image = json.image;\n    }\n\n    if (json.row !== null && json.row !== undefined) {\n      image.row = json.row;\n    }\n\n    if (json.column !== null && json.column !== undefined) {\n      image.column = json.column;\n    }\n\n    if (json.lastRow !== null && json.lastRow !== undefined) {\n      image.lastRow = json.lastRow;\n    }\n\n    if (json.lastColumn !== null && json.lastColumn !== undefined) {\n      image.lastColumn = json.lastColumn;\n    }\n\n    if (json.width !== null && json.width !== undefined) {\n      image.width = json.width;\n    }\n\n    if (json.height !== null && json.height !== undefined) {\n      image.height = json.height;\n    }\n\n    if (json.horizontalFlip !== null && json.horizontalFlip !== undefined) {\n      image.horizontalFlip = json.horizontalFlip;\n    }\n\n    if (json.verticalFlip !== null && json.verticalFlip !== undefined) {\n      image.verticalFlip = json.verticalFlip;\n    }\n\n    if (json.rotation !== null && json.rotation !== undefined) {\n      image.rotation = json.rotation;\n    }\n\n    return image;\n  };\n\n  Workbook.prototype.saveAsBlob = function (blobSaveType) {\n    var _this = this;\n\n    switch (blobSaveType) {\n      case 'text/csv':\n        return new Promise(function (resolve, reject) {\n          var obj = {};\n          obj.blobData = _this.csvHelper.saveAsBlob();\n          resolve(obj);\n        });\n\n      default:\n        return new Promise(function (resolve, reject) {\n          _this.saveInternal();\n\n          _this.mArchive.saveAsBlob().then(function (blob) {\n            var obj = {};\n            obj.blobData = new Blob([blob], {\n              type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n            });\n            resolve(obj);\n          });\n        });\n    }\n  };\n\n  Workbook.prototype.save = function (fileName, proxyUrl) {\n    var _this = this;\n\n    if (fileName === null || fileName === undefined || fileName === '') {\n      throw new Error('Argument Null Exception: fileName cannot be null or empty');\n    }\n\n    var xlsxMatch = fileName.match('.xlsx$');\n    var csvMatch = fileName.match('.csv$');\n\n    if (xlsxMatch !== null && xlsxMatch[0] === '.' + this.mSaveType) {\n      this.saveInternal();\n      this.mArchive.save(fileName).then(function () {\n        _this.mArchive.destroy();\n      });\n    } else if (csvMatch !== null && csvMatch[0] === '.' + this.mSaveType) {\n      this.csvHelper.save(fileName);\n    } else {\n      throw Error('Save type and file extension is different.');\n    }\n  };\n\n  Workbook.prototype.saveInternal = function () {\n    this.saveWorkbook();\n    this.saveWorksheets();\n    this.saveSharedString();\n    this.saveStyles();\n    this.saveApp(this.builtInProperties);\n    this.saveCore(this.builtInProperties);\n    this.saveContentType();\n    this.saveTopLevelRelation();\n    this.saveWorkbookRelation();\n  };\n\n  Workbook.prototype.saveWorkbook = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var workbookTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><workbook xmlns:r = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns= \"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><workbookPr codeName=\"ThisWorkbook\" defaultThemeVersion= \"153222\"/><bookViews><workbookView activeTab=\"0\"/></bookViews>';\n    var sheets = '<sheets>';\n    var length = this.worksheets.length;\n\n    for (var i = 0; i < length; i++) {\n      /* tslint:disable-next-line:max-line-length */\n      var sheetName = this.worksheets[i].name;\n      sheetName = sheetName.replace(\"&\", \"&amp;\");\n      sheetName = sheetName.replace(\"<\", \"&lt;\");\n      sheetName = sheetName.replace(\">\", \"&gt;\");\n      sheetName = sheetName.replace(\"\\\"\", \"&quot;\");\n      sheets += '<sheet name=\"' + sheetName + '\" sheetId=\"' + (i + 1).toString() + '\" r:id =\"rId' + (i + 1).toString() + '\" />';\n    }\n\n    sheets += '</sheets>';\n    workbookTemp += sheets;\n\n    if (this.printTitles.size > 0) {\n      var printTitle_1 = '<definedNames>';\n      this.printTitles.forEach(function (value, key) {\n        printTitle_1 += '<definedName name=\"_xlnm.Print_Titles\" localSheetId=\"' + key + '\">' + value + '</definedName>';\n      });\n      printTitle_1 += '</definedNames>';\n      workbookTemp += printTitle_1;\n    }\n\n    this.addToArchive(workbookTemp + '</workbook>', 'xl/workbook.xml');\n  };\n\n  Workbook.prototype.saveWorksheets = function () {\n    var length = this.worksheets.length;\n\n    for (var i = 0; i < length; i++) {\n      this.saveWorksheet(this.worksheets[i], i);\n    }\n  };\n\n  Workbook.prototype.saveWorksheet = function (sheet, index) {\n    var sheetBlob = new BlobHelper();\n    /* tslint:disable-next-line:max-line-length */\n\n    var sheetString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><worksheet xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns:x14=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n\n    if (!sheet.isSummaryRowBelow) {\n      sheetString += '<sheetPr>' + '<outlinePr ' + 'summaryBelow=\"0\" >' + '</outlinePr>' + '</sheetPr>';\n    } else {\n      sheetString += '<sheetPr />';\n    }\n\n    sheetString += this.saveSheetView(sheet);\n\n    if (sheet.columns !== undefined) {\n      var colString = '<cols>';\n\n      for (var _i = 0, _a = sheet.columns; _i < _a.length; _i++) {\n        var column = _a[_i];\n        /* tslint:disable-next-line:max-line-length */\n\n        if (column.width !== undefined) {\n          colString += '<col min=\"' + column.index + '\" max=\"' + column.index + '\" width=\"' + this.pixelsToColumnWidth(column.width) + '\" customWidth=\"1\" />';\n        } else {\n          colString += '<col min=\"' + column.index + '\" max=\"' + column.index + '\" width=\"' + '8.43' + '\" customWidth=\"1\" />';\n        }\n      }\n\n      sheetString += colString + '</cols>';\n    }\n\n    sheetString += '<sheetData>';\n    sheetBlob.append(sheetString);\n    sheetString = '';\n\n    if (sheet.rows !== undefined) {\n      for (var _b = 0, _c = sheet.rows; _b < _c.length; _b++) {\n        var row = _c[_b];\n        var rowString = '<row r=\"' + row.index + '\" ';\n\n        if (!isNullOrUndefined(row.spans)) {\n          rowString += 'spans=\"' + row.spans + '\" ';\n        }\n\n        if (row.height !== undefined) {\n          rowString += 'ht=\"' + this.pixelsToRowHeight(row.height) + '\" customHeight=\"1\" ';\n        }\n\n        if (row.grouping !== undefined) {\n          if (row.grouping.isHidden) {\n            rowString += 'hidden=\"1\" ';\n          }\n\n          if (row.grouping.outlineLevel !== undefined) {\n            rowString += 'outlineLevel=\"' + row.grouping.outlineLevel + '\" ';\n          }\n\n          if (row.grouping.isCollapsed) {\n            rowString += 'collapsed=\"1\" ';\n          }\n        }\n\n        rowString += '>';\n\n        for (var _d = 0, _e = row.cells; _d < _e.length; _d++) {\n          var cell = _e[_d];\n\n          if (cell !== undefined && (cell.value !== undefined || cell.cellStyle !== undefined)) {\n            rowString += '<c r=\"' + cell.refName + '\" ';\n\n            if (cell.saveType !== undefined) {\n              rowString += 't=\"' + cell.saveType + '\" ';\n            }\n\n            if (cell.styleIndex !== undefined) {\n              rowString += 's=\"' + cell.styleIndex + '\" ';\n            }\n\n            rowString += ' >';\n\n            if (cell.formula !== undefined) {\n              rowString += '<f>' + cell.formula + '</f>';\n            }\n\n            if (cell.value !== undefined) {\n              rowString += '<v>' + cell.value + '</v></c>';\n            } else {\n              rowString += '</c>';\n            }\n          }\n        }\n\n        rowString += '</row>';\n        sheetBlob.append(rowString);\n      }\n    }\n\n    sheetString += '</sheetData>';\n    /* tslint:disable-next-line:max-line-length */\n\n    if (sheet.autoFilters !== null && sheet.autoFilters !== undefined) sheetString += '<autoFilter ref=\"' + this.getCellName(sheet.autoFilters.row, sheet.autoFilters.column) + ':' + this.getCellName(sheet.autoFilters.lastRow, sheet.autoFilters.lastColumn) + '\"/>';\n\n    if (sheet.mergeCells.length > 0) {\n      sheetString += '<mergeCells count=\"' + sheet.mergeCells.length + '\">';\n\n      for (var _f = 0, _g = sheet.mergeCells; _f < _g.length; _f++) {\n        var mCell = _g[_f];\n        sheetString += '<mergeCell ref=\"' + mCell.ref + '\" />';\n      }\n\n      sheetString += '</mergeCells>';\n    }\n\n    if (sheet.hyperLinks.length > 0) {\n      sheetString += '<hyperlinks>';\n\n      for (var _h = 0, _j = sheet.hyperLinks; _h < _j.length; _h++) {\n        var hLink = _j[_h];\n        sheetString += '<hyperlink ref=\"' + hLink.ref + '\" r:id=\"rId' + hLink.rId + '\" />';\n      }\n\n      sheetString += '</hyperlinks>';\n    }\n    /* tslint:disable-next-line:max-line-length */\n\n\n    sheetString += '<pageMargins left=\"0.75\" right=\"0.75\" top=\"1\" bottom=\"1\" header=\"0.5\" footer=\"0.5\" /><headerFooter scaleWithDoc=\"1\" alignWithMargins=\"0\" differentFirst=\"0\" differentOddEven=\"0\" />';\n\n    if (sheet.images != undefined && sheet.images.length > 0) {\n      this.drawingCount++;\n      this.saveDrawings(sheet, sheet.index);\n      sheetString += '<drawing r:id=\"rId' + (sheet.hyperLinks.length + 1) + '\"/>';\n    }\n\n    this.addToArchive(this.saveSheetRelations(sheet), 'xl/worksheets/_rels/sheet' + sheet.index + '.xml.rels');\n    sheetBlob.append(sheetString + '</worksheet>');\n    this.addToArchive(sheetBlob.getBlob(), 'xl/worksheets' + '/sheet' + (index + 1) + '.xml');\n  };\n\n  Workbook.prototype.saveDrawings = function (sheet, index) {\n    var drawings = new BlobHelper();\n    /* tslint:disable-next-line:max-line-length */\n\n    var sheetDrawingString = '<xdr:wsDr xmlns:xdr=\"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing\" xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">';\n\n    if (sheet.images !== undefined) {\n      var imgId = 0;\n\n      for (var _i = 0, _a = sheet.images; _i < _a.length; _i++) {\n        var pic = _a[_i];\n\n        if (pic.height !== undefined && pic.width !== undefined) {\n          this.updatelastRowOffset(sheet, pic);\n          this.updatelastColumnOffSet(sheet, pic);\n        } else if (pic.lastRow !== undefined && pic.lastColumn !== undefined) {\n          pic.lastRowOffset = 0;\n          pic.lastColOffset = 0;\n        }\n\n        imgId++;\n        sheetDrawingString += '<xdr:twoCellAnchor editAs=\"oneCell\">';\n        sheetDrawingString += '<xdr:from><xdr:col>'; //col\n\n        sheetDrawingString += pic.column - 1;\n        sheetDrawingString += '</xdr:col><xdr:colOff>'; //colOff\n\n        sheetDrawingString += 0;\n        sheetDrawingString += '</xdr:colOff><xdr:row>'; //row\n\n        sheetDrawingString += pic.row - 1;\n        sheetDrawingString += '</xdr:row><xdr:rowOff>'; //rowOff\n\n        sheetDrawingString += 0;\n        sheetDrawingString += '</xdr:rowOff></xdr:from>';\n        sheetDrawingString += '<xdr:to><xdr:col>'; //col\n\n        sheetDrawingString += pic.lastColumn;\n        sheetDrawingString += '</xdr:col><xdr:colOff>'; //colOff\n\n        sheetDrawingString += pic.lastColOffset;\n        sheetDrawingString += '</xdr:colOff><xdr:row>'; //row\n\n        sheetDrawingString += pic.lastRow;\n        sheetDrawingString += '</xdr:row><xdr:rowOff>'; //rowOff\n\n        sheetDrawingString += pic.lastRowOffset;\n        sheetDrawingString += '</xdr:rowOff></xdr:to>';\n        sheetDrawingString += '<xdr:pic>';\n        sheetDrawingString += '<xdr:nvPicPr>';\n        sheetDrawingString += '<xdr:cNvPr id=\"' + imgId + '\" name=\"Picture ' + imgId + '\"> </xdr:cNvPr>';\n        sheetDrawingString += '<xdr:cNvPicPr><a:picLocks noChangeAspect=\"1\"/></xdr:cNvPicPr> </xdr:nvPicPr>';\n        sheetDrawingString += '<xdr:blipFill>';\n        /* tslint:disable-next-line:max-line-length */\n\n        sheetDrawingString += '<a:blip xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" r:embed=\"rId' + imgId + '\" cstate=\"print\">';\n        sheetDrawingString += '</a:blip><a:stretch><a:fillRect /></a:stretch></xdr:blipFill>';\n        sheetDrawingString += '<xdr:spPr>';\n        sheetDrawingString += '<a:xfrm';\n\n        if (pic.rotation != undefined && pic.rotation <= 3600 && pic.rotation >= -3600) {\n          sheetDrawingString += ' rot=\"' + pic.rotation * 60000 + '\"';\n        }\n\n        if (pic.verticalFlip != undefined && pic.verticalFlip != false) {\n          sheetDrawingString += ' flipV=\"1\"';\n        }\n\n        if (pic.horizontalFlip != undefined && pic.horizontalFlip != false) {\n          sheetDrawingString += ' flipH=\"1\"';\n        }\n\n        sheetDrawingString += '/>';\n        sheetDrawingString += '<a:prstGeom prst=\"rect\"><a:avLst /></a:prstGeom></xdr:spPr>';\n        sheetDrawingString += '</xdr:pic><xdr:clientData /></xdr:twoCellAnchor>';\n        var imageFile = new BlobHelper();\n        var imageData = this.convertBase64toImage(pic.image);\n        this.imageCount += 1;\n        this.addToArchive(imageData, 'xl/media/image' + this.imageCount + '.png');\n      }\n\n      drawings.append(sheetDrawingString);\n      drawings.append('</xdr:wsDr>');\n      this.saveDrawingRelations(sheet);\n      this.addToArchive(drawings.getBlob(), 'xl/drawings/drawing' + this.drawingCount + '.xml');\n    }\n  };\n\n  Workbook.prototype.updatelastRowOffset = function (sheet, picture) {\n    var iCurHeight = picture.height;\n    var iCurRow = picture.row;\n    var iCurOffset = 0;\n\n    while (iCurHeight >= 0) {\n      var iRowHeight = 0;\n      if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined) iRowHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);else iRowHeight = this.convertToPixels(15);\n      var iSpaceInCell = iRowHeight - iCurOffset * iRowHeight / 256;\n\n      if (iSpaceInCell > iCurHeight) {\n        picture.lastRow = iCurRow;\n        picture.lastRowOffset = iCurOffset + iCurHeight * 256 / iRowHeight;\n        var rowHiddenHeight = 0;\n        if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined) rowHiddenHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);else rowHiddenHeight = this.convertToPixels(15);\n        picture.lastRowOffset = rowHiddenHeight * picture.lastRowOffset / 256;\n        picture.lastRowOffset = Math.round(picture.lastRowOffset / this.unitsProportions[7]);\n        break;\n      } else {\n        iCurHeight -= iSpaceInCell;\n        iCurRow++;\n        iCurOffset = 0;\n      }\n    }\n  };\n\n  Workbook.prototype.updatelastColumnOffSet = function (sheet, picture) {\n    var iCurWidth = picture.width;\n    var iCurCol = picture.column;\n    var iCurOffset = 0;\n\n    while (iCurWidth >= 0) {\n      var iColWidth = 0;\n      if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined) iColWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol - 1].width);else iColWidth = this.ColumnWidthToPixels(8.43);\n      var iSpaceInCell = iColWidth - iCurOffset * iColWidth / 1024;\n\n      if (iSpaceInCell > iCurWidth) {\n        picture.lastColumn = iCurCol;\n        picture.lastColOffset = iCurOffset + iCurWidth * 1024 / iColWidth;\n        var colHiddenWidth = 0;\n        if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined) colHiddenWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol].width);else colHiddenWidth = this.ColumnWidthToPixels(8.43);\n        picture.lastColOffset = colHiddenWidth * picture.lastColOffset / 1024;\n        picture.lastColOffset = Math.round(picture.lastColOffset / this.unitsProportions[7]);\n        break;\n      } else {\n        iCurWidth -= iSpaceInCell;\n        iCurCol++;\n        iCurOffset = 0;\n      }\n    }\n  };\n\n  Workbook.prototype.convertToPixels = function (value) {\n    return value * this.unitsProportions[6];\n  };\n\n  Workbook.prototype.convertBase64toImage = function (img) {\n    var byteStr = window.atob(img);\n    var buffer = new ArrayBuffer(byteStr.length);\n    var data = new Uint8Array(buffer);\n\n    for (var i = 0; i < byteStr.length; i++) {\n      data[i] = byteStr.charCodeAt(i);\n    }\n\n    var blob = new Blob([data], {\n      type: 'image/png'\n    });\n    return blob;\n  };\n\n  Workbook.prototype.saveDrawingRelations = function (sheet) {\n    /* tslint:disable-next-line:max-line-length */\n    var drawingRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n    var length = sheet.images.length;\n    var id = this.imageCount - sheet.images.length;\n\n    for (var i = 1; i <= length; i++) {\n      id++;\n      /* tslint:disable-next-line:max-line-length */\n\n      drawingRelation += '<Relationship Id=\"rId' + i + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"../media/image' + id + '.png\" />';\n    }\n\n    this.addToArchive(drawingRelation + '</Relationships>', 'xl/drawings/_rels/drawing' + this.drawingCount + '.xml.rels');\n  };\n\n  Workbook.prototype.pixelsToColumnWidth = function (pixels) {\n    var dDigitWidth = 7;\n    var val = pixels > dDigitWidth + 5 ? this.trunc((pixels - 5) / dDigitWidth * 100 + 0.5) / 100 : pixels / (dDigitWidth + 5);\n    return val > 1 ? (val * dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0 : val * (dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0;\n  };\n\n  Workbook.prototype.ColumnWidthToPixels = function (val) {\n    var dDigitWidth = 7;\n    var fileWidth = val > 1 ? (val * dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0 : val * (dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0;\n    return this.trunc((256 * fileWidth + this.trunc(128 / dDigitWidth)) / 256 * dDigitWidth);\n  };\n\n  Workbook.prototype.trunc = function (x) {\n    var n = x - x % 1;\n    return n === 0 && (x < 0 || x === 0 && 1 / x !== 1 / 0) ? -0 : n;\n  };\n\n  Workbook.prototype.pixelsToRowHeight = function (pixels) {\n    return pixels * this.unitsProportions[5] / this.unitsProportions[6];\n  };\n\n  Workbook.prototype.saveSheetRelations = function (sheet) {\n    /* tslint:disable-next-line:max-line-length */\n    var relStr = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n\n    for (var _i = 0, _a = sheet.hyperLinks; _i < _a.length; _i++) {\n      var hLink = _a[_i];\n      /* tslint:disable-next-line:max-line-length */\n\n      relStr += '<Relationship Id=\"rId' + hLink.rId + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink\" Target=\"' + this.processString(hLink.target) + '\" TargetMode=\"External\" />';\n    }\n\n    if (sheet.images != undefined && sheet.images.length > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      relStr += '<Relationship Id=\"rId' + (sheet.hyperLinks.length + 1) + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing\" Target=\"../drawings/drawing' + this.drawingCount + '.xml\" />';\n    }\n\n    relStr += '</Relationships>';\n    return relStr;\n  };\n\n  Workbook.prototype.saveSheetView = function (sheet) {\n    var paneString = '<sheetViews><sheetView workbookViewId=\"0\" ';\n\n    if (sheet.enableRtl === true) {\n      paneString += 'rightToLeft=\"1\"';\n    }\n\n    if (sheet.showGridLines === false) {\n      paneString += 'showGridLines=\"0\" >';\n    } else {\n      paneString += '>';\n    }\n\n    if (sheet.freezePanes !== undefined) {\n      paneString += '<pane state=\"frozen\"' + ' topLeftCell=\"' + sheet.freezePanes.leftCell + '\" ';\n\n      if (sheet.freezePanes.row !== 0) {\n        paneString += 'ySplit=\"' + sheet.freezePanes.row + '\" ';\n      }\n\n      if (sheet.freezePanes.column !== 0) {\n        paneString += 'xSplit=\"' + sheet.freezePanes.column + '\" ';\n      }\n\n      paneString += '/>';\n    }\n\n    paneString += '</sheetView></sheetViews > ';\n    return paneString;\n  };\n\n  Workbook.prototype.saveSharedString = function () {\n    var length = this.sharedString.length;\n\n    if (length > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      var sstStart = '<?xml version=\"1.0\" encoding=\"utf-8\"?><sst uniqueCount=\"' + length + '\" count=\"' + this.sharedStringCount + '\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n      var si = '';\n\n      for (var i = 0; i < length; i++) {\n        if (this.sharedString[i].indexOf('<r>') !== 0) {\n          si += '<si><t>';\n          si += this.processString(this.sharedString[i]);\n          si += '</t></si>';\n        } else {\n          si += '<si>';\n          si += this.sharedString[i];\n          si += '</si>';\n        }\n      }\n\n      si += '</sst>';\n      this.addToArchive(sstStart + si, 'xl/sharedStrings.xml');\n    }\n  };\n\n  Workbook.prototype.processString = function (value) {\n    if (value.indexOf('&') !== -1) {\n      value = value.replace(/&/g, '&amp;');\n    }\n\n    if (value.indexOf('<') !== -1) {\n      value = value.replace(/</g, '&lt;');\n    }\n\n    if (value.indexOf('>') !== -1) {\n      value = value.replace(/>/g, '&gt;');\n    }\n\n    return value;\n  };\n\n  Workbook.prototype.saveStyles = function () {\n    this.updateCellXfsStyleXfs();\n    /* tslint:disable-next-line:max-line-length */\n\n    var styleTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><styleSheet xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" mc:Ignorable=\"x14ac\" xmlns:x14ac=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n    styleTemp += this.saveNumberFormats();\n    styleTemp += this.saveFonts();\n    styleTemp += this.saveFills();\n    styleTemp += this.saveBorders();\n    styleTemp += this.saveCellStyleXfs();\n    styleTemp += this.saveCellXfs();\n    styleTemp += this.saveCellStyles();\n    this.addToArchive(styleTemp + '</styleSheet>', 'xl/styles.xml');\n  };\n\n  Workbook.prototype.updateCellXfsStyleXfs = function () {\n    for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\n      var style = _a[_i];\n      var cellXfs = undefined;\n\n      if (style.isGlobalStyle) {\n        cellXfs = new CellStyleXfs();\n        cellXfs.xfId = style.index - 1;\n      } else {\n        cellXfs = new CellXfs();\n        cellXfs.xfId = 0;\n      } //Add font\n\n\n      var compareFontResult = this.isNewFont(style);\n\n      if (!compareFontResult.result) {\n        var font = new Font();\n        font.b = style.bold;\n        font.i = style.italic;\n        font.name = style.fontName;\n        font.sz = style.fontSize;\n        font.u = style.underline;\n        font.color = 'FF' + style.fontColor.replace('#', '');\n        this.mFonts.push(font);\n        cellXfs.fontId = this.mFonts.length - 1;\n      } else {\n        cellXfs.fontId = compareFontResult.index;\n      } //Add fill\n\n\n      if (style.backColor !== 'none') {\n        var backColor = 'FF' + style.backColor.replace('#', '');\n\n        if (this.mFills.has(backColor)) {\n          var fillId = this.mFills.get(backColor);\n          cellXfs.fillId = fillId;\n        } else {\n          var fillId = this.mFills.size + 2;\n          this.mFills.set(backColor, fillId);\n          cellXfs.fillId = fillId;\n        }\n      } else {\n        cellXfs.fillId = 0;\n      } //Add border            \n\n\n      if (!this.isNewBorder(style)) {\n        this.mBorders.push(style.borders);\n        cellXfs.borderId = this.mBorders.length;\n      } else {\n        cellXfs.borderId = 0;\n      } //Add Number Format            \n\n\n      if (style.numberFormat !== 'GENERAL') {\n        if (this.mNumFmt.has(style.numberFormat)) {\n          var numFmt = this.mNumFmt.get(style.numberFormat);\n          cellXfs.numFmtId = numFmt.numFmtId;\n        } else {\n          var id = this.mNumFmt.size + 164;\n          this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\n          cellXfs.numFmtId = id;\n        }\n      } else {\n        if (style.numberFormat === 'GENERAL' && style.numFmtId === 14) {\n          cellXfs.numFmtId = 14;\n        } else {\n          cellXfs.numFmtId = 0;\n        }\n      } //Add alignment            \n\n\n      if (!style.isGlobalStyle) {\n        cellXfs.applyAlignment = 1;\n      }\n\n      cellXfs.alignment = new Alignment();\n      cellXfs.alignment.indent = style.indent;\n      cellXfs.alignment.horizontal = style.hAlign;\n      cellXfs.alignment.vertical = style.vAlign;\n      cellXfs.alignment.wrapText = style.wrapText ? 1 : 0;\n      cellXfs.alignment.rotation = style.rotation;\n\n      if (style.isGlobalStyle) {\n        this.mCellStyleXfs.push(cellXfs);\n        this.mCellXfs.push(cellXfs);\n      } else {\n        //Add cellxfs\n        this.mCellXfs.push(cellXfs);\n      }\n    }\n  };\n\n  Workbook.prototype.saveNumberFormats = function () {\n    if (this.mNumFmt.size >= 1) {\n      var numFmtStyle_1 = '<numFmts count=\"' + this.mNumFmt.size + '\">';\n      this.mNumFmt.forEach(function (value, key) {\n        numFmtStyle_1 += '<numFmt numFmtId=\"' + value.numFmtId + '\" formatCode=\"' + value.formatCode.replace(/\"/g, '&quot;') + '\" />';\n      });\n      return numFmtStyle_1 += '</numFmts>';\n    } else {\n      return '';\n    }\n  };\n\n  Workbook.prototype.saveFonts = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var fontStyle = '<fonts count=\"' + this.mFonts.length + '\">';\n\n    if (this.mFonts.length >= 1) {\n      for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\n        var font = _a[_i];\n        fontStyle += '<font>';\n\n        if (font.b) {\n          fontStyle += '<b />';\n        }\n\n        if (font.i) {\n          fontStyle += '<i />';\n        }\n\n        if (font.u) {\n          fontStyle += '<u />';\n        }\n\n        fontStyle += '<sz val=\"' + font.sz + '\" />';\n        fontStyle += '<color rgb=\"' + font.color + '\" />';\n        fontStyle += '<name val=\"' + font.name + '\" /></font>';\n      }\n    }\n\n    return fontStyle + '</fonts>';\n  };\n\n  Workbook.prototype.saveFills = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var fillsStyle = '<fills count=\"' + (this.mFills.size + 2) + '\"><fill><patternFill patternType=\"none\"></patternFill></fill><fill><patternFill patternType=\"gray125\"></patternFill></fill>';\n\n    if (this.mFills.size >= 1) {\n      this.mFills.forEach(function (value, key) {\n        /* tslint:disable-next-line:max-line-length */\n        fillsStyle += '<fill><patternFill patternType=\"solid\"><fgColor rgb=\"' + key + '\" /><bgColor rgb=\"FFFFFFFF\" /></patternFill></fill>';\n      });\n    }\n\n    return fillsStyle + '</fills>';\n  };\n\n  Workbook.prototype.saveBorders = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var bordersStyle = '<borders count=\"' + (this.mBorders.length + 1) + '\"><border><left /><right /><top /><bottom /><diagonal /></border>';\n\n    if (this.mBorders.length >= 1) {\n      for (var _i = 0, _a = this.mBorders; _i < _a.length; _i++) {\n        var borders = _a[_i];\n\n        if (this.isAllBorder(borders)) {\n          var color = borders.all.color.replace('#', '');\n          var lineStyle = borders.all.lineStyle;\n          /* tslint:disable-next-line:max-line-length */\n\n          bordersStyle += '<border><left style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></left><right style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></right><top style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></top><bottom style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></bottom></border>';\n        } else {\n          /* tslint:disable-next-line:max-line-length */\n          bordersStyle += '<border><left style=\"' + borders.left.lineStyle + '\"><color rgb=\"FF' + borders.left.color.replace('#', '') + '\" /></left><right style=\"' + borders.right.lineStyle + '\"><color rgb=\"FF' + borders.right.color.replace('#', '') + '\" /></right><top style=\"' + borders.top.lineStyle + '\"><color rgb=\"FF' + borders.top.color.replace('#', '') + '\" /></top><bottom style=\"' + borders.bottom.lineStyle + '\"><color rgb=\"FF' + borders.bottom.color.replace('#', '') + '\" /></bottom></border>';\n        }\n      }\n    }\n\n    return bordersStyle + '</borders>';\n  };\n\n  Workbook.prototype.saveCellStyles = function () {\n    var _this = this;\n\n    var cellStyleString = '<cellStyles  count=\"' + this.cellStyles.size + '\">';\n    this.cellStyles.forEach(function (value, key) {\n      cellStyleString += '<cellStyle name=\"' + key + '\" xfId=\"' + _this.cellStyles.get(key).xfId + '\"';\n\n      if (key === 'Normal') {\n        cellStyleString += ' builtinId=\"0\"';\n      }\n\n      cellStyleString += ' />';\n    });\n    return cellStyleString += '</cellStyles>';\n  };\n\n  Workbook.prototype.saveCellStyleXfs = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var cellXfsStyle = '<cellStyleXfs count=\"' + (this.mCellStyleXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" />';\n\n    if (this.mCellStyleXfs.length >= 1) {\n      for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\n        var cellStyleXf = _a[_i];\n        /* tslint:disable-next-line:max-line-length */\n\n        cellXfsStyle += '<xf numFmtId=\"' + cellStyleXf.numFmtId + '\" fontId=\"' + cellStyleXf.fontId + '\" fillId=\"' + cellStyleXf.fillId + '\" borderId=\"' + cellStyleXf.borderId + '\" ';\n\n        if (cellStyleXf.alignment !== undefined) {\n          cellXfsStyle += '>' + this.saveAlignment(cellStyleXf) + '</xf>';\n        } else {\n          cellXfsStyle += ' />';\n        }\n      }\n    }\n\n    return cellXfsStyle + '</cellStyleXfs>';\n  };\n\n  Workbook.prototype.saveCellXfs = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var cellXfsStyle = '<cellXfs count=\"' + (this.mCellXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" xfId=\"0\" />';\n\n    if (this.mCellXfs.length >= 1) {\n      for (var _i = 0, _a = this.mCellXfs; _i < _a.length; _i++) {\n        var cellXf = _a[_i];\n        /* tslint:disable-next-line:max-line-length */\n\n        cellXfsStyle += '<xf numFmtId=\"' + cellXf.numFmtId + '\" fontId=\"' + cellXf.fontId + '\" fillId=\"' + cellXf.fillId + '\" borderId=\"' + cellXf.borderId + '\" xfId=\"' + cellXf.xfId + '\" ';\n\n        if (cellXf.applyAlignment === 1) {\n          cellXfsStyle += 'applyAlignment=\"1\"';\n        }\n\n        cellXfsStyle += '>' + this.saveAlignment(cellXf) + '</xf>';\n      }\n    }\n\n    return cellXfsStyle + '</cellXfs>';\n  };\n\n  Workbook.prototype.saveAlignment = function (cellXf) {\n    var alignString = '<alignment ';\n\n    if (cellXf.alignment.horizontal !== undefined) {\n      alignString += 'horizontal=\"' + cellXf.alignment.horizontal + '\" ';\n    }\n\n    if (cellXf.alignment.indent !== undefined && cellXf.alignment.indent !== 0) {\n      alignString += 'indent=\"' + cellXf.alignment.indent + '\" ';\n    } else if (cellXf.alignment.rotation !== undefined && cellXf.alignment.rotation !== 0) {\n      alignString += 'textRotation=\"' + cellXf.alignment.rotation + '\" ';\n    }\n\n    if (cellXf.alignment.vertical !== undefined) {\n      alignString += 'vertical=\"' + cellXf.alignment.vertical + '\" ';\n    }\n\n    alignString += 'wrapText=\"' + cellXf.alignment.wrapText + '\" />';\n    return alignString;\n  };\n\n  Workbook.prototype.saveApp = function (builtInProperties) {\n    /* tslint:disable-next-line:max-line-length */\n    var appString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Properties xmlns=\"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties\"><Application>Essential XlsIO</Application>';\n\n    if (builtInProperties !== undefined) {\n      if (builtInProperties.manager !== undefined) {\n        appString += '<Manager>' + builtInProperties.manager + '</Manager>';\n      }\n\n      if (builtInProperties.company !== undefined) {\n        appString += '<Company>' + builtInProperties.company + '</Company>';\n      }\n    }\n\n    this.addToArchive(appString + '</Properties>', 'docProps/app.xml');\n  };\n\n  Workbook.prototype.saveCore = function (builtInProperties) {\n    var createdDate = new Date();\n    /* tslint:disable-next-line:max-line-length */\n\n    var coreString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><cp:coreProperties xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns:dcmitype=\"http://purl.org/dc/dcmitype/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:cp=\"http://schemas.openxmlformats.org/package/2006/metadata/core-properties\">';\n\n    if (this.builtInProperties !== undefined) {\n      if (builtInProperties.author !== undefined) {\n        coreString += '<dc:creator>' + builtInProperties.author + '</dc:creator>';\n      }\n\n      if (builtInProperties.subject !== undefined) {\n        coreString += '<dc:subject>' + builtInProperties.subject + '</dc:subject>';\n      }\n\n      if (builtInProperties.category !== undefined) {\n        coreString += '<cp:category>' + builtInProperties.category + '</cp:category>';\n      }\n\n      if (builtInProperties.comments !== undefined) {\n        coreString += '<dc:description>' + builtInProperties.comments + '</dc:description>';\n      }\n\n      if (builtInProperties.title !== undefined) {\n        coreString += '<dc:title>' + builtInProperties.title + '</dc:title>';\n      }\n\n      if (builtInProperties.tags !== undefined) {\n        coreString += '<cp:keywords>' + builtInProperties.tags + '</cp:keywords>';\n      }\n\n      if (builtInProperties.status !== undefined) {\n        coreString += '<cp:contentStatus>' + builtInProperties.status + '</cp:contentStatus>';\n      }\n\n      if (builtInProperties.createdDate !== undefined) {\n        /* tslint:disable-next-line:max-line-length */\n        coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.createdDate.toISOString() + '</dcterms:created>';\n      } else {\n        coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\n      }\n\n      if (builtInProperties.modifiedDate !== undefined) {\n        /* tslint:disable-next-line:max-line-length */\n        coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.modifiedDate.toISOString() + '</dcterms:modified>';\n      } else {\n        coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\n      }\n    } else {\n      coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\n      coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\n    }\n    /* tslint:disable-next-line:max-line-length */\n\n\n    coreString += '</cp:coreProperties>';\n    this.addToArchive(coreString, 'docProps/core.xml');\n  };\n\n  Workbook.prototype.saveTopLevelRelation = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var topRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\"><Relationship Id=\"rId1\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\" Target=\"xl/workbook.xml\" /><Relationship Id=\"rId2\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties\" Target=\"docProps/app.xml\" /><Relationship Id=\"rId3\" Type=\"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties\" Target=\"docProps/core.xml\" /></Relationships>';\n    this.addToArchive(topRelation, '_rels/.rels');\n  };\n\n  Workbook.prototype.saveWorkbookRelation = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var wbRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n    var length = this.worksheets.length;\n    var count = 0;\n\n    for (var i = 0; i < length; i++, count++) {\n      /* tslint:disable-next-line:max-line-length */\n      wbRelation += '<Relationship Id=\"rId' + (i + 1).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet\" Target=\"worksheets/sheet' + (i + 1).toString() + '.xml\" />';\n    }\n    /* tslint:disable-next-line:max-line-length */\n\n\n    wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles\" Target=\"styles.xml\" />';\n\n    if (this.sharedStringCount > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings\" Target=\"sharedStrings.xml\" />';\n    }\n\n    this.addToArchive(wbRelation + '</Relationships>', 'xl/_rels/workbook.xml.rels');\n  };\n\n  Workbook.prototype.saveContentType = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var contentTypeString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\"><Default Extension=\"xml\" ContentType=\"application/xml\" /><Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\" /><Override PartName=\"/xl/styles.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml\" /><Override PartName=\"/xl/workbook.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\" /><Override PartName=\"/docProps/app.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.extended-properties+xml\" /><Override PartName=\"/docProps/core.xml\" ContentType=\"application/vnd.openxmlformats-package.core-properties+xml\" />';\n    var sheetsOverride = '';\n    var length = this.worksheets.length;\n\n    for (var i = 0; i < length; i++) {\n      /* tslint:disable-next-line:max-line-length */\n      sheetsOverride += '<Override PartName=\"/xl/worksheets/sheet' + (i + 1).toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\" />';\n\n      if (this.worksheets[i].images != undefined && this.worksheets[i].images.length > 0) {\n        /* tslint:disable-next-line:max-line-length */\n        sheetsOverride += '<Override PartName=\"/xl/drawings/drawing' + (i + 1).toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.drawing+xml\" />';\n      }\n    }\n\n    if (this.imageCount > 0) sheetsOverride += '<Default Extension=\"png\" ContentType=\"image/png\" />';\n\n    if (this.sharedStringCount > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      contentTypeString += '<Override PartName=\"/xl/sharedStrings.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml\" />';\n    }\n\n    this.addToArchive(contentTypeString + sheetsOverride + '</Types>', '[Content_Types].xml');\n  };\n\n  Workbook.prototype.addToArchive = function (xmlString, itemName) {\n    if (typeof xmlString === 'string') {\n      var blob = new Blob([xmlString], {\n        type: 'text/plain'\n      });\n      var archiveItem = new ZipArchiveItem(blob, itemName);\n      this.mArchive.addItem(archiveItem);\n    } else {\n      var archiveItem = new ZipArchiveItem(xmlString, itemName);\n      this.mArchive.addItem(archiveItem);\n    }\n  };\n\n  Workbook.prototype.processMergeCells = function (cell, rowIndex, mergeCells) {\n    if (cell.rowSpan !== 0 || cell.colSpan !== 0) {\n      var mCell = new MergeCell();\n      mCell.x = cell.index;\n      mCell.width = cell.colSpan;\n      mCell.y = rowIndex;\n      mCell.height = cell.rowSpan;\n      var startCell = this.getCellName(mCell.y, mCell.x);\n      var endCell = this.getCellName(rowIndex + mCell.height, cell.index + mCell.width);\n      mCell.ref = startCell + ':' + endCell;\n      var mergedCell = mergeCells.add(mCell);\n      var start = {\n        x: mCell.x,\n        y: mCell.y\n      };\n      var end = {\n        x: cell.index + mCell.width,\n        y: rowIndex + mCell.height\n      };\n      this.updatedMergedCellStyles(start, end, cell);\n    }\n\n    return mergeCells;\n  };\n\n  Workbook.prototype.updatedMergedCellStyles = function (sCell, eCell, cell) {\n    for (var x = sCell.x; x <= eCell.x; x++) {\n      for (var y = sCell.y; y <= eCell.y; y++) {\n        this.mergedCellsStyle.set(this.getCellName(y, x), {\n          x: x,\n          y: y,\n          styleIndex: cell.styleIndex\n        });\n      }\n    }\n  };\n  /**\r\n   * Returns the tick count corresponding to the given year, month, and day.\r\n   * @param year number value of year\r\n   * @param month number value of month\r\n   * @param day number value of day\r\n   */\n\n\n  Workbook.prototype.dateToTicks = function (year, month, day) {\n    var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\n    var daysToMonth365 = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];\n    var daysToMonth366 = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366];\n\n    if (year >= 1 && year <= 9999 && month >= 1 && month <= 12) {\n      var days = this.isLeapYear(year) ? daysToMonth366 : daysToMonth365;\n      var y = year - 1;\n      var n = y * 365 + (y / 4 | 0) - (y / 100 | 0) + (y / 400 | 0) + days[month - 1] + day - 1;\n      return n * ticksPerDay;\n    }\n\n    throw new Error('Not a valid date');\n  };\n  /**\r\n   * Return the tick count corresponding to the given hour, minute, second.\r\n   * @param hour number value of hour\r\n   * @param minute number value if minute\r\n   * @param second number value of second\r\n   */\n\n\n  Workbook.prototype.timeToTicks = function (hour, minute, second) {\n    if (hour >= 0 && hour < 24 && minute >= 0 && minute < 60 && second >= 0 && second < 60) {\n      var totalSeconds = hour * 3600 + minute * 60 + second;\n      return totalSeconds * 10000 * 1000;\n    }\n\n    throw new Error('Not valid time');\n  };\n  /**\r\n   * Checks if given year is a leap year.\r\n   * @param year Year value.\r\n   */\n\n\n  Workbook.prototype.isLeapYear = function (year) {\n    return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);\n  };\n  /**\r\n   * Converts `DateTime` to the equivalent OLE Automation date.\r\n   */\n\n\n  Workbook.prototype.toOADate = function (date) {\n    var ticks = 0;\n    /* tslint:disable-next-line:max-line-length */\n\n    ticks = this.dateToTicks(date.getFullYear(), date.getMonth() + 1, date.getDate()) + this.timeToTicks(date.getHours(), date.getMinutes(), date.getSeconds());\n\n    if (ticks === 0) {\n      return 0.0;\n    }\n\n    var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\n    var daysTo1899 = (((365 * 4 + 1) * 25 - 1) * 4 + 1) * 4 + ((365 * 4 + 1) * 25 - 1) * 3 - 367;\n    var doubleDateOffset = daysTo1899 * ticksPerDay;\n    var oaDateMinAsTicks = ((365 * 4 + 1) * 25 - 1 - 365) * ticksPerDay;\n\n    if (ticks < oaDateMinAsTicks) {\n      throw new Error('Arg_OleAutDateInvalid');\n    }\n\n    var millisPerDay = 1000 * 60 * 60 * 24;\n    return (ticks - doubleDateOffset) / 10000 / millisPerDay;\n  };\n\n  return Workbook;\n}();\n\nexport { Workbook };\n/**\r\n * BuiltInProperties Class\r\n * @private\r\n */\n\nvar BuiltInProperties =\n/** @class */\nfunction () {\n  function BuiltInProperties() {}\n\n  return BuiltInProperties;\n}();\n\nexport { BuiltInProperties };","map":{"version":3,"sources":["D:/HUST/20211/Introduction to Software Engineering/Project/Sprint 2/RubyGYM/client/node_modules/@syncfusion/ej2-excel-export/src/workbook.js"],"names":["Worksheets","Worksheet","FreezePane","MergeCell","MergeCells","HyperLink","Grouping","CellStyle","Font","Borders","CellXfs","Alignment","NumFmt","CellStyleXfs","CellStyles","Column","Row","Rows","Image","Cell","Cells","ZipArchive","ZipArchiveItem","CsvHelper","Internationalization","isNullOrUndefined","BlobHelper","AutoFilters","Workbook","json","saveType","culture","currencyString","separator","sharedStringCount","unitsProportions","hyperlinkStyle","fontColor","underline","undefined","currency","intl","mSaveType","mArchive","sharedString","mFonts","mBorders","mStyles","printTitles","Map","cellStyles","mNumFmt","mFills","push","set","mCellXfs","mCellStyleXfs","drawingCount","imageCount","styles","globalStyles","i","length","name","has","cellStyle","isGlobalStyle","parserCellStyle","cellStylesIn","xfId","index","tFormat","numberFormat","format","type","Error","worksheets","parserWorksheets","builtInProperties","BuiltInProperties","parserBuiltInProperties","csvHelper","prototype","jsonBuiltInProperties","author","comments","category","company","manager","subject","title","createdDate","modifiedDate","tags","status","jsonSheet","sheet","mergeCells","mergedCellsStyle","mHyperLinks","toString","enableRtl","columns","parserColumns","rows","parserRows","showGridLines","freeze","parserFreezePanes","printTitle","parserPrintTitle","pageSetup","isSummaryRowBelow","images","parserImages","autoFilters","parseFilters","hyperLinks","mergeOptions","fromJson","toJson","result","applyProperties","sourceJson","destJson","keys","Object","getCellName","row","column","getColumnName","col","strColumnName","iCurrentDigit","String","fromCharCode","printTitleName","titleRowName","fromRow","toRow","titleColName","fromColumn","toColumn","freezePanes","leftCell","columnsLength","width","rowsLength","rowId","r","parserRow","add","insertMergedCellsStyle","_this","forEach","value","key","filter","item","y","cell","cells","x","styleIndex","insertIndex","indexOf","splice","createCell","rowToInsert","cellToInsert","refName","rowIndex","height","grouping","parseGrouping","parseCells","outlineLevel","isCollapsed","isHidden","cellsLength","spanMin","spanMax","curCellIndex","cellId","jsonCell","rowSpan","colSpan","hyperlink","hyperLink","target","displayText","getCellValueType","ref","rId","style","formula","Date","parseCellType","processMergeCells","spans","GetColors","colors","processColor","colorVal","replace","toUpperCase","rgbColors","get","processCellValue","cellValue","processedVal","startindex","endIndex","processString","substring","subString","text","subSplit","split","_i","subSplit_1","element","start","trim","applyGlobalStyle","a","cellType","defStyleIndex","backColor","borders","parserBorder","all","leftBorder","left","rightBorder","right","topBorder","top","bottomBorder","bottom","fontName","fontSize","italic","bold","hAlign","toLowerCase","indent","rotation","vAlign","wrapText","getNumberFormat","numFmtId","processCellStyle","switchNumberFormat","numFmt","formatCode","_a","cellStyleXfs","_b","_c","cellXfs","returnFormat","getNumberPattern","useGrouping","error","getDatePattern","skeleton","border","color","lineStyle","processNumFormatId","compareResult","compareStyle","id","size","isNewFont","toCompareStyle","font","b","u","sz","isNewBorder","bStyle","isAllBorder","toCompareBorder","allBorderStyle","globalStyleIndex","baseStyle","contains","array","toOADate","value_1","sstvalue","imagesLength","imageId","p","image","parserImage","lastRow","lastColumn","horizontalFlip","verticalFlip","saveAsBlob","blobSaveType","Promise","resolve","reject","obj","blobData","saveInternal","then","blob","Blob","save","fileName","proxyUrl","xlsxMatch","match","csvMatch","destroy","saveWorkbook","saveWorksheets","saveSharedString","saveStyles","saveApp","saveCore","saveContentType","saveTopLevelRelation","saveWorkbookRelation","workbookTemp","sheets","sheetName","printTitle_1","addToArchive","saveWorksheet","sheetBlob","sheetString","saveSheetView","colString","pixelsToColumnWidth","append","rowString","pixelsToRowHeight","_d","_e","_f","_g","mCell","_h","_j","hLink","saveDrawings","saveSheetRelations","getBlob","drawings","sheetDrawingString","imgId","pic","updatelastRowOffset","updatelastColumnOffSet","lastRowOffset","lastColOffset","imageFile","imageData","convertBase64toImage","saveDrawingRelations","picture","iCurHeight","iCurRow","iCurOffset","iRowHeight","convertToPixels","iSpaceInCell","rowHiddenHeight","Math","round","iCurWidth","iCurCol","iColWidth","ColumnWidthToPixels","colHiddenWidth","img","byteStr","window","atob","buffer","ArrayBuffer","data","Uint8Array","charCodeAt","drawingRelation","pixels","dDigitWidth","val","trunc","fileWidth","n","relStr","paneString","sstStart","si","updateCellXfsStyleXfs","styleTemp","saveNumberFormats","saveFonts","saveFills","saveBorders","saveCellStyleXfs","saveCellXfs","saveCellStyles","compareFontResult","fontId","fillId","borderId","applyAlignment","alignment","horizontal","vertical","numFmtStyle_1","fontStyle","fillsStyle","bordersStyle","cellStyleString","cellXfsStyle","cellStyleXf","saveAlignment","cellXf","alignString","appString","coreString","toISOString","topRelation","wbRelation","count","contentTypeString","sheetsOverride","xmlString","itemName","archiveItem","addItem","startCell","endCell","mergedCell","end","updatedMergedCellStyles","sCell","eCell","dateToTicks","year","month","day","ticksPerDay","daysToMonth365","daysToMonth366","days","isLeapYear","timeToTicks","hour","minute","second","totalSeconds","date","ticks","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","daysTo1899","doubleDateOffset","oaDateMinAsTicks","millisPerDay"],"mappings":"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","sourcesContent":["import { Worksheets } from './worksheets';\r\nimport { Worksheet, FreezePane, MergeCell, MergeCells, HyperLink, Grouping } from './worksheet';\r\nimport { CellStyle, Font, Borders, CellXfs, Alignment, NumFmt, CellStyleXfs, CellStyles } from './cell-style';\r\nimport { Column } from './column';\r\nimport { Row, Rows } from './row';\r\nimport { Image } from './image';\r\nimport { Cell, Cells } from './cell';\r\nimport { ZipArchive, ZipArchiveItem } from '@syncfusion/ej2-compression';\r\nimport { CsvHelper } from './csv-helper';\r\nimport { Internationalization, isNullOrUndefined } from '@syncfusion/ej2-base';\r\nimport { BlobHelper } from './blob-helper';\r\nimport { AutoFilters } from './auto-filters';\r\n/**\r\n * Workbook class\r\n */\r\nvar Workbook = /** @class */ (function () {\r\n    /* tslint:disable:no-any */\r\n    function Workbook(json, saveType, culture, currencyString, separator) {\r\n        this.sharedStringCount = 0;\r\n        this.unitsProportions = [\r\n            96 / 75.0,\r\n            96 / 300.0,\r\n            96,\r\n            96 / 25.4,\r\n            96 / 2.54,\r\n            1,\r\n            96 / 72.0,\r\n            96 / 72.0 / 12700,\r\n        ];\r\n        /* tslint:disable:no-any */\r\n        this.hyperlinkStyle = { fontColor: '#0000FF', underline: true };\r\n        if (culture !== undefined) {\r\n            this.culture = culture;\r\n        }\r\n        else {\r\n            this.culture = 'en-US';\r\n        }\r\n        if (currencyString !== undefined) {\r\n            this.currency = currencyString;\r\n        }\r\n        else {\r\n            this.currency = 'USD';\r\n        }\r\n        this.intl = new Internationalization(this.culture);\r\n        this.mSaveType = saveType;\r\n        if (saveType === 'xlsx') {\r\n            this.mArchive = new ZipArchive();\r\n            this.sharedString = [];\r\n            this.mFonts = [];\r\n            this.mBorders = [];\r\n            this.mStyles = [];\r\n            this.printTitles = new Map();\r\n            this.cellStyles = new Map();\r\n            this.mNumFmt = new Map();\r\n            this.mFills = new Map();\r\n            this.mStyles.push(new CellStyle());\r\n            this.mFonts.push(new Font());\r\n            /* tslint:disable */\r\n            this.cellStyles.set('Normal', new CellStyles());\r\n            /* tslint:enable */\r\n            this.mCellXfs = [];\r\n            this.mCellStyleXfs = [];\r\n            this.drawingCount = 0;\r\n            this.imageCount = 0;\r\n            if (json.styles !== null && json.styles !== undefined) {\r\n                /* tslint:disable-next-line:no-any */\r\n                this.globalStyles = new Map();\r\n                for (var i = 0; i < json.styles.length; i++) {\r\n                    if (json.styles[i].name !== undefined) {\r\n                        if (!this.cellStyles.has(json.styles[i].name)) {\r\n                            var cellStyle = new CellStyle();\r\n                            cellStyle.isGlobalStyle = true;\r\n                            this.parserCellStyle(json.styles[i], cellStyle, 'none');\r\n                            var cellStylesIn = new CellStyles();\r\n                            cellStylesIn.name = cellStyle.name;\r\n                            cellStylesIn.xfId = (cellStyle.index - 1);\r\n                            this.cellStyles.set(cellStylesIn.name, cellStylesIn);\r\n                            /* tslint:disable-next-line:no-any */\r\n                            var tFormat = {};\r\n                            if (json.styles[i].numberFormat !== undefined) {\r\n                                tFormat.format = json.styles[i].numberFormat;\r\n                            }\r\n                            if (json.styles[i].type !== undefined) {\r\n                                tFormat.type = json.styles[i].type;\r\n                            }\r\n                            else {\r\n                                tFormat.type = 'datetime';\r\n                            }\r\n                            if (tFormat.format !== undefined) {\r\n                                this.globalStyles.set(json.styles[i].name, tFormat);\r\n                            }\r\n                        }\r\n                        else {\r\n                            throw Error('Style name ' + json.styles[i].name + ' is already existed');\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // Parses Worksheets data to DOM.        \r\n            if (json.worksheets !== null && json.worksheets !== undefined) {\r\n                this.parserWorksheets(json.worksheets);\r\n            }\r\n            else {\r\n                throw Error('Worksheet is expected.');\r\n            }\r\n            // Parses the BuiltInProperties data to DOM.        \r\n            if (json.builtInProperties !== null && json.builtInProperties !== undefined) {\r\n                this.builtInProperties = new BuiltInProperties();\r\n                this.parserBuiltInProperties(json.builtInProperties, this.builtInProperties);\r\n            }\r\n        }\r\n        else {\r\n            this.csvHelper = new CsvHelper(json, separator);\r\n        }\r\n    }\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserBuiltInProperties = function (jsonBuiltInProperties, builtInProperties) {\r\n        //Author\r\n        if (jsonBuiltInProperties.author !== null && jsonBuiltInProperties.author !== undefined) {\r\n            builtInProperties.author = jsonBuiltInProperties.author;\r\n        }\r\n        //Comments\r\n        if (jsonBuiltInProperties.comments !== null && jsonBuiltInProperties.comments !== undefined) {\r\n            builtInProperties.comments = jsonBuiltInProperties.comments;\r\n        }\r\n        //Category\r\n        if (jsonBuiltInProperties.category !== null && jsonBuiltInProperties.category !== undefined) {\r\n            builtInProperties.category = jsonBuiltInProperties.category;\r\n        }\r\n        //Company\r\n        if (jsonBuiltInProperties.company !== null && jsonBuiltInProperties.company !== undefined) {\r\n            builtInProperties.company = jsonBuiltInProperties.company;\r\n        }\r\n        //Manager\r\n        if (jsonBuiltInProperties.manager !== null && jsonBuiltInProperties.manager !== undefined) {\r\n            builtInProperties.manager = jsonBuiltInProperties.manager;\r\n        }\r\n        //Subject\r\n        if (jsonBuiltInProperties.subject !== null && jsonBuiltInProperties.subject !== undefined) {\r\n            builtInProperties.subject = jsonBuiltInProperties.subject;\r\n        }\r\n        //Title\r\n        if (jsonBuiltInProperties.title !== null && jsonBuiltInProperties.title !== undefined) {\r\n            builtInProperties.title = jsonBuiltInProperties.title;\r\n        }\r\n        //Creation date\r\n        if (jsonBuiltInProperties.createdDate !== null && jsonBuiltInProperties.createdDate !== undefined) {\r\n            builtInProperties.createdDate = jsonBuiltInProperties.createdDate;\r\n        }\r\n        //Modified date\r\n        if (jsonBuiltInProperties.modifiedDate !== null && jsonBuiltInProperties.modifiedDate !== undefined) {\r\n            builtInProperties.modifiedDate = jsonBuiltInProperties.modifiedDate;\r\n        }\r\n        //Tags\r\n        if (jsonBuiltInProperties.tags !== null && jsonBuiltInProperties.tags !== undefined) {\r\n            builtInProperties.tags = jsonBuiltInProperties.tags;\r\n        }\r\n        //Status\r\n        if (jsonBuiltInProperties.status !== null && jsonBuiltInProperties.status !== undefined) {\r\n            builtInProperties.status = jsonBuiltInProperties.status;\r\n        }\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserWorksheets = function (json) {\r\n        this.worksheets = new Worksheets();\r\n        var length = json.length;\r\n        for (var i = 0; i < length; i++) {\r\n            var jsonSheet = json[i];\r\n            var sheet = new Worksheet();\r\n            this.mergeCells = new MergeCells();\r\n            this.mergedCellsStyle = new Map();\r\n            this.mHyperLinks = [];\r\n            //Name\r\n            if (jsonSheet.name !== null && jsonSheet.name !== undefined) {\r\n                sheet.name = jsonSheet.name;\r\n            }\r\n            else {\r\n                sheet.name = 'Sheet' + (i + 1).toString();\r\n            }\r\n            if (jsonSheet.enableRtl !== null && jsonSheet.enableRtl !== undefined) {\r\n                sheet.enableRtl = jsonSheet.enableRtl;\r\n            }\r\n            sheet.index = (i + 1);\r\n            //Columns\r\n            if (jsonSheet.columns !== null && jsonSheet.columns !== undefined) {\r\n                this.parserColumns(jsonSheet.columns, sheet);\r\n            }\r\n            //Rows\r\n            if (jsonSheet.rows !== null && jsonSheet.rows !== undefined) {\r\n                this.parserRows(jsonSheet.rows, sheet);\r\n            }\r\n            //showGridLines\r\n            if (jsonSheet.showGridLines !== null && jsonSheet.showGridLines !== undefined) {\r\n                sheet.showGridLines = jsonSheet.showGridLines;\r\n            }\r\n            //FreezePanes\r\n            if (jsonSheet.freeze !== null && jsonSheet.freeze !== undefined) {\r\n                this.parserFreezePanes(jsonSheet.freeze, sheet);\r\n            }\r\n            //Print Title\r\n            if (jsonSheet.printTitle !== null && jsonSheet.printTitle !== undefined) {\r\n                this.parserPrintTitle(jsonSheet.printTitle, sheet);\r\n            }\r\n            if (jsonSheet.pageSetup !== undefined) {\r\n                if (jsonSheet.pageSetup.isSummaryRowBelow !== undefined) {\r\n                    sheet.isSummaryRowBelow = jsonSheet.pageSetup.isSummaryRowBelow;\r\n                }\r\n            }\r\n            if (jsonSheet.images !== undefined) {\r\n                this.parserImages(jsonSheet.images, sheet);\r\n            }\r\n            if (jsonSheet.autoFilters !== null && jsonSheet.autoFilters !== undefined) {\r\n                this.parseFilters(jsonSheet.autoFilters, sheet);\r\n            }\r\n            sheet.index = (i + 1);\r\n            sheet.mergeCells = this.mergeCells;\r\n            sheet.hyperLinks = this.mHyperLinks;\r\n            this.worksheets.push(sheet);\r\n        }\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.mergeOptions = function (fromJson, toJson) {\r\n        /* tslint:disable:no-any */\r\n        var result = {};\r\n        this.applyProperties(fromJson, result);\r\n        this.applyProperties(toJson, result);\r\n        return result;\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.applyProperties = function (sourceJson, destJson) {\r\n        var keys = Object.keys(sourceJson);\r\n        for (var index = 0; index < keys.length; index++) {\r\n            if (keys[index] !== 'name') {\r\n                destJson[keys[index]] = sourceJson[keys[index]];\r\n            }\r\n        }\r\n    };\r\n    Workbook.prototype.getCellName = function (row, column) {\r\n        return this.getColumnName(column) + row.toString();\r\n    };\r\n    Workbook.prototype.getColumnName = function (col) {\r\n        col--;\r\n        var strColumnName = '';\r\n        do {\r\n            var iCurrentDigit = col % 26;\r\n            col = col / 26 - 1;\r\n            strColumnName = String.fromCharCode(65 + iCurrentDigit) + strColumnName;\r\n        } while (col >= 0);\r\n        return strColumnName;\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserPrintTitle = function (json, sheet) {\r\n        var printTitleName = '';\r\n        var titleRowName;\r\n        if (json.fromRow !== null && json.fromRow !== undefined) {\r\n            var fromRow = json.fromRow;\r\n            var toRow = void 0;\r\n            if (json.toRow !== null && json.toRow !== undefined) {\r\n                toRow = json.toRow;\r\n            }\r\n            else {\r\n                toRow = json.fromRow;\r\n            }\r\n            titleRowName = '$' + fromRow + ':$' + toRow;\r\n        }\r\n        var titleColName;\r\n        if (json.fromColumn !== null && json.fromColumn !== undefined) {\r\n            var fromColumn = json.fromColumn;\r\n            var toColumn = void 0;\r\n            if (json.toColumn !== null && json.toColumn !== undefined) {\r\n                toColumn = json.toColumn;\r\n            }\r\n            else {\r\n                toColumn = json.fromColumn;\r\n            }\r\n            titleColName = '$' + this.getColumnName(fromColumn) + ':$' + this.getColumnName(toColumn);\r\n        }\r\n        if (titleRowName !== undefined) {\r\n            printTitleName += (sheet.name + '!' + titleRowName);\r\n        }\r\n        if (titleColName !== undefined && titleRowName !== undefined) {\r\n            printTitleName += ',' + (sheet.name + '!' + titleColName);\r\n        }\r\n        else if (titleColName !== undefined) {\r\n            printTitleName += (sheet.name + '!' + titleColName);\r\n        }\r\n        if (printTitleName !== '') {\r\n            this.printTitles.set(sheet.index - 1, printTitleName);\r\n        }\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserFreezePanes = function (json, sheet) {\r\n        sheet.freezePanes = new FreezePane();\r\n        if (json.row !== null && json.row !== undefined) {\r\n            sheet.freezePanes.row = json.row;\r\n        }\r\n        else {\r\n            sheet.freezePanes.row = 0;\r\n        }\r\n        if (json.column !== null && json.column !== undefined) {\r\n            sheet.freezePanes.column = json.column;\r\n        }\r\n        else {\r\n            sheet.freezePanes.column = 0;\r\n        }\r\n        sheet.freezePanes.leftCell = this.getCellName(sheet.freezePanes.row + 1, sheet.freezePanes.column + 1);\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserColumns = function (json, sheet) {\r\n        var columnsLength = json.length;\r\n        sheet.columns = [];\r\n        for (var column = 0; column < columnsLength; column++) {\r\n            var col = new Column();\r\n            if (json[column].index !== null && json[column].index !== undefined) {\r\n                col.index = json[column].index;\r\n            }\r\n            else {\r\n                throw Error('Column index is missing.');\r\n            }\r\n            if (json[column].width !== null && json[column].width !== undefined) {\r\n                col.width = json[column].width;\r\n            }\r\n            sheet.columns.push(col);\r\n        }\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserRows = function (json, sheet) {\r\n        var rowsLength = json.length;\r\n        sheet.rows = new Rows();\r\n        var rowId = 0;\r\n        for (var r = 0; r < rowsLength; r++) {\r\n            var row = this.parserRow(json[r], rowId);\r\n            rowId = row.index;\r\n            sheet.rows.add(row);\r\n        }\r\n        this.insertMergedCellsStyle(sheet);\r\n    };\r\n    Workbook.prototype.insertMergedCellsStyle = function (sheet) {\r\n        var _this = this;\r\n        if (this.mergeCells.length > 0) {\r\n            this.mergedCellsStyle.forEach(function (value, key) {\r\n                var row = sheet.rows.filter(function (item) {\r\n                    return item.index === value.y;\r\n                })[0];\r\n                if (!isNullOrUndefined(row)) {\r\n                    var cell = row.cells.filter(function (item) {\r\n                        return item.index === value.x;\r\n                    })[0];\r\n                    if (!isNullOrUndefined(cell)) {\r\n                        cell.styleIndex = value.styleIndex;\r\n                    }\r\n                    else {\r\n                        var cells = row.cells.filter(function (item) {\r\n                            return item.index <= value.x;\r\n                        });\r\n                        var insertIndex = 0;\r\n                        if (cells.length > 0) {\r\n                            insertIndex = row.cells.indexOf(cells[cells.length - 1]) + 1;\r\n                        }\r\n                        row.cells.splice(insertIndex, 0, _this.createCell(value, key));\r\n                    }\r\n                }\r\n                else {\r\n                    var rows = sheet.rows.filter(function (item) {\r\n                        return item.index <= value.y;\r\n                    });\r\n                    var rowToInsert = new Row();\r\n                    rowToInsert.index = value.y;\r\n                    rowToInsert.cells = new Cells();\r\n                    rowToInsert.cells.add(_this.createCell(value, key));\r\n                    var insertIndex = 0;\r\n                    if (rows.length > 0) {\r\n                        insertIndex = sheet.rows.indexOf(rows[rows.length - 1]) + 1;\r\n                    }\r\n                    sheet.rows.splice(insertIndex, 0, rowToInsert);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Workbook.prototype.createCell = function (value, key) {\r\n        var cellToInsert = new Cell();\r\n        cellToInsert.refName = key;\r\n        cellToInsert.index = value.x;\r\n        cellToInsert.cellStyle = new CellStyle();\r\n        cellToInsert.styleIndex = value.styleIndex;\r\n        return cellToInsert;\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserRow = function (json, rowIndex) {\r\n        var row = new Row();\r\n        //Row Height\r\n        if (json.height !== null && json.height !== undefined) {\r\n            row.height = json.height;\r\n        }\r\n        //Row index\r\n        if (json.index !== null && json.index !== undefined) {\r\n            row.index = json.index;\r\n        }\r\n        else {\r\n            throw Error('Row index is missing.');\r\n        }\r\n        if (json.grouping !== null && json.grouping !== undefined) {\r\n            this.parseGrouping(json.grouping, row);\r\n        }\r\n        this.parseCells(json.cells, row);\r\n        return row;\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parseGrouping = function (json, row) {\r\n        row.grouping = new Grouping();\r\n        if (json.outlineLevel !== undefined) {\r\n            row.grouping.outlineLevel = json.outlineLevel;\r\n        }\r\n        if (json.isCollapsed !== undefined) {\r\n            row.grouping.isCollapsed = json.isCollapsed;\r\n        }\r\n        if (json.isHidden !== undefined) {\r\n            row.grouping.isHidden = json.isHidden;\r\n        }\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parseCells = function (json, row) {\r\n        row.cells = new Cells();\r\n        var cellsLength = json !== undefined ? json.length : 0;\r\n        var spanMin = 1;\r\n        var spanMax = 1;\r\n        var curCellIndex = 0;\r\n        for (var cellId = 0; cellId < cellsLength; cellId++) {\r\n            /* tslint:disable:no-any */\r\n            var jsonCell = json[cellId];\r\n            var cell = new Cell();\r\n            //cell index\r\n            if (jsonCell.index !== null && jsonCell.index !== undefined) {\r\n                cell.index = jsonCell.index;\r\n            }\r\n            else {\r\n                throw Error('Cell index is missing.');\r\n            }\r\n            if (cell.index < spanMin) {\r\n                spanMin = cell.index;\r\n            }\r\n            else if (cell.index > spanMax) {\r\n                spanMax = cell.index;\r\n            }\r\n            //Update the Cell name\r\n            cell.refName = this.getCellName(row.index, cell.index);\r\n            //Row span\r\n            if (jsonCell.rowSpan !== null && jsonCell.rowSpan !== undefined) {\r\n                cell.rowSpan = jsonCell.rowSpan - 1;\r\n            }\r\n            else {\r\n                cell.rowSpan = 0;\r\n            }\r\n            //Column span\r\n            if (jsonCell.colSpan !== null && jsonCell.colSpan !== undefined) {\r\n                cell.colSpan = jsonCell.colSpan - 1;\r\n            }\r\n            else {\r\n                cell.colSpan = 0;\r\n            }\r\n            //Hyperlink\r\n            if (jsonCell.hyperlink !== null && jsonCell.hyperlink !== undefined) {\r\n                var hyperLink = new HyperLink();\r\n                if (jsonCell.hyperlink.target !== undefined) {\r\n                    hyperLink.target = jsonCell.hyperlink.target;\r\n                    if (jsonCell.hyperlink.displayText !== undefined) {\r\n                        cell.value = jsonCell.hyperlink.displayText;\r\n                    }\r\n                    else {\r\n                        cell.value = jsonCell.hyperlink.target;\r\n                    }\r\n                    cell.type = this.getCellValueType(cell.value);\r\n                    hyperLink.ref = cell.refName;\r\n                    hyperLink.rId = (this.mHyperLinks.length + 1);\r\n                    this.mHyperLinks.push(hyperLink);\r\n                    cell.cellStyle = new CellStyle();\r\n                    /* tslint:disable-next-line:max-line-length */\r\n                    this.parserCellStyle((jsonCell.style !== undefined ? this.mergeOptions(jsonCell.style, this.hyperlinkStyle) : this.hyperlinkStyle), cell.cellStyle, 'string');\r\n                    cell.styleIndex = cell.cellStyle.index;\r\n                }\r\n            }\r\n            // formulas\r\n            if (jsonCell.formula !== null && jsonCell.formula !== undefined) {\r\n                cell.formula = jsonCell.formula;\r\n                cell.type = 'formula';\r\n            }\r\n            //Cell value\r\n            if (jsonCell.value !== null && jsonCell.value !== undefined) {\r\n                if (cell.formula !== undefined) {\r\n                    cell.value = 0;\r\n                }\r\n                else {\r\n                    cell.value = jsonCell.value;\r\n                    cell.type = this.getCellValueType(cell.value);\r\n                }\r\n            }\r\n            if (jsonCell.style !== null && jsonCell.style !== undefined && cell.styleIndex === undefined) {\r\n                cell.cellStyle = new CellStyle();\r\n                if (cell.value instanceof Date) {\r\n                    this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type, 14);\r\n                }\r\n                else {\r\n                    this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type);\r\n                }\r\n                cell.styleIndex = cell.cellStyle.index;\r\n            }\r\n            else if (cell.value instanceof Date) {\r\n                cell.cellStyle = new CellStyle();\r\n                this.parserCellStyle({}, cell.cellStyle, cell.type, 14);\r\n                cell.styleIndex = cell.cellStyle.index;\r\n            }\r\n            this.parseCellType(cell);\r\n            this.mergeCells = this.processMergeCells(cell, row.index, this.mergeCells);\r\n            row.cells.add(cell);\r\n            curCellIndex = (cell.index + 1);\r\n        }\r\n        row.spans = (spanMin) + ':' + (spanMax);\r\n    };\r\n    Workbook.prototype.GetColors = function () {\r\n        var colors;\r\n        colors = new Map();\r\n        /* tslint:disable */\r\n        colors.set('WHITE', 'FFFFFFFF');\r\n        /* tslint:disable */\r\n        colors.set('SILVER', 'FFC0C0C0');\r\n        /* tslint:disable */\r\n        colors.set('GRAY', 'FF808080');\r\n        /* tslint:disable */\r\n        colors.set('BLACK', 'FF000000');\r\n        /* tslint:disable */\r\n        colors.set('RED', 'FFFF0000');\r\n        /* tslint:disable */\r\n        colors.set('MAROON', 'FF800000');\r\n        /* tslint:disable */\r\n        colors.set('YELLOW', 'FFFFFF00');\r\n        /* tslint:disable */\r\n        colors.set('OLIVE', 'FF808000');\r\n        /* tslint:disable */\r\n        colors.set('LIME', 'FF00FF00');\r\n        /* tslint:disable */\r\n        colors.set('GREEN', 'FF008000');\r\n        /* tslint:disable */\r\n        colors.set('AQUA', 'FF00FFFF');\r\n        /* tslint:disable */\r\n        colors.set('TEAL', 'FF008080');\r\n        /* tslint:disable */\r\n        colors.set('BLUE', 'FF0000FF');\r\n        /* tslint:disable */\r\n        colors.set('NAVY', 'FF000080');\r\n        /* tslint:disable */\r\n        colors.set('FUCHSIA', 'FFFF00FF');\r\n        /* tslint:disable */\r\n        colors.set('PURPLE', 'FF800080');\r\n        return colors;\r\n    };\r\n    Workbook.prototype.processColor = function (colorVal) {\r\n        if (colorVal.indexOf('#') === 0) {\r\n            return colorVal.replace('#', 'FF');\r\n        }\r\n        colorVal = colorVal.toUpperCase();\r\n        this.rgbColors = this.GetColors();\r\n        if (this.rgbColors.has(colorVal)) {\r\n            colorVal = this.rgbColors.get(colorVal);\r\n        }\r\n        else {\r\n            colorVal = 'FF000000';\r\n        }\r\n        return colorVal;\r\n    };\r\n    Workbook.prototype.processCellValue = function (value, cell) {\r\n        var cellValue = value;\r\n        if (value.indexOf(\"<font\") !== -1 || value.indexOf(\"<a\") !== -1 || value.indexOf(\"<b>\") !== -1 ||\r\n            value.indexOf(\"<i>\") !== -1 || value.indexOf(\"<u>\") !== -1) {\r\n            var processedVal = '';\r\n            var startindex = value.indexOf('<', 0);\r\n            var endIndex = value.indexOf('>', startindex + 1);\r\n            if (startindex >= 0 && endIndex >= 0) {\r\n                if (startindex !== 0) {\r\n                    processedVal += '<r><t xml:space=\"preserve\">' + this.processString(value.substring(0, startindex)) + '</t></r>';\r\n                }\r\n                while (startindex >= 0 && endIndex >= 0) {\r\n                    endIndex = value.indexOf('>', startindex + 1);\r\n                    if (endIndex >= 0) {\r\n                        var subString = value.substring(startindex + 1, endIndex);\r\n                        startindex = value.indexOf('<', endIndex + 1);\r\n                        if (startindex < 0) {\r\n                            startindex = cellValue.length;\r\n                        }\r\n                        var text = cellValue.substring(endIndex + 1, startindex);\r\n                        if (text.length !== 0) {\r\n                            var subSplit = subString.split(' ');\r\n                            if (subSplit.length > 0) {\r\n                                processedVal += '<r><rPr>';\r\n                            }\r\n                            if (subSplit.length > 1) {\r\n                                for (var _i = 0, subSplit_1 = subSplit; _i < subSplit_1.length; _i++) {\r\n                                    var element = subSplit_1[_i];\r\n                                    var start = element.trim().substring(0, 5);\r\n                                    switch (start) {\r\n                                        case 'size=':\r\n                                            processedVal += '<sz val=\"' + element.substring(6, element.length - 1) + '\"/>';\r\n                                            break;\r\n                                        case 'face=':\r\n                                            processedVal += '<rFont val=\"' + element.substring(6, element.length - 1) + '\"/>';\r\n                                            break;\r\n                                        case 'color':\r\n                                            processedVal += '<color rgb=\"' + this.processColor(element.substring(7, element.length - 1)) + '\"/>';\r\n                                            break;\r\n                                        case 'href=':\r\n                                            var hyperLink = new HyperLink();\r\n                                            hyperLink.target = element.substring(6, element.length - 1).trim();\r\n                                            hyperLink.ref = cell.refName;\r\n                                            hyperLink.rId = (this.mHyperLinks.length + 1);\r\n                                            this.mHyperLinks.push(hyperLink);\r\n                                            processedVal += '<color rgb=\"FF0000FF\"/><u/><b/>';\r\n                                            break;\r\n                                    }\r\n                                }\r\n                            }\r\n                            else if (subSplit.length === 1) {\r\n                                var style = subSplit[0].trim();\r\n                                switch (style) {\r\n                                    case 'b':\r\n                                        processedVal += '<b/>';\r\n                                        break;\r\n                                    case 'i':\r\n                                        processedVal += '<i/>';\r\n                                        break;\r\n                                    case 'u':\r\n                                        processedVal += '<u/>';\r\n                                        break;\r\n                                }\r\n                            }\r\n                            processedVal += '</rPr><t xml:space=\"preserve\">' + this.processString(text) + '</t></r>';\r\n                        }\r\n                    }\r\n                }\r\n                if (processedVal === '') {\r\n                    return cellValue;\r\n                }\r\n                return processedVal;\r\n            }\r\n            else {\r\n                return cellValue;\r\n            }\r\n        }\r\n        else {\r\n            return cellValue;\r\n        }\r\n    };\r\n    Workbook.prototype.applyGlobalStyle = function (json, cellStyle) {\r\n        var index = 0;\r\n        if (this.cellStyles.has(json.name)) {\r\n            cellStyle.index = this.mStyles.filter(function (a) { return (a.name === json.name); })[0].index;\r\n            cellStyle.name = json.name;\r\n        }\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserCellStyle = function (json, cellStyle, cellType, defStyleIndex) {\r\n        //name\r\n        if (json.name !== null && json.name !== undefined) {\r\n            if (cellStyle.isGlobalStyle) {\r\n                cellStyle.name = json.name;\r\n            }\r\n            else {\r\n                this.applyGlobalStyle(json, cellStyle);\r\n                return;\r\n            }\r\n        }\r\n        //background color\r\n        if (json.backColor !== null && json.backColor !== undefined) {\r\n            cellStyle.backColor = json.backColor;\r\n        }\r\n        //borders\r\n        //leftBorder\r\n        cellStyle.borders = new Borders();\r\n        //AllBorder\r\n        if (json.borders !== null && json.borders !== undefined) {\r\n            this.parserBorder(json.borders, cellStyle.borders.all);\r\n        }\r\n        //leftborder\r\n        if (json.leftBorder !== null && json.leftBorder !== undefined) {\r\n            this.parserBorder(json.leftBorder, cellStyle.borders.left);\r\n        }\r\n        //rightBorder\r\n        if (json.rightBorder !== null && json.rightBorder !== undefined) {\r\n            this.parserBorder(json.rightBorder, cellStyle.borders.right);\r\n        }\r\n        //topBorder\r\n        if (json.topBorder !== null && json.topBorder !== undefined) {\r\n            this.parserBorder(json.topBorder, cellStyle.borders.top);\r\n        }\r\n        //bottomBorder\r\n        if (json.bottomBorder !== null && json.bottomBorder !== undefined) {\r\n            this.parserBorder(json.bottomBorder, cellStyle.borders.bottom);\r\n        }\r\n        //fontName\r\n        if (json.fontName !== null && json.fontName !== undefined) {\r\n            cellStyle.fontName = json.fontName;\r\n        }\r\n        //fontSize\r\n        if (json.fontSize !== null && json.fontSize !== undefined) {\r\n            cellStyle.fontSize = json.fontSize;\r\n        }\r\n        //fontColor\r\n        if (json.fontColor !== null && json.fontColor !== undefined) {\r\n            cellStyle.fontColor = json.fontColor;\r\n        }\r\n        //italic\r\n        if (json.italic !== null && json.italic !== undefined) {\r\n            cellStyle.italic = json.italic;\r\n        }\r\n        //bold\r\n        if (json.bold !== null && json.bold !== undefined) {\r\n            cellStyle.bold = json.bold;\r\n        }\r\n        //hAlign\r\n        if (json.hAlign !== null && json.hAlign !== undefined) {\r\n            cellStyle.hAlign = json.hAlign.toLowerCase();\r\n        }\r\n        //indent\r\n        if (json.indent !== null && json.indent !== undefined) {\r\n            cellStyle.indent = json.indent;\r\n            if (!(cellStyle.hAlign === 'left' || cellStyle.hAlign === 'right')) {\r\n                cellStyle.hAlign = 'left';\r\n            }\r\n        }\r\n        if (json.rotation !== null && json.rotation !== undefined) {\r\n            cellStyle.rotation = json.rotation;\r\n        }\r\n        //vAlign\r\n        if (json.vAlign !== null && json.vAlign !== undefined) {\r\n            cellStyle.vAlign = json.vAlign.toLowerCase();\r\n        }\r\n        //underline\r\n        if (json.underline !== null && json.underline !== undefined) {\r\n            cellStyle.underline = json.underline;\r\n        }\r\n        //wrapText\r\n        if (json.wrapText !== null && json.wrapText !== undefined) {\r\n            cellStyle.wrapText = json.wrapText;\r\n        }\r\n        //numberFormat\r\n        if (json.numberFormat !== null && json.numberFormat !== undefined) {\r\n            if (json.type !== null && json.type !== undefined) {\r\n                cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, json.type);\r\n            }\r\n            else {\r\n                cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, cellType);\r\n            }\r\n        }\r\n        else if (defStyleIndex !== undefined) {\r\n            cellStyle.numFmtId = 14;\r\n            cellStyle.numberFormat = 'GENERAL';\r\n        }\r\n        else {\r\n            cellStyle.numberFormat = 'GENERAL';\r\n        }\r\n        cellStyle.index = this.processCellStyle(cellStyle);\r\n    };\r\n    Workbook.prototype.switchNumberFormat = function (numberFormat, type) {\r\n        var format = this.getNumberFormat(numberFormat, type);\r\n        if (format !== numberFormat) {\r\n            var numFmt = this.mNumFmt.get(numberFormat);\r\n            if (numFmt !== undefined) {\r\n                numFmt.formatCode = format;\r\n                if (this.mNumFmt.has(format)) {\r\n                    for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\r\n                        var cellStyleXfs = _a[_i];\r\n                        if (cellStyleXfs.numFmtId === numFmt.numFmtId) {\r\n                            cellStyleXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\r\n                        }\r\n                    }\r\n                    for (var _b = 0, _c = this.mCellXfs; _b < _c.length; _b++) {\r\n                        var cellXfs = _c[_b];\r\n                        if (cellXfs.numFmtId === numFmt.numFmtId) {\r\n                            cellXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Workbook.prototype.getNumberFormat = function (numberFormat, type) {\r\n        var returnFormat;\r\n        switch (type) {\r\n            case 'number':\r\n                try {\r\n                    returnFormat = this.intl.getNumberPattern({ format: numberFormat, currency: this.currency, useGrouping: true }, true);\r\n                }\r\n                catch (error) {\r\n                    returnFormat = numberFormat;\r\n                }\r\n                break;\r\n            case 'datetime':\r\n                try {\r\n                    returnFormat = this.intl.getDatePattern({ skeleton: numberFormat, type: 'dateTime' }, true);\r\n                }\r\n                catch (error) {\r\n                    try {\r\n                        returnFormat = this.intl.getDatePattern({ format: numberFormat, type: 'dateTime' }, true);\r\n                    }\r\n                    catch (error) {\r\n                        returnFormat = numberFormat;\r\n                    }\r\n                }\r\n                break;\r\n            case 'date':\r\n                try {\r\n                    returnFormat = this.intl.getDatePattern({ skeleton: numberFormat, type: 'date' }, true);\r\n                }\r\n                catch (error) {\r\n                    try {\r\n                        returnFormat = this.intl.getDatePattern({ format: numberFormat, type: 'date' }, true);\r\n                    }\r\n                    catch (error) {\r\n                        returnFormat = numberFormat;\r\n                    }\r\n                }\r\n                break;\r\n            case 'time':\r\n                try {\r\n                    returnFormat = this.intl.getDatePattern({ skeleton: numberFormat, type: 'time' }, true);\r\n                }\r\n                catch (error) {\r\n                    try {\r\n                        returnFormat = this.intl.getDatePattern({ format: numberFormat, type: 'time' }, true);\r\n                    }\r\n                    catch (error) {\r\n                        returnFormat = numberFormat;\r\n                    }\r\n                }\r\n                break;\r\n            default:\r\n                returnFormat = numberFormat;\r\n                break;\r\n        }\r\n        return returnFormat;\r\n    };\r\n    /* tslint:disable:no-any */\r\n    Workbook.prototype.parserBorder = function (json, border) {\r\n        if (json.color !== null && json.color !== undefined) {\r\n            border.color = json.color;\r\n        }\r\n        else {\r\n            border.color = '#000000';\r\n        }\r\n        if (json.lineStyle !== null && json.lineStyle !== undefined) {\r\n            border.lineStyle = json.lineStyle;\r\n        }\r\n        else {\r\n            border.lineStyle = 'thin';\r\n        }\r\n    };\r\n    Workbook.prototype.processCellStyle = function (style) {\r\n        if (style.isGlobalStyle) {\r\n            this.processNumFormatId(style);\r\n            this.mStyles.push(style);\r\n            return this.mStyles.length;\r\n        }\r\n        else {\r\n            var compareResult = this.compareStyle(style);\r\n            if (!compareResult.result) {\r\n                this.processNumFormatId(style);\r\n                this.mStyles.push(style);\r\n                return this.mStyles.length;\r\n            }\r\n            else {\r\n                //Return the index of the already existing style.\r\n                return compareResult.index;\r\n            }\r\n        }\r\n    };\r\n    Workbook.prototype.processNumFormatId = function (style) {\r\n        if (style.numberFormat !== 'GENERAL' && !this.mNumFmt.has(style.numberFormat)) {\r\n            var id = this.mNumFmt.size + 164;\r\n            this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\r\n        }\r\n    };\r\n    Workbook.prototype.isNewFont = function (toCompareStyle) {\r\n        var result = false;\r\n        var index = 0;\r\n        for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\r\n            var font = _a[_i];\r\n            index++;\r\n            var fontColor = undefined;\r\n            if (toCompareStyle.fontColor !== undefined) {\r\n                fontColor = ('FF' + toCompareStyle.fontColor.replace('#', ''));\r\n            }\r\n            result = font.color === fontColor &&\r\n                font.b === toCompareStyle.bold &&\r\n                font.i === toCompareStyle.italic &&\r\n                font.u === toCompareStyle.underline &&\r\n                font.name === toCompareStyle.fontName &&\r\n                font.sz === toCompareStyle.fontSize;\r\n            if (result) {\r\n                break;\r\n            }\r\n        }\r\n        index = index - 1;\r\n        return { index: index, result: result };\r\n    };\r\n    Workbook.prototype.isNewBorder = function (toCompareStyle) {\r\n        var bStyle = new CellStyle();\r\n        if (this.isAllBorder(toCompareStyle.borders)) {\r\n            return (bStyle.borders.all.color === toCompareStyle.borders.all.color &&\r\n                bStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle);\r\n        }\r\n        else {\r\n            return (bStyle.borders.left.color === toCompareStyle.borders.left.color &&\r\n                bStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle &&\r\n                bStyle.borders.right.color === toCompareStyle.borders.right.color &&\r\n                bStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle &&\r\n                bStyle.borders.top.color === toCompareStyle.borders.top.color &&\r\n                bStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle &&\r\n                bStyle.borders.bottom.color === toCompareStyle.borders.bottom.color &&\r\n                bStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle);\r\n        }\r\n    };\r\n    Workbook.prototype.isAllBorder = function (toCompareBorder) {\r\n        var allBorderStyle = new CellStyle();\r\n        return allBorderStyle.borders.all.color !== toCompareBorder.all.color &&\r\n            allBorderStyle.borders.all.lineStyle !== toCompareBorder.all.lineStyle;\r\n    };\r\n    Workbook.prototype.compareStyle = function (toCompareStyle) {\r\n        var result = true;\r\n        var index = 0;\r\n        var globalStyleIndex = 0;\r\n        for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\r\n            var baseStyle = _a[_i];\r\n            result = baseStyle.isGlobalStyle ? false : (baseStyle.backColor === toCompareStyle.backColor &&\r\n                baseStyle.bold === toCompareStyle.bold &&\r\n                baseStyle.numFmtId === toCompareStyle.numFmtId &&\r\n                baseStyle.numberFormat === toCompareStyle.numberFormat &&\r\n                baseStyle.type === toCompareStyle.type &&\r\n                baseStyle.fontColor === toCompareStyle.fontColor &&\r\n                baseStyle.fontName === toCompareStyle.fontName &&\r\n                baseStyle.fontSize === toCompareStyle.fontSize &&\r\n                baseStyle.hAlign === toCompareStyle.hAlign &&\r\n                baseStyle.italic === toCompareStyle.italic &&\r\n                baseStyle.underline === toCompareStyle.underline &&\r\n                baseStyle.vAlign === toCompareStyle.vAlign &&\r\n                baseStyle.indent === toCompareStyle.indent &&\r\n                baseStyle.rotation === toCompareStyle.rotation &&\r\n                baseStyle.wrapText === toCompareStyle.wrapText &&\r\n                (baseStyle.borders.all.color === toCompareStyle.borders.all.color &&\r\n                    baseStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle) &&\r\n                (baseStyle.borders.left.color === toCompareStyle.borders.left.color &&\r\n                    baseStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle &&\r\n                    baseStyle.borders.right.color === toCompareStyle.borders.right.color &&\r\n                    baseStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle &&\r\n                    baseStyle.borders.top.color === toCompareStyle.borders.top.color &&\r\n                    baseStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle &&\r\n                    baseStyle.borders.bottom.color === toCompareStyle.borders.bottom.color &&\r\n                    baseStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle));\r\n            if (result) {\r\n                index = baseStyle.index;\r\n                break;\r\n            }\r\n        }\r\n        return { index: index, result: result };\r\n    };\r\n    Workbook.prototype.contains = function (array, item) {\r\n        var index = array.indexOf(item);\r\n        return index > -1 && index < array.length;\r\n    };\r\n    Workbook.prototype.getCellValueType = function (value) {\r\n        if (value instanceof Date) {\r\n            return 'datetime';\r\n        }\r\n        else if (typeof (value) === 'boolean') {\r\n            return 'boolean';\r\n        }\r\n        else if (typeof (value) === 'number') {\r\n            return 'number';\r\n        }\r\n        else {\r\n            return 'string';\r\n        }\r\n    };\r\n    Workbook.prototype.parseCellType = function (cell) {\r\n        var type = cell.type;\r\n        var saveType;\r\n        var value = cell.value;\r\n        switch (type) {\r\n            case 'datetime':\r\n                value = this.toOADate(value);\r\n                if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\r\n                    if (this.globalStyles.has(cell.cellStyle.name)) {\r\n                        var value_1 = this.globalStyles.get(cell.cellStyle.name);\r\n                        this.switchNumberFormat(value_1.format, value_1.type);\r\n                    }\r\n                }\r\n                saveType = 'n';\r\n                break;\r\n            //TODO: Update the number format index and style\r\n            case 'boolean':\r\n                value = value ? 1 : 0;\r\n                saveType = 'b';\r\n                break;\r\n            case 'number':\r\n                saveType = 'n';\r\n                if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\r\n                    if (this.globalStyles.has(cell.cellStyle.name)) {\r\n                        this.switchNumberFormat(this.globalStyles.get(cell.cellStyle.name).format, 'number');\r\n                    }\r\n                }\r\n                break;\r\n            case 'string':\r\n                this.sharedStringCount++;\r\n                saveType = 's';\r\n                var sstvalue = this.processCellValue(value, cell);\r\n                if (!this.contains(this.sharedString, sstvalue)) {\r\n                    this.sharedString.push(sstvalue);\r\n                }\r\n                value = this.sharedString.indexOf(sstvalue);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        cell.saveType = saveType;\r\n        cell.value = value;\r\n    };\r\n    Workbook.prototype.parserImages = function (json, sheet) {\r\n        var imagesLength = json.length;\r\n        sheet.images = [];\r\n        var imageId = 0;\r\n        for (var p = 0; p < imagesLength; p++) {\r\n            var image = this.parserImage(json[p]);\r\n            sheet.images.push(image);\r\n        }\r\n    };\r\n    Workbook.prototype.parseFilters = function (json, sheet) {\r\n        sheet.autoFilters = new AutoFilters();\r\n        if (json.row !== null && json.row !== undefined)\r\n            sheet.autoFilters.row = json.row;\r\n        else\r\n            throw new Error('Argument Null Exception: row null or empty');\r\n        if (json.lastRow !== null && json.lastRow !== undefined)\r\n            sheet.autoFilters.lastRow = json.lastRow;\r\n        else\r\n            throw new Error('Argument Null Exception: lastRow cannot be null or empty');\r\n        if (json.column !== null && json.column !== undefined)\r\n            sheet.autoFilters.column = json.column;\r\n        else\r\n            throw new Error('Argument Null Exception: column cannot be null or empty');\r\n        if (json.lastColumn !== null && json.row !== undefined)\r\n            sheet.autoFilters.lastColumn = json.lastColumn;\r\n        else\r\n            throw new Error('Argument Null Exception: lastColumn cannot be null or empty');\r\n    };\r\n    Workbook.prototype.parserImage = function (json) {\r\n        var image = new Image();\r\n        if (json.image !== null && json.image !== undefined) {\r\n            image.image = json.image;\r\n        }\r\n        if (json.row !== null && json.row !== undefined) {\r\n            image.row = json.row;\r\n        }\r\n        if (json.column !== null && json.column !== undefined) {\r\n            image.column = json.column;\r\n        }\r\n        if (json.lastRow !== null && json.lastRow !== undefined) {\r\n            image.lastRow = json.lastRow;\r\n        }\r\n        if (json.lastColumn !== null && json.lastColumn !== undefined) {\r\n            image.lastColumn = json.lastColumn;\r\n        }\r\n        if (json.width !== null && json.width !== undefined) {\r\n            image.width = json.width;\r\n        }\r\n        if (json.height !== null && json.height !== undefined) {\r\n            image.height = json.height;\r\n        }\r\n        if (json.horizontalFlip !== null && json.horizontalFlip !== undefined) {\r\n            image.horizontalFlip = json.horizontalFlip;\r\n        }\r\n        if (json.verticalFlip !== null && json.verticalFlip !== undefined) {\r\n            image.verticalFlip = json.verticalFlip;\r\n        }\r\n        if (json.rotation !== null && json.rotation !== undefined) {\r\n            image.rotation = json.rotation;\r\n        }\r\n        return image;\r\n    };\r\n    Workbook.prototype.saveAsBlob = function (blobSaveType) {\r\n        var _this = this;\r\n        switch (blobSaveType) {\r\n            case 'text/csv':\r\n                return new Promise(function (resolve, reject) {\r\n                    var obj = {};\r\n                    obj.blobData = _this.csvHelper.saveAsBlob();\r\n                    resolve(obj);\r\n                });\r\n            default:\r\n                return new Promise(function (resolve, reject) {\r\n                    _this.saveInternal();\r\n                    _this.mArchive.saveAsBlob().then(function (blob) {\r\n                        var obj = {};\r\n                        obj.blobData = new Blob([blob], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\r\n                        resolve(obj);\r\n                    });\r\n                });\r\n        }\r\n    };\r\n    Workbook.prototype.save = function (fileName, proxyUrl) {\r\n        var _this = this;\r\n        if (fileName === null || fileName === undefined || fileName === '') {\r\n            throw new Error('Argument Null Exception: fileName cannot be null or empty');\r\n        }\r\n        var xlsxMatch = fileName.match('.xlsx$');\r\n        var csvMatch = fileName.match('.csv$');\r\n        if (xlsxMatch !== null && xlsxMatch[0] === ('.' + this.mSaveType)) {\r\n            this.saveInternal();\r\n            this.mArchive.save(fileName).then(function () {\r\n                _this.mArchive.destroy();\r\n            });\r\n        }\r\n        else if (csvMatch !== null && csvMatch[0] === ('.' + this.mSaveType)) {\r\n            this.csvHelper.save(fileName);\r\n        }\r\n        else {\r\n            throw Error('Save type and file extension is different.');\r\n        }\r\n    };\r\n    Workbook.prototype.saveInternal = function () {\r\n        this.saveWorkbook();\r\n        this.saveWorksheets();\r\n        this.saveSharedString();\r\n        this.saveStyles();\r\n        this.saveApp(this.builtInProperties);\r\n        this.saveCore(this.builtInProperties);\r\n        this.saveContentType();\r\n        this.saveTopLevelRelation();\r\n        this.saveWorkbookRelation();\r\n    };\r\n    Workbook.prototype.saveWorkbook = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var workbookTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><workbook xmlns:r = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns= \"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><workbookPr codeName=\"ThisWorkbook\" defaultThemeVersion= \"153222\"/><bookViews><workbookView activeTab=\"0\"/></bookViews>';\r\n        var sheets = '<sheets>';\r\n        var length = this.worksheets.length;\r\n        for (var i = 0; i < length; i++) {\r\n            /* tslint:disable-next-line:max-line-length */\r\n            var sheetName = this.worksheets[i].name;\r\n            sheetName = sheetName.replace(\"&\", \"&amp;\");\r\n            sheetName = sheetName.replace(\"<\", \"&lt;\");\r\n            sheetName = sheetName.replace(\">\", \"&gt;\");\r\n            sheetName = sheetName.replace(\"\\\"\", \"&quot;\");\r\n            sheets += '<sheet name=\"' + sheetName + '\" sheetId=\"' + (i + 1).toString() + '\" r:id =\"rId' + (i + 1).toString() + '\" />';\r\n        }\r\n        sheets += '</sheets>';\r\n        workbookTemp += sheets;\r\n        if (this.printTitles.size > 0) {\r\n            var printTitle_1 = '<definedNames>';\r\n            this.printTitles.forEach(function (value, key) {\r\n                printTitle_1 += '<definedName name=\"_xlnm.Print_Titles\" localSheetId=\"' + key + '\">' + value + '</definedName>';\r\n            });\r\n            printTitle_1 += '</definedNames>';\r\n            workbookTemp += printTitle_1;\r\n        }\r\n        this.addToArchive(workbookTemp + '</workbook>', 'xl/workbook.xml');\r\n    };\r\n    Workbook.prototype.saveWorksheets = function () {\r\n        var length = this.worksheets.length;\r\n        for (var i = 0; i < length; i++) {\r\n            this.saveWorksheet(this.worksheets[i], i);\r\n        }\r\n    };\r\n    Workbook.prototype.saveWorksheet = function (sheet, index) {\r\n        var sheetBlob = new BlobHelper();\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var sheetString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><worksheet xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns:x14=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\r\n        if (!sheet.isSummaryRowBelow) {\r\n            sheetString += ('<sheetPr>' + '<outlinePr ' + 'summaryBelow=\"0\" >' + '</outlinePr>' + '</sheetPr>');\r\n        }\r\n        else {\r\n            sheetString += ('<sheetPr />');\r\n        }\r\n        sheetString += this.saveSheetView(sheet);\r\n        if (sheet.columns !== undefined) {\r\n            var colString = '<cols>';\r\n            for (var _i = 0, _a = sheet.columns; _i < _a.length; _i++) {\r\n                var column = _a[_i];\r\n                /* tslint:disable-next-line:max-line-length */\r\n                if (column.width !== undefined) {\r\n                    colString += '<col min=\"' + (column.index) + '\" max=\"' + (column.index) + '\" width=\"' + this.pixelsToColumnWidth(column.width) + '\" customWidth=\"1\" />';\r\n                }\r\n                else {\r\n                    colString += '<col min=\"' + (column.index) + '\" max=\"' + (column.index) + '\" width=\"' + '8.43' + '\" customWidth=\"1\" />';\r\n                }\r\n            }\r\n            sheetString += (colString + '</cols>');\r\n        }\r\n        sheetString += ('<sheetData>');\r\n        sheetBlob.append(sheetString);\r\n        sheetString = '';\r\n        if (sheet.rows !== undefined) {\r\n            for (var _b = 0, _c = sheet.rows; _b < _c.length; _b++) {\r\n                var row = _c[_b];\r\n                var rowString = '<row r=\"' + (row.index) + '\" ';\r\n                if (!isNullOrUndefined(row.spans)) {\r\n                    rowString += 'spans=\"' + row.spans + '\" ';\r\n                }\r\n                if (row.height !== undefined) {\r\n                    rowString += ('ht=\"' + this.pixelsToRowHeight(row.height) + '\" customHeight=\"1\" ');\r\n                }\r\n                if (row.grouping !== undefined) {\r\n                    if (row.grouping.isHidden) {\r\n                        rowString += ('hidden=\"1\" ');\r\n                    }\r\n                    if (row.grouping.outlineLevel !== undefined) {\r\n                        rowString += ('outlineLevel=\"' + row.grouping.outlineLevel + '\" ');\r\n                    }\r\n                    if (row.grouping.isCollapsed) {\r\n                        rowString += ('collapsed=\"1\" ');\r\n                    }\r\n                }\r\n                rowString += ('>');\r\n                for (var _d = 0, _e = row.cells; _d < _e.length; _d++) {\r\n                    var cell = _e[_d];\r\n                    if (cell !== undefined && (cell.value !== undefined || cell.cellStyle !== undefined)) {\r\n                        rowString += ('<c r=\"' + cell.refName + '\" ');\r\n                        if (cell.saveType !== undefined) {\r\n                            rowString += ('t=\"' + cell.saveType + '\" ');\r\n                        }\r\n                        if (cell.styleIndex !== undefined) {\r\n                            rowString += ('s=\"' + cell.styleIndex + '\" ');\r\n                        }\r\n                        rowString += (' >');\r\n                        if (cell.formula !== undefined) {\r\n                            rowString += ('<f>' + cell.formula + '</f>');\r\n                        }\r\n                        if (cell.value !== undefined) {\r\n                            rowString += ('<v>' + cell.value + '</v></c>');\r\n                        }\r\n                        else {\r\n                            rowString += ('</c>');\r\n                        }\r\n                    }\r\n                }\r\n                rowString += ('</row>');\r\n                sheetBlob.append(rowString);\r\n            }\r\n        }\r\n        sheetString += ('</sheetData>');\r\n        /* tslint:disable-next-line:max-line-length */\r\n        if (sheet.autoFilters !== null && sheet.autoFilters !== undefined)\r\n            sheetString += ('<autoFilter ref=\"' + this.getCellName(sheet.autoFilters.row, sheet.autoFilters.column) + ':' + this.getCellName(sheet.autoFilters.lastRow, sheet.autoFilters.lastColumn) + '\"/>');\r\n        if (sheet.mergeCells.length > 0) {\r\n            sheetString += ('<mergeCells count=\"' + sheet.mergeCells.length + '\">');\r\n            for (var _f = 0, _g = sheet.mergeCells; _f < _g.length; _f++) {\r\n                var mCell = _g[_f];\r\n                sheetString += ('<mergeCell ref=\"' + mCell.ref + '\" />');\r\n            }\r\n            sheetString += ('</mergeCells>');\r\n        }\r\n        if (sheet.hyperLinks.length > 0) {\r\n            sheetString += ('<hyperlinks>');\r\n            for (var _h = 0, _j = sheet.hyperLinks; _h < _j.length; _h++) {\r\n                var hLink = _j[_h];\r\n                sheetString += ('<hyperlink ref=\"' + hLink.ref + '\" r:id=\"rId' + hLink.rId + '\" />');\r\n            }\r\n            sheetString += ('</hyperlinks>');\r\n        }\r\n        /* tslint:disable-next-line:max-line-length */\r\n        sheetString += ('<pageMargins left=\"0.75\" right=\"0.75\" top=\"1\" bottom=\"1\" header=\"0.5\" footer=\"0.5\" /><headerFooter scaleWithDoc=\"1\" alignWithMargins=\"0\" differentFirst=\"0\" differentOddEven=\"0\" />');\r\n        if (sheet.images != undefined && sheet.images.length > 0) {\r\n            this.drawingCount++;\r\n            this.saveDrawings(sheet, sheet.index);\r\n            sheetString += '<drawing r:id=\"rId' + (sheet.hyperLinks.length + 1) + '\"/>';\r\n        }\r\n        this.addToArchive(this.saveSheetRelations(sheet), ('xl/worksheets/_rels/sheet' + sheet.index + '.xml.rels'));\r\n        sheetBlob.append(sheetString + '</worksheet>');\r\n        this.addToArchive(sheetBlob.getBlob(), 'xl/worksheets' + '/sheet' + (index + 1) + '.xml');\r\n    };\r\n    Workbook.prototype.saveDrawings = function (sheet, index) {\r\n        var drawings = new BlobHelper();\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var sheetDrawingString = '<xdr:wsDr xmlns:xdr=\"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing\" xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">';\r\n        if (sheet.images !== undefined) {\r\n            var imgId = 0;\r\n            for (var _i = 0, _a = sheet.images; _i < _a.length; _i++) {\r\n                var pic = _a[_i];\r\n                if (pic.height !== undefined && pic.width !== undefined) {\r\n                    this.updatelastRowOffset(sheet, pic);\r\n                    this.updatelastColumnOffSet(sheet, pic);\r\n                }\r\n                else if (pic.lastRow !== undefined && pic.lastColumn !== undefined) {\r\n                    pic.lastRowOffset = 0;\r\n                    pic.lastColOffset = 0;\r\n                }\r\n                imgId++;\r\n                sheetDrawingString += '<xdr:twoCellAnchor editAs=\"oneCell\">';\r\n                sheetDrawingString += '<xdr:from><xdr:col>';\r\n                //col\r\n                sheetDrawingString += pic.column - 1;\r\n                sheetDrawingString += '</xdr:col><xdr:colOff>';\r\n                //colOff\r\n                sheetDrawingString += 0;\r\n                sheetDrawingString += '</xdr:colOff><xdr:row>';\r\n                //row\r\n                sheetDrawingString += pic.row - 1;\r\n                sheetDrawingString += '</xdr:row><xdr:rowOff>';\r\n                //rowOff\r\n                sheetDrawingString += 0;\r\n                sheetDrawingString += '</xdr:rowOff></xdr:from>';\r\n                sheetDrawingString += '<xdr:to><xdr:col>';\r\n                //col\r\n                sheetDrawingString += pic.lastColumn;\r\n                sheetDrawingString += '</xdr:col><xdr:colOff>';\r\n                //colOff\r\n                sheetDrawingString += pic.lastColOffset;\r\n                sheetDrawingString += '</xdr:colOff><xdr:row>';\r\n                //row\r\n                sheetDrawingString += pic.lastRow;\r\n                sheetDrawingString += '</xdr:row><xdr:rowOff>';\r\n                //rowOff\r\n                sheetDrawingString += pic.lastRowOffset;\r\n                sheetDrawingString += '</xdr:rowOff></xdr:to>';\r\n                sheetDrawingString += '<xdr:pic>';\r\n                sheetDrawingString += '<xdr:nvPicPr>';\r\n                sheetDrawingString += '<xdr:cNvPr id=\"' + imgId + '\" name=\"Picture ' + imgId + '\"> </xdr:cNvPr>';\r\n                sheetDrawingString += '<xdr:cNvPicPr><a:picLocks noChangeAspect=\"1\"/></xdr:cNvPicPr> </xdr:nvPicPr>';\r\n                sheetDrawingString += '<xdr:blipFill>';\r\n                /* tslint:disable-next-line:max-line-length */\r\n                sheetDrawingString += '<a:blip xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" r:embed=\"rId' + imgId + '\" cstate=\"print\">';\r\n                sheetDrawingString += '</a:blip><a:stretch><a:fillRect /></a:stretch></xdr:blipFill>';\r\n                sheetDrawingString += '<xdr:spPr>';\r\n                sheetDrawingString += '<a:xfrm';\r\n                if (pic.rotation != undefined && pic.rotation <= 3600 && pic.rotation >= -3600) {\r\n                    sheetDrawingString += ' rot=\"' + (pic.rotation * 60000) + '\"';\r\n                }\r\n                if (pic.verticalFlip != undefined && pic.verticalFlip != false) {\r\n                    sheetDrawingString += ' flipV=\"1\"';\r\n                }\r\n                if (pic.horizontalFlip != undefined && pic.horizontalFlip != false) {\r\n                    sheetDrawingString += ' flipH=\"1\"';\r\n                }\r\n                sheetDrawingString += '/>';\r\n                sheetDrawingString += '<a:prstGeom prst=\"rect\"><a:avLst /></a:prstGeom></xdr:spPr>';\r\n                sheetDrawingString += '</xdr:pic><xdr:clientData /></xdr:twoCellAnchor>';\r\n                var imageFile = new BlobHelper();\r\n                var imageData = this.convertBase64toImage(pic.image);\r\n                this.imageCount += 1;\r\n                this.addToArchive(imageData, 'xl/media/image' + this.imageCount + '.png');\r\n            }\r\n            drawings.append(sheetDrawingString);\r\n            drawings.append('</xdr:wsDr>');\r\n            this.saveDrawingRelations(sheet);\r\n            this.addToArchive(drawings.getBlob(), 'xl/drawings/drawing' + this.drawingCount + '.xml');\r\n        }\r\n    };\r\n    Workbook.prototype.updatelastRowOffset = function (sheet, picture) {\r\n        var iCurHeight = picture.height;\r\n        var iCurRow = picture.row;\r\n        var iCurOffset = 0;\r\n        while (iCurHeight >= 0) {\r\n            var iRowHeight = 0;\r\n            if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined)\r\n                iRowHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);\r\n            else\r\n                iRowHeight = this.convertToPixels(15);\r\n            var iSpaceInCell = iRowHeight - (iCurOffset * iRowHeight / 256);\r\n            if (iSpaceInCell > iCurHeight) {\r\n                picture.lastRow = iCurRow;\r\n                picture.lastRowOffset = iCurOffset + (iCurHeight * 256 / iRowHeight);\r\n                var rowHiddenHeight = 0;\r\n                if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined)\r\n                    rowHiddenHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);\r\n                else\r\n                    rowHiddenHeight = this.convertToPixels(15);\r\n                picture.lastRowOffset = (rowHiddenHeight * picture.lastRowOffset) / 256;\r\n                picture.lastRowOffset = Math.round(picture.lastRowOffset / this.unitsProportions[7]);\r\n                break;\r\n            }\r\n            else {\r\n                iCurHeight -= iSpaceInCell;\r\n                iCurRow++;\r\n                iCurOffset = 0;\r\n            }\r\n        }\r\n    };\r\n    Workbook.prototype.updatelastColumnOffSet = function (sheet, picture) {\r\n        var iCurWidth = picture.width;\r\n        var iCurCol = picture.column;\r\n        var iCurOffset = 0;\r\n        while (iCurWidth >= 0) {\r\n            var iColWidth = 0;\r\n            if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined)\r\n                iColWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol - 1].width);\r\n            else\r\n                iColWidth = this.ColumnWidthToPixels(8.43);\r\n            var iSpaceInCell = iColWidth - (iCurOffset * iColWidth / 1024);\r\n            if (iSpaceInCell > iCurWidth) {\r\n                picture.lastColumn = iCurCol;\r\n                picture.lastColOffset = iCurOffset + (iCurWidth * 1024 / iColWidth);\r\n                var colHiddenWidth = 0;\r\n                if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined)\r\n                    colHiddenWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol].width);\r\n                else\r\n                    colHiddenWidth = this.ColumnWidthToPixels(8.43);\r\n                picture.lastColOffset = (colHiddenWidth * picture.lastColOffset) / 1024;\r\n                picture.lastColOffset = Math.round(picture.lastColOffset / this.unitsProportions[7]);\r\n                break;\r\n            }\r\n            else {\r\n                iCurWidth -= iSpaceInCell;\r\n                iCurCol++;\r\n                iCurOffset = 0;\r\n            }\r\n        }\r\n    };\r\n    Workbook.prototype.convertToPixels = function (value) {\r\n        return value * this.unitsProportions[6];\r\n    };\r\n    Workbook.prototype.convertBase64toImage = function (img) {\r\n        var byteStr = window.atob(img);\r\n        var buffer = new ArrayBuffer(byteStr.length);\r\n        var data = new Uint8Array(buffer);\r\n        for (var i = 0; i < byteStr.length; i++) {\r\n            data[i] = byteStr.charCodeAt(i);\r\n        }\r\n        var blob = new Blob([data], { type: 'image/png' });\r\n        return blob;\r\n    };\r\n    Workbook.prototype.saveDrawingRelations = function (sheet) {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var drawingRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\r\n        var length = sheet.images.length;\r\n        var id = this.imageCount - sheet.images.length;\r\n        for (var i = 1; i <= length; i++) {\r\n            id++;\r\n            /* tslint:disable-next-line:max-line-length */\r\n            drawingRelation += '<Relationship Id=\"rId' + i + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"../media/image' + id + '.png\" />';\r\n        }\r\n        this.addToArchive((drawingRelation + '</Relationships>'), 'xl/drawings/_rels/drawing' + this.drawingCount + '.xml.rels');\r\n    };\r\n    Workbook.prototype.pixelsToColumnWidth = function (pixels) {\r\n        var dDigitWidth = 7;\r\n        var val = (pixels > dDigitWidth + 5) ?\r\n            this.trunc((pixels - 5) / dDigitWidth * 100 + 0.5) / 100 :\r\n            pixels / (dDigitWidth + 5);\r\n        return (val > 1) ?\r\n            ((val * dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0 :\r\n            (val * (dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0;\r\n    };\r\n    Workbook.prototype.ColumnWidthToPixels = function (val) {\r\n        var dDigitWidth = 7;\r\n        var fileWidth = (val > 1) ?\r\n            ((val * dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0 :\r\n            (val * (dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0;\r\n        return this.trunc(((256 * fileWidth + this.trunc(128 / dDigitWidth)) / 256) * dDigitWidth);\r\n    };\r\n    Workbook.prototype.trunc = function (x) {\r\n        var n = x - x % 1;\r\n        return n === 0 && (x < 0 || (x === 0 && (1 / x !== 1 / 0))) ? -0 : n;\r\n    };\r\n    Workbook.prototype.pixelsToRowHeight = function (pixels) {\r\n        return (pixels * this.unitsProportions[5] / this.unitsProportions[6]);\r\n    };\r\n    Workbook.prototype.saveSheetRelations = function (sheet) {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var relStr = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\r\n        for (var _i = 0, _a = sheet.hyperLinks; _i < _a.length; _i++) {\r\n            var hLink = _a[_i];\r\n            /* tslint:disable-next-line:max-line-length */\r\n            relStr += '<Relationship Id=\"rId' + hLink.rId + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink\" Target=\"' + this.processString(hLink.target) + '\" TargetMode=\"External\" />';\r\n        }\r\n        if (sheet.images != undefined && sheet.images.length > 0) {\r\n            /* tslint:disable-next-line:max-line-length */\r\n            relStr += '<Relationship Id=\"rId' + (sheet.hyperLinks.length + 1) + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing\" Target=\"../drawings/drawing' + this.drawingCount + '.xml\" />';\r\n        }\r\n        relStr += '</Relationships>';\r\n        return relStr;\r\n    };\r\n    Workbook.prototype.saveSheetView = function (sheet) {\r\n        var paneString = '<sheetViews><sheetView workbookViewId=\"0\" ';\r\n        if (sheet.enableRtl === true) {\r\n            paneString += 'rightToLeft=\"1\"';\r\n        }\r\n        if (sheet.showGridLines === false) {\r\n            paneString += 'showGridLines=\"0\" >';\r\n        }\r\n        else {\r\n            paneString += '>';\r\n        }\r\n        if (sheet.freezePanes !== undefined) {\r\n            paneString += '<pane state=\"frozen\"' +\r\n                ' topLeftCell=\"' + sheet.freezePanes.leftCell + '\" ';\r\n            if (sheet.freezePanes.row !== 0) {\r\n                paneString += 'ySplit=\"' + sheet.freezePanes.row + '\" ';\r\n            }\r\n            if (sheet.freezePanes.column !== 0) {\r\n                paneString += 'xSplit=\"' + sheet.freezePanes.column + '\" ';\r\n            }\r\n            paneString += '/>';\r\n        }\r\n        paneString += '</sheetView></sheetViews > ';\r\n        return paneString;\r\n    };\r\n    Workbook.prototype.saveSharedString = function () {\r\n        var length = this.sharedString.length;\r\n        if (length > 0) {\r\n            /* tslint:disable-next-line:max-line-length */\r\n            var sstStart = '<?xml version=\"1.0\" encoding=\"utf-8\"?><sst uniqueCount=\"' + length + '\" count=\"' + this.sharedStringCount + '\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\r\n            var si = '';\r\n            for (var i = 0; i < length; i++) {\r\n                if (this.sharedString[i].indexOf('<r>') !== 0) {\r\n                    si += '<si><t>';\r\n                    si += this.processString(this.sharedString[i]);\r\n                    si += '</t></si>';\r\n                }\r\n                else {\r\n                    si += '<si>';\r\n                    si += this.sharedString[i];\r\n                    si += '</si>';\r\n                }\r\n            }\r\n            si += '</sst>';\r\n            this.addToArchive(sstStart + si, 'xl/sharedStrings.xml');\r\n        }\r\n    };\r\n    Workbook.prototype.processString = function (value) {\r\n        if (value.indexOf('&') !== -1) {\r\n            value = value.replace(/&/g, '&amp;');\r\n        }\r\n        if (value.indexOf('<') !== -1) {\r\n            value = value.replace(/</g, '&lt;');\r\n        }\r\n        if (value.indexOf('>') !== -1) {\r\n            value = value.replace(/>/g, '&gt;');\r\n        }\r\n        return value;\r\n    };\r\n    Workbook.prototype.saveStyles = function () {\r\n        this.updateCellXfsStyleXfs();\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var styleTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><styleSheet xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" mc:Ignorable=\"x14ac\" xmlns:x14ac=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\r\n        styleTemp += this.saveNumberFormats();\r\n        styleTemp += this.saveFonts();\r\n        styleTemp += this.saveFills();\r\n        styleTemp += this.saveBorders();\r\n        styleTemp += this.saveCellStyleXfs();\r\n        styleTemp += this.saveCellXfs();\r\n        styleTemp += this.saveCellStyles();\r\n        this.addToArchive(styleTemp + '</styleSheet>', 'xl/styles.xml');\r\n    };\r\n    Workbook.prototype.updateCellXfsStyleXfs = function () {\r\n        for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\r\n            var style = _a[_i];\r\n            var cellXfs = undefined;\r\n            if (style.isGlobalStyle) {\r\n                cellXfs = new CellStyleXfs();\r\n                cellXfs.xfId = (style.index - 1);\r\n            }\r\n            else {\r\n                cellXfs = new CellXfs();\r\n                cellXfs.xfId = 0;\r\n            }\r\n            //Add font\r\n            var compareFontResult = this.isNewFont(style);\r\n            if (!compareFontResult.result) {\r\n                var font = new Font();\r\n                font.b = style.bold;\r\n                font.i = style.italic;\r\n                font.name = style.fontName;\r\n                font.sz = style.fontSize;\r\n                font.u = style.underline;\r\n                font.color = ('FF' + style.fontColor.replace('#', ''));\r\n                this.mFonts.push(font);\r\n                cellXfs.fontId = this.mFonts.length - 1;\r\n            }\r\n            else {\r\n                cellXfs.fontId = compareFontResult.index;\r\n            }\r\n            //Add fill\r\n            if (style.backColor !== 'none') {\r\n                var backColor = 'FF' + style.backColor.replace('#', '');\r\n                if (this.mFills.has(backColor)) {\r\n                    var fillId = this.mFills.get(backColor);\r\n                    cellXfs.fillId = fillId;\r\n                }\r\n                else {\r\n                    var fillId = this.mFills.size + 2;\r\n                    this.mFills.set(backColor, fillId);\r\n                    cellXfs.fillId = (fillId);\r\n                }\r\n            }\r\n            else {\r\n                cellXfs.fillId = 0;\r\n            }\r\n            //Add border            \r\n            if (!this.isNewBorder(style)) {\r\n                this.mBorders.push(style.borders);\r\n                cellXfs.borderId = this.mBorders.length;\r\n            }\r\n            else {\r\n                cellXfs.borderId = 0;\r\n            }\r\n            //Add Number Format            \r\n            if (style.numberFormat !== 'GENERAL') {\r\n                if (this.mNumFmt.has(style.numberFormat)) {\r\n                    var numFmt = this.mNumFmt.get(style.numberFormat);\r\n                    cellXfs.numFmtId = numFmt.numFmtId;\r\n                }\r\n                else {\r\n                    var id = this.mNumFmt.size + 164;\r\n                    this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\r\n                    cellXfs.numFmtId = id;\r\n                }\r\n            }\r\n            else {\r\n                if (style.numberFormat === 'GENERAL' && style.numFmtId === 14) {\r\n                    cellXfs.numFmtId = 14;\r\n                }\r\n                else {\r\n                    cellXfs.numFmtId = 0;\r\n                }\r\n            }\r\n            //Add alignment            \r\n            if (!style.isGlobalStyle) {\r\n                cellXfs.applyAlignment = 1;\r\n            }\r\n            cellXfs.alignment = new Alignment();\r\n            cellXfs.alignment.indent = style.indent;\r\n            cellXfs.alignment.horizontal = style.hAlign;\r\n            cellXfs.alignment.vertical = style.vAlign;\r\n            cellXfs.alignment.wrapText = style.wrapText ? 1 : 0;\r\n            cellXfs.alignment.rotation = style.rotation;\r\n            if (style.isGlobalStyle) {\r\n                this.mCellStyleXfs.push(cellXfs);\r\n                this.mCellXfs.push(cellXfs);\r\n            }\r\n            else {\r\n                //Add cellxfs\r\n                this.mCellXfs.push(cellXfs);\r\n            }\r\n        }\r\n    };\r\n    Workbook.prototype.saveNumberFormats = function () {\r\n        if (this.mNumFmt.size >= 1) {\r\n            var numFmtStyle_1 = '<numFmts count=\"' + (this.mNumFmt.size) + '\">';\r\n            this.mNumFmt.forEach(function (value, key) {\r\n                numFmtStyle_1 += '<numFmt numFmtId=\"' + value.numFmtId + '\" formatCode=\"' + value.formatCode.replace(/\"/g, '&quot;') + '\" />';\r\n            });\r\n            return (numFmtStyle_1 += '</numFmts>');\r\n        }\r\n        else {\r\n            return '';\r\n        }\r\n    };\r\n    Workbook.prototype.saveFonts = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var fontStyle = '<fonts count=\"' + (this.mFonts.length) + '\">';\r\n        if (this.mFonts.length >= 1) {\r\n            for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\r\n                var font = _a[_i];\r\n                fontStyle += '<font>';\r\n                if (font.b) {\r\n                    fontStyle += '<b />';\r\n                }\r\n                if (font.i) {\r\n                    fontStyle += '<i />';\r\n                }\r\n                if (font.u) {\r\n                    fontStyle += '<u />';\r\n                }\r\n                fontStyle += '<sz val=\"' + font.sz + '\" />';\r\n                fontStyle += '<color rgb=\"' + font.color + '\" />';\r\n                fontStyle += '<name val=\"' + font.name + '\" /></font>';\r\n            }\r\n        }\r\n        return fontStyle + '</fonts>';\r\n    };\r\n    Workbook.prototype.saveFills = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var fillsStyle = '<fills count=\"' + (this.mFills.size + 2) + '\"><fill><patternFill patternType=\"none\"></patternFill></fill><fill><patternFill patternType=\"gray125\"></patternFill></fill>';\r\n        if (this.mFills.size >= 1) {\r\n            this.mFills.forEach(function (value, key) {\r\n                /* tslint:disable-next-line:max-line-length */\r\n                fillsStyle += '<fill><patternFill patternType=\"solid\"><fgColor rgb=\"' + key + '\" /><bgColor rgb=\"FFFFFFFF\" /></patternFill></fill>';\r\n            });\r\n        }\r\n        return fillsStyle + '</fills>';\r\n    };\r\n    Workbook.prototype.saveBorders = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var bordersStyle = '<borders count=\"' + (this.mBorders.length + 1) + '\"><border><left /><right /><top /><bottom /><diagonal /></border>';\r\n        if (this.mBorders.length >= 1) {\r\n            for (var _i = 0, _a = this.mBorders; _i < _a.length; _i++) {\r\n                var borders = _a[_i];\r\n                if (this.isAllBorder(borders)) {\r\n                    var color = borders.all.color.replace('#', '');\r\n                    var lineStyle = borders.all.lineStyle;\r\n                    /* tslint:disable-next-line:max-line-length */\r\n                    bordersStyle += '<border><left style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></left><right style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></right><top style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></top><bottom style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></bottom></border>';\r\n                }\r\n                else {\r\n                    /* tslint:disable-next-line:max-line-length */\r\n                    bordersStyle += '<border><left style=\"' + borders.left.lineStyle + '\"><color rgb=\"FF' + borders.left.color.replace('#', '') + '\" /></left><right style=\"' + borders.right.lineStyle + '\"><color rgb=\"FF' + borders.right.color.replace('#', '') + '\" /></right><top style=\"' + borders.top.lineStyle + '\"><color rgb=\"FF' + borders.top.color.replace('#', '') + '\" /></top><bottom style=\"' + borders.bottom.lineStyle + '\"><color rgb=\"FF' + borders.bottom.color.replace('#', '') + '\" /></bottom></border>';\r\n                }\r\n            }\r\n        }\r\n        return bordersStyle + '</borders>';\r\n    };\r\n    Workbook.prototype.saveCellStyles = function () {\r\n        var _this = this;\r\n        var cellStyleString = '<cellStyles  count=\"' + (this.cellStyles.size) + '\">';\r\n        this.cellStyles.forEach(function (value, key) {\r\n            cellStyleString += '<cellStyle name=\"' + key + '\" xfId=\"' + _this.cellStyles.get(key).xfId + '\"';\r\n            if (key === 'Normal') {\r\n                cellStyleString += ' builtinId=\"0\"';\r\n            }\r\n            cellStyleString += ' />';\r\n        });\r\n        return cellStyleString += '</cellStyles>';\r\n    };\r\n    Workbook.prototype.saveCellStyleXfs = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var cellXfsStyle = '<cellStyleXfs count=\"' + (this.mCellStyleXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" />';\r\n        if (this.mCellStyleXfs.length >= 1) {\r\n            for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\r\n                var cellStyleXf = _a[_i];\r\n                /* tslint:disable-next-line:max-line-length */\r\n                cellXfsStyle += '<xf numFmtId=\"' + cellStyleXf.numFmtId + '\" fontId=\"' + cellStyleXf.fontId + '\" fillId=\"' + cellStyleXf.fillId + '\" borderId=\"' + cellStyleXf.borderId + '\" ';\r\n                if (cellStyleXf.alignment !== undefined) {\r\n                    cellXfsStyle += '>' + this.saveAlignment(cellStyleXf) + '</xf>';\r\n                }\r\n                else {\r\n                    cellXfsStyle += ' />';\r\n                }\r\n            }\r\n        }\r\n        return cellXfsStyle + '</cellStyleXfs>';\r\n    };\r\n    Workbook.prototype.saveCellXfs = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var cellXfsStyle = '<cellXfs count=\"' + (this.mCellXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" xfId=\"0\" />';\r\n        if (this.mCellXfs.length >= 1) {\r\n            for (var _i = 0, _a = this.mCellXfs; _i < _a.length; _i++) {\r\n                var cellXf = _a[_i];\r\n                /* tslint:disable-next-line:max-line-length */\r\n                cellXfsStyle += '<xf numFmtId=\"' + cellXf.numFmtId + '\" fontId=\"' + cellXf.fontId + '\" fillId=\"' + cellXf.fillId + '\" borderId=\"' + cellXf.borderId + '\" xfId=\"' + cellXf.xfId + '\" ';\r\n                if (cellXf.applyAlignment === 1) {\r\n                    cellXfsStyle += 'applyAlignment=\"1\"';\r\n                }\r\n                cellXfsStyle += '>' + this.saveAlignment(cellXf) + '</xf>';\r\n            }\r\n        }\r\n        return cellXfsStyle + '</cellXfs>';\r\n    };\r\n    Workbook.prototype.saveAlignment = function (cellXf) {\r\n        var alignString = '<alignment ';\r\n        if (cellXf.alignment.horizontal !== undefined) {\r\n            alignString += 'horizontal=\"' + cellXf.alignment.horizontal + '\" ';\r\n        }\r\n        if (cellXf.alignment.indent !== undefined && cellXf.alignment.indent !== 0) {\r\n            alignString += 'indent=\"' + cellXf.alignment.indent + '\" ';\r\n        }\r\n        else if (cellXf.alignment.rotation !== undefined && cellXf.alignment.rotation !== 0) {\r\n            alignString += 'textRotation=\"' + cellXf.alignment.rotation + '\" ';\r\n        }\r\n        if (cellXf.alignment.vertical !== undefined) {\r\n            alignString += 'vertical=\"' + cellXf.alignment.vertical + '\" ';\r\n        }\r\n        alignString += 'wrapText=\"' + cellXf.alignment.wrapText + '\" />';\r\n        return alignString;\r\n    };\r\n    Workbook.prototype.saveApp = function (builtInProperties) {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var appString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Properties xmlns=\"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties\"><Application>Essential XlsIO</Application>';\r\n        if (builtInProperties !== undefined) {\r\n            if (builtInProperties.manager !== undefined) {\r\n                appString += '<Manager>' + builtInProperties.manager + '</Manager>';\r\n            }\r\n            if (builtInProperties.company !== undefined) {\r\n                appString += '<Company>' + builtInProperties.company + '</Company>';\r\n            }\r\n        }\r\n        this.addToArchive((appString + '</Properties>'), 'docProps/app.xml');\r\n    };\r\n    Workbook.prototype.saveCore = function (builtInProperties) {\r\n        var createdDate = new Date();\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var coreString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><cp:coreProperties xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns:dcmitype=\"http://purl.org/dc/dcmitype/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:cp=\"http://schemas.openxmlformats.org/package/2006/metadata/core-properties\">';\r\n        if (this.builtInProperties !== undefined) {\r\n            if (builtInProperties.author !== undefined) {\r\n                coreString += '<dc:creator>' + builtInProperties.author + '</dc:creator>';\r\n            }\r\n            if (builtInProperties.subject !== undefined) {\r\n                coreString += '<dc:subject>' + builtInProperties.subject + '</dc:subject>';\r\n            }\r\n            if (builtInProperties.category !== undefined) {\r\n                coreString += '<cp:category>' + builtInProperties.category + '</cp:category>';\r\n            }\r\n            if (builtInProperties.comments !== undefined) {\r\n                coreString += '<dc:description>' + builtInProperties.comments + '</dc:description>';\r\n            }\r\n            if (builtInProperties.title !== undefined) {\r\n                coreString += '<dc:title>' + builtInProperties.title + '</dc:title>';\r\n            }\r\n            if (builtInProperties.tags !== undefined) {\r\n                coreString += '<cp:keywords>' + builtInProperties.tags + '</cp:keywords>';\r\n            }\r\n            if (builtInProperties.status !== undefined) {\r\n                coreString += '<cp:contentStatus>' + builtInProperties.status + '</cp:contentStatus>';\r\n            }\r\n            if (builtInProperties.createdDate !== undefined) {\r\n                /* tslint:disable-next-line:max-line-length */\r\n                coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.createdDate.toISOString() + '</dcterms:created>';\r\n            }\r\n            else {\r\n                coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\r\n            }\r\n            if (builtInProperties.modifiedDate !== undefined) {\r\n                /* tslint:disable-next-line:max-line-length */\r\n                coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.modifiedDate.toISOString() + '</dcterms:modified>';\r\n            }\r\n            else {\r\n                coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\r\n            }\r\n        }\r\n        else {\r\n            coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\r\n            coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\r\n        }\r\n        /* tslint:disable-next-line:max-line-length */\r\n        coreString += '</cp:coreProperties>';\r\n        this.addToArchive(coreString, 'docProps/core.xml');\r\n    };\r\n    Workbook.prototype.saveTopLevelRelation = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var topRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\"><Relationship Id=\"rId1\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\" Target=\"xl/workbook.xml\" /><Relationship Id=\"rId2\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties\" Target=\"docProps/app.xml\" /><Relationship Id=\"rId3\" Type=\"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties\" Target=\"docProps/core.xml\" /></Relationships>';\r\n        this.addToArchive(topRelation, '_rels/.rels');\r\n    };\r\n    Workbook.prototype.saveWorkbookRelation = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var wbRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\r\n        var length = this.worksheets.length;\r\n        var count = 0;\r\n        for (var i = 0; i < length; i++, count++) {\r\n            /* tslint:disable-next-line:max-line-length */\r\n            wbRelation += '<Relationship Id=\"rId' + (i + 1).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet\" Target=\"worksheets/sheet' + (i + 1).toString() + '.xml\" />';\r\n        }\r\n        /* tslint:disable-next-line:max-line-length */\r\n        wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles\" Target=\"styles.xml\" />';\r\n        if (this.sharedStringCount > 0) {\r\n            /* tslint:disable-next-line:max-line-length */\r\n            wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings\" Target=\"sharedStrings.xml\" />';\r\n        }\r\n        this.addToArchive((wbRelation + '</Relationships>'), 'xl/_rels/workbook.xml.rels');\r\n    };\r\n    Workbook.prototype.saveContentType = function () {\r\n        /* tslint:disable-next-line:max-line-length */\r\n        var contentTypeString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\"><Default Extension=\"xml\" ContentType=\"application/xml\" /><Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\" /><Override PartName=\"/xl/styles.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml\" /><Override PartName=\"/xl/workbook.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\" /><Override PartName=\"/docProps/app.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.extended-properties+xml\" /><Override PartName=\"/docProps/core.xml\" ContentType=\"application/vnd.openxmlformats-package.core-properties+xml\" />';\r\n        var sheetsOverride = '';\r\n        var length = this.worksheets.length;\r\n        for (var i = 0; i < length; i++) {\r\n            /* tslint:disable-next-line:max-line-length */\r\n            sheetsOverride += '<Override PartName=\"/xl/worksheets/sheet' + (i + 1).toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\" />';\r\n            if (this.worksheets[i].images != undefined && this.worksheets[i].images.length > 0) {\r\n                /* tslint:disable-next-line:max-line-length */\r\n                sheetsOverride += '<Override PartName=\"/xl/drawings/drawing' + (i + 1).toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.drawing+xml\" />';\r\n            }\r\n        }\r\n        if (this.imageCount > 0)\r\n            sheetsOverride += '<Default Extension=\"png\" ContentType=\"image/png\" />';\r\n        if (this.sharedStringCount > 0) {\r\n            /* tslint:disable-next-line:max-line-length */\r\n            contentTypeString += '<Override PartName=\"/xl/sharedStrings.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml\" />';\r\n        }\r\n        this.addToArchive((contentTypeString + sheetsOverride + '</Types>'), '[Content_Types].xml');\r\n    };\r\n    Workbook.prototype.addToArchive = function (xmlString, itemName) {\r\n        if (typeof (xmlString) === 'string') {\r\n            var blob = new Blob([xmlString], { type: 'text/plain' });\r\n            var archiveItem = new ZipArchiveItem(blob, itemName);\r\n            this.mArchive.addItem(archiveItem);\r\n        }\r\n        else {\r\n            var archiveItem = new ZipArchiveItem(xmlString, itemName);\r\n            this.mArchive.addItem(archiveItem);\r\n        }\r\n    };\r\n    Workbook.prototype.processMergeCells = function (cell, rowIndex, mergeCells) {\r\n        if (cell.rowSpan !== 0 || cell.colSpan !== 0) {\r\n            var mCell = new MergeCell();\r\n            mCell.x = cell.index;\r\n            mCell.width = cell.colSpan;\r\n            mCell.y = rowIndex;\r\n            mCell.height = cell.rowSpan;\r\n            var startCell = this.getCellName(mCell.y, mCell.x);\r\n            var endCell = this.getCellName(rowIndex + mCell.height, cell.index + mCell.width);\r\n            mCell.ref = startCell + ':' + endCell;\r\n            var mergedCell = mergeCells.add(mCell);\r\n            var start = { x: mCell.x, y: mCell.y };\r\n            var end = {\r\n                x: (cell.index + mCell.width), y: (rowIndex + mCell.height)\r\n            };\r\n            this.updatedMergedCellStyles(start, end, cell);\r\n        }\r\n        return mergeCells;\r\n    };\r\n    Workbook.prototype.updatedMergedCellStyles = function (sCell, eCell, cell) {\r\n        for (var x = sCell.x; x <= eCell.x; x++) {\r\n            for (var y = sCell.y; y <= eCell.y; y++) {\r\n                this.mergedCellsStyle.set(this.getCellName(y, x), { x: x, y: y, styleIndex: cell.styleIndex });\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns the tick count corresponding to the given year, month, and day.\r\n     * @param year number value of year\r\n     * @param month number value of month\r\n     * @param day number value of day\r\n     */\r\n    Workbook.prototype.dateToTicks = function (year, month, day) {\r\n        var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\r\n        var daysToMonth365 = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];\r\n        var daysToMonth366 = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366];\r\n        if (year >= 1 && year <= 9999 && month >= 1 && month <= 12) {\r\n            var days = this.isLeapYear(year) ? daysToMonth366 : daysToMonth365;\r\n            var y = year - 1;\r\n            var n = y * 365 + ((y / 4) | 0) - ((y / 100) | 0) + ((y / 400) | 0) + days[month - 1] + day - 1;\r\n            return n * ticksPerDay;\r\n        }\r\n        throw new Error('Not a valid date');\r\n    };\r\n    /**\r\n     * Return the tick count corresponding to the given hour, minute, second.\r\n     * @param hour number value of hour\r\n     * @param minute number value if minute\r\n     * @param second number value of second\r\n     */\r\n    Workbook.prototype.timeToTicks = function (hour, minute, second) {\r\n        if (hour >= 0 && hour < 24 && minute >= 0 && minute < 60 && second >= 0 && second < 60) {\r\n            var totalSeconds = hour * 3600 + minute * 60 + second;\r\n            return totalSeconds * 10000 * 1000;\r\n        }\r\n        throw new Error('Not valid time');\r\n    };\r\n    /**\r\n     * Checks if given year is a leap year.\r\n     * @param year Year value.\r\n     */\r\n    Workbook.prototype.isLeapYear = function (year) {\r\n        return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);\r\n    };\r\n    /**\r\n     * Converts `DateTime` to the equivalent OLE Automation date.\r\n     */\r\n    Workbook.prototype.toOADate = function (date) {\r\n        var ticks = 0;\r\n        /* tslint:disable-next-line:max-line-length */\r\n        ticks = this.dateToTicks(date.getFullYear(), (date.getMonth() + 1), date.getDate()) + this.timeToTicks(date.getHours(), date.getMinutes(), date.getSeconds());\r\n        if (ticks === 0) {\r\n            return 0.0;\r\n        }\r\n        var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\r\n        var daysTo1899 = (((365 * 4 + 1) * 25 - 1) * 4 + 1) * 4 + ((365 * 4 + 1) * 25 - 1) * 3 - 367;\r\n        var doubleDateOffset = daysTo1899 * ticksPerDay;\r\n        var oaDateMinAsTicks = (((365 * 4 + 1) * 25 - 1) - 365) * ticksPerDay;\r\n        if (ticks < oaDateMinAsTicks) {\r\n            throw new Error('Arg_OleAutDateInvalid');\r\n        }\r\n        var millisPerDay = 1000 * 60 * 60 * 24;\r\n        return ((ticks - doubleDateOffset) / 10000) / millisPerDay;\r\n    };\r\n    return Workbook;\r\n}());\r\nexport { Workbook };\r\n/**\r\n * BuiltInProperties Class\r\n * @private\r\n */\r\nvar BuiltInProperties = /** @class */ (function () {\r\n    function BuiltInProperties() {\r\n    }\r\n    return BuiltInProperties;\r\n}());\r\nexport { BuiltInProperties };\r\n"]},"metadata":{},"sourceType":"module"}