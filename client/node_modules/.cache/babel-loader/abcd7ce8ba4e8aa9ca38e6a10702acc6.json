{"ast":null,"code":"/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module typing/delete\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport DeleteCommand from './deletecommand';\nimport DeleteObserver from './deleteobserver';\nimport env from '@ckeditor/ckeditor5-utils/src/env';\n/**\n * The delete and backspace feature. Handles the <kbd>Delete</kbd> and <kbd>Backspace</kbd> keys in the editor.\n *\n * @extends module:core/plugin~Plugin\n */\n\nexport default class Delete extends Plugin {\n  /**\n   * Whether pressing backspace should trigger undo action\n   *\n   * @private\n   * @member {Boolean} #_undoOnBackspace\n   */\n\n  /**\n   * @inheritDoc\n   */\n  static get pluginName() {\n    return 'Delete';\n  }\n\n  init() {\n    const editor = this.editor;\n    const view = editor.editing.view;\n    const viewDocument = view.document;\n    const modelDocument = editor.model.document;\n    view.addObserver(DeleteObserver);\n    this._undoOnBackspace = false;\n    const deleteForwardCommand = new DeleteCommand(editor, 'forward'); // Register `deleteForward` command and add `forwardDelete` command as an alias for backward compatibility.\n\n    editor.commands.add('deleteForward', deleteForwardCommand);\n    editor.commands.add('forwardDelete', deleteForwardCommand);\n    editor.commands.add('delete', new DeleteCommand(editor, 'backward'));\n    this.listenTo(viewDocument, 'delete', (evt, data) => {\n      const deleteCommandParams = {\n        unit: data.unit,\n        sequence: data.sequence\n      }; // If a specific (view) selection to remove was set, convert it to a model selection and set as a parameter for `DeleteCommand`.\n\n      if (data.selectionToRemove) {\n        const modelSelection = editor.model.createSelection();\n        const ranges = [];\n\n        for (const viewRange of data.selectionToRemove.getRanges()) {\n          ranges.push(editor.editing.mapper.toModelRange(viewRange));\n        }\n\n        modelSelection.setTo(ranges);\n        deleteCommandParams.selection = modelSelection;\n      }\n\n      editor.execute(data.direction == 'forward' ? 'deleteForward' : 'delete', deleteCommandParams);\n      data.preventDefault();\n      view.scrollToTheSelection();\n    }, {\n      priority: 'low'\n    }); // Android IMEs have a quirk - they change DOM selection after the input changes were performed by the browser.\n    // This happens on `keyup` event. Android doesn't know anything about our deletion and selection handling. Even if the selection\n    // was changed during input events, IME remembers the position where the selection \"should\" be placed and moves it there.\n    //\n    // To prevent incorrect selection, we save the selection after deleting here and then re-set it on `keyup`. This has to be done\n    // on DOM selection level, because on `keyup` the model selection is still the same as it was just after deletion, so it\n    // wouldn't be changed and the fix would do nothing.\n    //\n\n    if (env.isAndroid) {\n      let domSelectionAfterDeletion = null;\n      this.listenTo(viewDocument, 'delete', (evt, data) => {\n        const domSelection = data.domTarget.ownerDocument.defaultView.getSelection();\n        domSelectionAfterDeletion = {\n          anchorNode: domSelection.anchorNode,\n          anchorOffset: domSelection.anchorOffset,\n          focusNode: domSelection.focusNode,\n          focusOffset: domSelection.focusOffset\n        };\n      }, {\n        priority: 'lowest'\n      });\n      this.listenTo(viewDocument, 'keyup', (evt, data) => {\n        if (domSelectionAfterDeletion) {\n          const domSelection = data.domTarget.ownerDocument.defaultView.getSelection();\n          domSelection.collapse(domSelectionAfterDeletion.anchorNode, domSelectionAfterDeletion.anchorOffset);\n          domSelection.extend(domSelectionAfterDeletion.focusNode, domSelectionAfterDeletion.focusOffset);\n          domSelectionAfterDeletion = null;\n        }\n      });\n    }\n\n    if (this.editor.plugins.has('UndoEditing')) {\n      this.listenTo(viewDocument, 'delete', (evt, data) => {\n        if (this._undoOnBackspace && data.direction == 'backward' && data.sequence == 1 && data.unit == 'codePoint') {\n          this._undoOnBackspace = false;\n          editor.execute('undo');\n          data.preventDefault();\n          evt.stop();\n        }\n      }, {\n        context: '$capture'\n      });\n      this.listenTo(modelDocument, 'change', () => {\n        this._undoOnBackspace = false;\n      });\n    }\n  }\n  /**\n   * If the next user action after calling this method is pressing backspace, it would undo the last change.\n   *\n   * Requires {@link module:undo/undoediting~UndoEditing} plugin. If not loaded, does nothing.\n   */\n\n\n  requestUndoOnBackspace() {\n    if (this.editor.plugins.has('UndoEditing')) {\n      this._undoOnBackspace = true;\n    }\n  }\n\n}","map":{"version":3,"sources":["D:/Project/nhap_mon_cnpm/my-app/node_modules/@ckeditor/ckeditor5-typing/src/delete.js"],"names":["Plugin","DeleteCommand","DeleteObserver","env","Delete","pluginName","init","editor","view","editing","viewDocument","document","modelDocument","model","addObserver","_undoOnBackspace","deleteForwardCommand","commands","add","listenTo","evt","data","deleteCommandParams","unit","sequence","selectionToRemove","modelSelection","createSelection","ranges","viewRange","getRanges","push","mapper","toModelRange","setTo","selection","execute","direction","preventDefault","scrollToTheSelection","priority","isAndroid","domSelectionAfterDeletion","domSelection","domTarget","ownerDocument","defaultView","getSelection","anchorNode","anchorOffset","focusNode","focusOffset","collapse","extend","plugins","has","stop","context","requestUndoOnBackspace"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module typing/delete\n */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport DeleteCommand from './deletecommand';\nimport DeleteObserver from './deleteobserver';\nimport env from '@ckeditor/ckeditor5-utils/src/env';\n\n/**\n * The delete and backspace feature. Handles the <kbd>Delete</kbd> and <kbd>Backspace</kbd> keys in the editor.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class Delete extends Plugin {\n\t/**\n\t * Whether pressing backspace should trigger undo action\n\t *\n\t * @private\n\t * @member {Boolean} #_undoOnBackspace\n\t */\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'Delete';\n\t}\n\n\tinit() {\n\t\tconst editor = this.editor;\n\t\tconst view = editor.editing.view;\n\t\tconst viewDocument = view.document;\n\t\tconst modelDocument = editor.model.document;\n\n\t\tview.addObserver( DeleteObserver );\n\n\t\tthis._undoOnBackspace = false;\n\n\t\tconst deleteForwardCommand = new DeleteCommand( editor, 'forward' );\n\n\t\t// Register `deleteForward` command and add `forwardDelete` command as an alias for backward compatibility.\n\t\teditor.commands.add( 'deleteForward', deleteForwardCommand );\n\t\teditor.commands.add( 'forwardDelete', deleteForwardCommand );\n\n\t\teditor.commands.add( 'delete', new DeleteCommand( editor, 'backward' ) );\n\n\t\tthis.listenTo( viewDocument, 'delete', ( evt, data ) => {\n\t\t\tconst deleteCommandParams = { unit: data.unit, sequence: data.sequence };\n\n\t\t\t// If a specific (view) selection to remove was set, convert it to a model selection and set as a parameter for `DeleteCommand`.\n\t\t\tif ( data.selectionToRemove ) {\n\t\t\t\tconst modelSelection = editor.model.createSelection();\n\t\t\t\tconst ranges = [];\n\n\t\t\t\tfor ( const viewRange of data.selectionToRemove.getRanges() ) {\n\t\t\t\t\tranges.push( editor.editing.mapper.toModelRange( viewRange ) );\n\t\t\t\t}\n\n\t\t\t\tmodelSelection.setTo( ranges );\n\n\t\t\t\tdeleteCommandParams.selection = modelSelection;\n\t\t\t}\n\n\t\t\teditor.execute( data.direction == 'forward' ? 'deleteForward' : 'delete', deleteCommandParams );\n\n\t\t\tdata.preventDefault();\n\n\t\t\tview.scrollToTheSelection();\n\t\t}, { priority: 'low' } );\n\n\t\t// Android IMEs have a quirk - they change DOM selection after the input changes were performed by the browser.\n\t\t// This happens on `keyup` event. Android doesn't know anything about our deletion and selection handling. Even if the selection\n\t\t// was changed during input events, IME remembers the position where the selection \"should\" be placed and moves it there.\n\t\t//\n\t\t// To prevent incorrect selection, we save the selection after deleting here and then re-set it on `keyup`. This has to be done\n\t\t// on DOM selection level, because on `keyup` the model selection is still the same as it was just after deletion, so it\n\t\t// wouldn't be changed and the fix would do nothing.\n\t\t//\n\t\tif ( env.isAndroid ) {\n\t\t\tlet domSelectionAfterDeletion = null;\n\n\t\t\tthis.listenTo( viewDocument, 'delete', ( evt, data ) => {\n\t\t\t\tconst domSelection = data.domTarget.ownerDocument.defaultView.getSelection();\n\n\t\t\t\tdomSelectionAfterDeletion = {\n\t\t\t\t\tanchorNode: domSelection.anchorNode,\n\t\t\t\t\tanchorOffset: domSelection.anchorOffset,\n\t\t\t\t\tfocusNode: domSelection.focusNode,\n\t\t\t\t\tfocusOffset: domSelection.focusOffset\n\t\t\t\t};\n\t\t\t}, { priority: 'lowest' } );\n\n\t\t\tthis.listenTo( viewDocument, 'keyup', ( evt, data ) => {\n\t\t\t\tif ( domSelectionAfterDeletion ) {\n\t\t\t\t\tconst domSelection = data.domTarget.ownerDocument.defaultView.getSelection();\n\n\t\t\t\t\tdomSelection.collapse( domSelectionAfterDeletion.anchorNode, domSelectionAfterDeletion.anchorOffset );\n\t\t\t\t\tdomSelection.extend( domSelectionAfterDeletion.focusNode, domSelectionAfterDeletion.focusOffset );\n\n\t\t\t\t\tdomSelectionAfterDeletion = null;\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.editor.plugins.has( 'UndoEditing' ) ) {\n\t\t\tthis.listenTo( viewDocument, 'delete', ( evt, data ) => {\n\t\t\t\tif ( this._undoOnBackspace && data.direction == 'backward' && data.sequence == 1 && data.unit == 'codePoint' ) {\n\t\t\t\t\tthis._undoOnBackspace = false;\n\n\t\t\t\t\teditor.execute( 'undo' );\n\n\t\t\t\t\tdata.preventDefault();\n\t\t\t\t\tevt.stop();\n\t\t\t\t}\n\t\t\t}, { context: '$capture' } );\n\n\t\t\tthis.listenTo( modelDocument, 'change', () => {\n\t\t\t\tthis._undoOnBackspace = false;\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * If the next user action after calling this method is pressing backspace, it would undo the last change.\n\t *\n\t * Requires {@link module:undo/undoediting~UndoEditing} plugin. If not loaded, does nothing.\n\t */\n\trequestUndoOnBackspace() {\n\t\tif ( this.editor.plugins.has( 'UndoEditing' ) ) {\n\t\t\tthis._undoOnBackspace = true;\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}