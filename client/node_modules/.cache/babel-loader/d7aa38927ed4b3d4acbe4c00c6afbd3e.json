{"ast":null,"code":"/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module ui/toolbar/toolbarview\n */\nimport View from '../view';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport FocusCycler from '../focuscycler';\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\nimport ToolbarSeparatorView from './toolbarseparatorview';\nimport ToolbarLineBreakView from './toolbarlinebreakview';\nimport ResizeObserver from '@ckeditor/ckeditor5-utils/src/dom/resizeobserver';\nimport preventDefault from '../bindings/preventdefault.js';\nimport Rect from '@ckeditor/ckeditor5-utils/src/dom/rect';\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\nimport { createDropdown, addToolbarToDropdown } from '../dropdown/utils';\nimport { logWarning } from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport normalizeToolbarConfig from './normalizetoolbarconfig';\nimport threeVerticalDots from '@ckeditor/ckeditor5-core/theme/icons/three-vertical-dots.svg';\nimport '../../theme/components/toolbar/toolbar.css';\n/**\n * The toolbar view class.\n *\n * @extends module:ui/view~View\n * @implements module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable\n */\n\nexport default class ToolbarView extends View {\n  /**\n   * Creates an instance of the {@link module:ui/toolbar/toolbarview~ToolbarView} class.\n   *\n   * Also see {@link #render}.\n   *\n   * @param {module:utils/locale~Locale} locale The localization services instance.\n   * @param {module:ui/toolbar/toolbarview~ToolbarOptions} [options] Configuration options of the toolbar.\n   */\n  constructor(locale, options) {\n    super(locale);\n    const bind = this.bindTemplate;\n    const t = this.t;\n    /**\n     * A reference to the options object passed to the constructor.\n     *\n     * @readonly\n     * @member {module:ui/toolbar/toolbarview~ToolbarOptions}\n     */\n\n    this.options = options || {};\n    /**\n     * Label used by assistive technologies to describe this toolbar element.\n     *\n     * @default 'Editor toolbar'\n     * @member {String} #ariaLabel\n     */\n\n    this.set('ariaLabel', t('Editor toolbar'));\n    /**\n     * The maximum width of the toolbar element.\n     *\n     * **Note**: When set to a specific value (e.g. `'200px'`), the value will affect the behavior of the\n     * {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull}\n     * option by changing the number of {@link #items} that will be displayed in the toolbar at a time.\n     *\n     * @observable\n     * @default 'auto'\n     * @member {String} #maxWidth\n     */\n\n    this.set('maxWidth', 'auto');\n    /**\n     * A collection of toolbar items (buttons, dropdowns, etc.).\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.items = this.createCollection();\n    /**\n     * Tracks information about the DOM focus in the toolbar.\n     *\n     * @readonly\n     * @member {module:utils/focustracker~FocusTracker}\n     */\n\n    this.focusTracker = new FocusTracker();\n    /**\n     * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}\n     * to handle keyboard navigation in the toolbar.\n     *\n     * @readonly\n     * @member {module:utils/keystrokehandler~KeystrokeHandler}\n     */\n\n    this.keystrokes = new KeystrokeHandler();\n    /**\n     * An additional CSS class added to the {@link #element}.\n     *\n     * @observable\n     * @member {String} #class\n     */\n\n    this.set('class');\n    /**\n     * When set true, makes the toolbar look compact with {@link #element}.\n     *\n     * @observable\n     * @default false\n     * @member {String} #isCompact\n     */\n\n    this.set('isCompact', false);\n    /**\n     * A (child) view containing {@link #items toolbar items}.\n     *\n     * @readonly\n     * @member {module:ui/toolbar/toolbarview~ItemsView}\n     */\n\n    this.itemsView = new ItemsView(locale);\n    /**\n     * A top–level collection aggregating building blocks of the toolbar.\n     *\n     *\t┌───────────────── ToolbarView ─────────────────┐\n     *\t| ┌──────────────── #children ────────────────┐ |\n     *\t| |   ┌──────────── #itemsView ───────────┐   | |\n     *\t| |   | [ item1 ] [ item2 ] ... [ itemN ] |   | |\n     *\t| |   └──────────────────────────────────-┘   | |\n     *\t| └───────────────────────────────────────────┘ |\n     *\t└───────────────────────────────────────────────┘\n     *\n     * By default, it contains the {@link #itemsView} but it can be extended with additional\n     * UI elements when necessary.\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.children = this.createCollection();\n    this.children.add(this.itemsView);\n    /**\n     * A collection of {@link #items} that take part in the focus cycling\n     * (i.e. navigation using the keyboard). Usually, it contains a subset of {@link #items} with\n     * some optional UI elements that also belong to the toolbar and should be focusable\n     * by the user.\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.focusables = this.createCollection();\n    /**\n     * Controls the orientation of toolbar items. Only available when\n     * {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull dynamic items grouping}\n     * is **disabled**.\n     *\n     * @observable\n     * @member {Boolean} #isVertical\n     */\n\n    /**\n     * Helps cycling over {@link #focusables focusable items} in the toolbar.\n     *\n     * @readonly\n     * @protected\n     * @member {module:ui/focuscycler~FocusCycler}\n     */\n\n    const isRtl = locale.uiLanguageDirection === 'rtl';\n    this._focusCycler = new FocusCycler({\n      focusables: this.focusables,\n      focusTracker: this.focusTracker,\n      keystrokeHandler: this.keystrokes,\n      actions: {\n        // Navigate toolbar items backwards using the arrow[left,up] keys.\n        focusPrevious: [isRtl ? 'arrowright' : 'arrowleft', 'arrowup'],\n        // Navigate toolbar items forwards using the arrow[right,down] keys.\n        focusNext: [isRtl ? 'arrowleft' : 'arrowright', 'arrowdown']\n      }\n    });\n    const classes = ['ck', 'ck-toolbar', bind.to('class'), bind.if('isCompact', 'ck-toolbar_compact')];\n\n    if (this.options.shouldGroupWhenFull && this.options.isFloating) {\n      classes.push('ck-toolbar_floating');\n    }\n\n    this.setTemplate({\n      tag: 'div',\n      attributes: {\n        class: classes,\n        role: 'toolbar',\n        'aria-label': bind.to('ariaLabel'),\n        style: {\n          maxWidth: bind.to('maxWidth')\n        }\n      },\n      children: this.children,\n      on: {\n        // https://github.com/ckeditor/ckeditor5-ui/issues/206\n        mousedown: preventDefault(this)\n      }\n    });\n    /**\n     * An instance of the active toolbar behavior that shapes its look and functionality.\n     *\n     * See {@link module:ui/toolbar/toolbarview~ToolbarBehavior} to learn more.\n     *\n     * @protected\n     * @readonly\n     * @member {module:ui/toolbar/toolbarview~ToolbarBehavior}\n     */\n\n    this._behavior = this.options.shouldGroupWhenFull ? new DynamicGrouping(this) : new StaticLayout(this);\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  render() {\n    super.render(); // Children added before rendering should be known to the #focusTracker.\n\n    for (const item of this.items) {\n      this.focusTracker.add(item.element);\n    }\n\n    this.items.on('add', (evt, item) => {\n      this.focusTracker.add(item.element);\n    });\n    this.items.on('remove', (evt, item) => {\n      this.focusTracker.remove(item.element);\n    }); // Start listening for the keystrokes coming from #element.\n\n    this.keystrokes.listenTo(this.element);\n\n    this._behavior.render(this);\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  destroy() {\n    this._behavior.destroy();\n\n    return super.destroy();\n  }\n  /**\n   * Focuses the first focusable in {@link #focusables}.\n   */\n\n\n  focus() {\n    this._focusCycler.focusFirst();\n  }\n  /**\n   * Focuses the last focusable in {@link #focusables}.\n   */\n\n\n  focusLast() {\n    this._focusCycler.focusLast();\n  }\n  /**\n   * A utility that expands the plain toolbar configuration into\n   * {@link module:ui/toolbar/toolbarview~ToolbarView#items} using a given component factory.\n   *\n   * @param {Array.<String>|Object} itemsOrConfig The toolbar items or the entire toolbar configuration object.\n   * @param {module:ui/componentfactory~ComponentFactory} factory A factory producing toolbar items.\n   */\n\n\n  fillFromConfig(itemsOrConfig, factory) {\n    const config = normalizeToolbarConfig(itemsOrConfig);\n    const itemsToClean = config.items.filter((name, idx, items) => {\n      if (name === '|') {\n        return true;\n      } // Items listed in `config.removeItems` should not be added to the toolbar.\n\n\n      if (config.removeItems.indexOf(name) !== -1) {\n        return false;\n      }\n\n      if (name === '-') {\n        // The toolbar line breaks must not be rendered when toolbar grouping is enabled.\n        // (https://github.com/ckeditor/ckeditor5/issues/8582)\n        if (this.options.shouldGroupWhenFull) {\n          /**\n           * The toolbar multiline breaks (`-` items) only work when the automatic button grouping\n           * is disabled in the toolbar configuration.\n           * To do this, set the `shouldNotGroupWhenFull` option to `true` in the editor configuration:\n           *\n           *\t\tconst config = {\n           *\t\t\ttoolbar: {\n           *\t\t\t\titems: [ ... ],\n           *\t\t\t\tshouldNotGroupWhenFull: true\n           *\t\t\t}\n           *\t\t}\n           *\n           * Learn more about {@link module:core/editor/editorconfig~EditorConfig#toolbar toolbar configuration}.\n           *\n           * @error toolbarview-line-break-ignored-when-grouping-items\n           */\n          logWarning('toolbarview-line-break-ignored-when-grouping-items', items);\n          return false;\n        }\n\n        return true;\n      } // For the items that cannot be instantiated we are sending warning message. We also filter them out.\n\n\n      if (!factory.has(name)) {\n        /**\n         * There was a problem processing the configuration of the toolbar. The item with the given\n         * name does not exist so it was omitted when rendering the toolbar.\n         *\n         * This warning usually shows up when the {@link module:core/plugin~Plugin} which is supposed\n         * to provide a toolbar item has not been loaded or there is a typo in the configuration.\n         *\n         * Make sure the plugin responsible for this toolbar item is loaded and the toolbar configuration\n         * is correct, e.g. {@link module:basic-styles/bold~Bold} is loaded for the `'bold'` toolbar item.\n         *\n         * You can use the following snippet to retrieve all available toolbar items:\n         *\n         *\t\tArray.from( editor.ui.componentFactory.names() );\n         *\n         * @error toolbarview-item-unavailable\n         * @param {String} name The name of the component.\n         */\n        logWarning('toolbarview-item-unavailable', {\n          name\n        });\n        return false;\n      }\n\n      return true;\n    });\n\n    const itemsToAdd = this._cleanSeparators(itemsToClean) // Instantiate toolbar items.\n    .map(name => {\n      if (name === '|') {\n        return new ToolbarSeparatorView();\n      } else if (name === '-') {\n        return new ToolbarLineBreakView();\n      }\n\n      return factory.create(name);\n    });\n\n    this.items.addMany(itemsToAdd);\n  }\n  /**\n   * Remove leading, trailing, and duplicated separators (`-` and `|`).\n   *\n   * @private\n   * @param {Array.<String>} items\n   */\n\n\n  _cleanSeparators(items) {\n    const nonSeparatorPredicate = item => item !== '-' && item !== '|';\n\n    const count = items.length; // Find an index of the first item that is not a separator.\n\n    const firstCommandItem = items.findIndex(nonSeparatorPredicate); // Search from the end of the list, then convert found index back to the original direction.\n\n    const lastCommandItem = count - items.slice().reverse().findIndex(nonSeparatorPredicate);\n    return items // Return items without the leading and trailing separators.\n    .slice(firstCommandItem, lastCommandItem) // Remove duplicated separators.\n    .filter((name, idx, items) => {\n      // Filter only separators.\n      if (nonSeparatorPredicate(name)) {\n        return true;\n      }\n\n      const isDuplicated = idx > 0 && items[idx - 1] === name;\n      return !isDuplicated;\n    });\n  }\n  /**\n   * Fired when some toolbar {@link #items} were grouped or ungrouped as a result of some change\n   * in the toolbar geometry.\n   *\n   * **Note**: This event is always fired **once** regardless of the number of items that were be\n   * grouped or ungrouped at a time.\n   *\n   * **Note**: This event is fired only if the items grouping functionality was enabled in\n   * the first place (see {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull}).\n   *\n   * @event groupedItemsUpdate\n   */\n\n\n}\n/**\n * An inner block of the {@link module:ui/toolbar/toolbarview~ToolbarView} hosting its\n * {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n *\n * @private\n * @extends module:ui/view~View\n */\n\nclass ItemsView extends View {\n  /**\n   * @inheritDoc\n   */\n  constructor(locale) {\n    super(locale);\n    /**\n     * A collection of items (buttons, dropdowns, etc.).\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.children = this.createCollection();\n    this.setTemplate({\n      tag: 'div',\n      attributes: {\n        class: ['ck', 'ck-toolbar__items']\n      },\n      children: this.children\n    });\n  }\n\n}\n/**\n * A toolbar behavior that makes it static and unresponsive to the changes of the environment.\n * At the same time, it also makes it possible to display a toolbar with a vertical layout\n * using the {@link module:ui/toolbar/toolbarview~ToolbarView#isVertical} property.\n *\n * @private\n * @implements module:ui/toolbar/toolbarview~ToolbarBehavior\n */\n\n\nclass StaticLayout {\n  /**\n   * Creates an instance of the {@link module:ui/toolbar/toolbarview~StaticLayout} toolbar\n   * behavior.\n   *\n   * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n   * is added to.\n   */\n  constructor(view) {\n    const bind = view.bindTemplate; // Static toolbar can be vertical when needed.\n\n    view.set('isVertical', false); // 1:1 pass–through binding, all ToolbarView#items are visible.\n\n    view.itemsView.children.bindTo(view.items).using(item => item); // 1:1 pass–through binding, all ToolbarView#items are focusable.\n\n    view.focusables.bindTo(view.items).using(item => item);\n    view.extendTemplate({\n      attributes: {\n        class: [// When vertical, the toolbar has an additional CSS class.\n        bind.if('isVertical', 'ck-toolbar_vertical')]\n      }\n    });\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  render() {}\n  /**\n   * @inheritDoc\n   */\n\n\n  destroy() {}\n\n}\n/**\n * A toolbar behavior that makes the items respond to changes in the geometry.\n *\n * In a nutshell, it groups {@link module:ui/toolbar/toolbarview~ToolbarView#items}\n * that do not fit visually into a single row of the toolbar (due to limited space).\n * Items that do not fit are aggregated in a dropdown displayed at the end of the toolbar.\n *\n *\t┌──────────────────────────────────────── ToolbarView ──────────────────────────────────────────┐\n *\t| ┌─────────────────────────────────────── #children ─────────────────────────────────────────┐ |\n *\t| |   ┌─────── #itemsView ────────┐ ┌──────────────────────┐ ┌── #groupedItemsDropdown ───┐   | |\n *\t| |   |       #ungroupedItems     | | ToolbarSeparatorView | |        #groupedItems       |   | |\n *\t| |   └──────────────────────────-┘ └──────────────────────┘ └────────────────────────────┘   | |\n *\t| |                                  \\---------- only when toolbar items overflow --------/    | |\n *\t| └───────────────────────────────────────────────────────────────────────────────────────────┘ |\n *\t└───────────────────────────────────────────────────────────────────────────────────────────────┘\n *\n * @private\n * @implements module:ui/toolbar/toolbarview~ToolbarBehavior\n */\n\n\nclass DynamicGrouping {\n  /**\n   * Creates an instance of the {@link module:ui/toolbar/toolbarview~DynamicGrouping} toolbar\n   * behavior.\n   *\n   * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n   * is added to.\n   */\n  constructor(view) {\n    /**\n     * A toolbar view this behavior belongs to.\n     *\n     * @readonly\n     * @member {module:ui/toolbar~ToolbarView}\n     */\n    this.view = view;\n    /**\n     * A collection of toolbar children.\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.viewChildren = view.children;\n    /**\n     * A collection of focusable toolbar elements.\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.viewFocusables = view.focusables;\n    /**\n     * A view containing toolbar items.\n     *\n     * @readonly\n     * @member {module:ui/toolbar/toolbarview~ItemsView}\n     */\n\n    this.viewItemsView = view.itemsView;\n    /**\n     * Toolbar focus tracker.\n     *\n     * @readonly\n     * @member {module:utils/focustracker~FocusTracker}\n     */\n\n    this.viewFocusTracker = view.focusTracker;\n    /**\n     * Toolbar locale.\n     *\n     * @readonly\n     * @member {module:utils/locale~Locale}\n     */\n\n    this.viewLocale = view.locale;\n    /**\n     * Toolbar element.\n     *\n     * @readonly\n     * @member {HTMLElement} #viewElement\n     */\n\n    /**\n     * A subset of toolbar {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n     * Aggregates items that fit into a single row of the toolbar and were not {@link #groupedItems grouped}\n     * into a {@link #groupedItemsDropdown dropdown}. Items of this collection are displayed in the\n     * {@link module:ui/toolbar/toolbarview~ToolbarView#itemsView}.\n     *\n     * When none of the {@link module:ui/toolbar/toolbarview~ToolbarView#items} were grouped, it\n     * matches the {@link module:ui/toolbar/toolbarview~ToolbarView#items} collection in size and order.\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.ungroupedItems = view.createCollection();\n    /**\n     * A subset of toolbar {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n     * A collection of the toolbar items that do not fit into a single row of the toolbar.\n     * Grouped items are displayed in a dedicated {@link #groupedItemsDropdown dropdown}.\n     *\n     * When none of the {@link module:ui/toolbar/toolbarview~ToolbarView#items} were grouped,\n     * this collection is empty.\n     *\n     * @readonly\n     * @member {module:ui/viewcollection~ViewCollection}\n     */\n\n    this.groupedItems = view.createCollection();\n    /**\n     * The dropdown that aggregates {@link #groupedItems grouped items} that do not fit into a single\n     * row of the toolbar. It is displayed on demand as the last of\n     * {@link module:ui/toolbar/toolbarview~ToolbarView#children toolbar children} and offers another\n     * (nested) toolbar which displays items that would normally overflow.\n     *\n     * @readonly\n     * @member {module:ui/dropdown/dropdownview~DropdownView}\n     */\n\n    this.groupedItemsDropdown = this._createGroupedItemsDropdown();\n    /**\n     * An instance of the resize observer that helps dynamically determine the geometry of the toolbar\n     * and manage items that do not fit into a single row.\n     *\n     * **Note:** Created in {@link #_enableGroupingOnResize}.\n     *\n     * @readonly\n     * @member {module:utils/dom/resizeobserver~ResizeObserver}\n     */\n\n    this.resizeObserver = null;\n    /**\n     * A cached value of the horizontal padding style used by {@link #_updateGrouping}\n     * to manage the {@link module:ui/toolbar/toolbarview~ToolbarView#items} that do not fit into\n     * a single toolbar line. This value can be reused between updates because it is unlikely that\n     * the padding will change and re–using `Window.getComputedStyle()` is expensive.\n     *\n     * @readonly\n     * @member {Number}\n     */\n\n    this.cachedPadding = null;\n    /**\n     * A flag indicating that an items grouping update has been queued (e.g. due to the toolbar being visible)\n     * and should be executed immediately the next time the toolbar shows up.\n     *\n     * @readonly\n     * @member {Boolean}\n     */\n\n    this.shouldUpdateGroupingOnNextResize = false; // Only those items that were not grouped are visible to the user.\n\n    view.itemsView.children.bindTo(this.ungroupedItems).using(item => item); // Make sure all #items visible in the main space of the toolbar are \"focuscycleable\".\n\n    this.ungroupedItems.on('add', this._updateFocusCycleableItems.bind(this));\n    this.ungroupedItems.on('remove', this._updateFocusCycleableItems.bind(this)); // Make sure the #groupedItemsDropdown is also included in cycling when it appears.\n\n    view.children.on('add', this._updateFocusCycleableItems.bind(this));\n    view.children.on('remove', this._updateFocusCycleableItems.bind(this)); // ToolbarView#items is dynamic. When an item is added or removed, it should be automatically\n    // represented in either grouped or ungrouped items at the right index.\n    // In other words #items == concat( #ungroupedItems, #groupedItems )\n    // (in length and order).\n\n    view.items.on('change', (evt, changeData) => {\n      const index = changeData.index; // Removing.\n\n      for (const removedItem of changeData.removed) {\n        if (index >= this.ungroupedItems.length) {\n          this.groupedItems.remove(removedItem);\n        } else {\n          this.ungroupedItems.remove(removedItem);\n        }\n      } // Adding.\n\n\n      for (let currentIndex = index; currentIndex < index + changeData.added.length; currentIndex++) {\n        const addedItem = changeData.added[currentIndex - index];\n\n        if (currentIndex > this.ungroupedItems.length) {\n          this.groupedItems.add(addedItem, currentIndex - this.ungroupedItems.length);\n        } else {\n          this.ungroupedItems.add(addedItem, currentIndex);\n        }\n      } // When new ungrouped items join in and land in #ungroupedItems, there's a chance it causes\n      // the toolbar to overflow.\n      // Consequently if removed from grouped or ungrouped items, there is a chance\n      // some new space is available and we could do some ungrouping.\n\n\n      this._updateGrouping();\n    });\n    view.extendTemplate({\n      attributes: {\n        class: [// To group items dynamically, the toolbar needs a dedicated CSS class.\n        'ck-toolbar_grouping']\n      }\n    });\n  }\n  /**\n   * Enables dynamic items grouping based on the dimensions of the toolbar.\n   *\n   * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n   * is added to.\n   */\n\n\n  render(view) {\n    this.viewElement = view.element;\n\n    this._enableGroupingOnResize();\n\n    this._enableGroupingOnMaxWidthChange(view);\n  }\n  /**\n   * Cleans up the internals used by this behavior.\n   */\n\n\n  destroy() {\n    // The dropdown may not be in ToolbarView#children at the moment of toolbar destruction\n    // so let's make sure it's actually destroyed along with the toolbar.\n    this.groupedItemsDropdown.destroy();\n    this.resizeObserver.destroy();\n  }\n  /**\n   * When called, it will check if any of the {@link #ungroupedItems} do not fit into a single row of the toolbar,\n   * and it will move them to the {@link #groupedItems} when it happens.\n   *\n   * At the same time, it will also check if there is enough space in the toolbar for the first of the\n   * {@link #groupedItems} to be returned back to {@link #ungroupedItems} and still fit into a single row\n   * without the toolbar wrapping.\n   *\n   * @protected\n   */\n\n\n  _updateGrouping() {\n    // Do no grouping–related geometry analysis when the toolbar is detached from visible DOM,\n    // for instance before #render(), or after render but without a parent or a parent detached\n    // from DOM. DOMRects won't work anyway and there will be tons of warning in the console and\n    // nothing else. This happens, for instance, when the toolbar is detached from DOM and\n    // some logic adds or removes its #items.\n    if (!this.viewElement.ownerDocument.body.contains(this.viewElement)) {\n      return;\n    } // Do not update grouping when the element is invisible. Such toolbar has DOMRect filled with zeros\n    // and that would cause all items to be grouped. Instead, queue the grouping so it runs next time\n    // the toolbar is visible (the next ResizeObserver callback execution). This is handy because\n    // the grouping could be caused by increasing the #maxWidth when the toolbar was invisible and the next\n    // time it shows up, some items could actually be ungrouped (https://github.com/ckeditor/ckeditor5/issues/6575).\n\n\n    if (!this.viewElement.offsetParent) {\n      this.shouldUpdateGroupingOnNextResize = true;\n      return;\n    } // Remember how many items were initially grouped so at the it is possible to figure out if the number\n    // of grouped items has changed. If the number has changed, geometry of the toolbar has also changed.\n\n\n    const initialGroupedItemsCount = this.groupedItems.length;\n    let wereItemsGrouped; // Group #items as long as some wrap to the next row. This will happen, for instance,\n    // when the toolbar is getting narrow and there is not enough space to display all items in\n    // a single row.\n\n    while (this._areItemsOverflowing) {\n      this._groupLastItem();\n\n      wereItemsGrouped = true;\n    } // If none were grouped now but there were some items already grouped before,\n    // then, what the hell, maybe let's see if some of them can be ungrouped. This happens when,\n    // for instance, the toolbar is stretching and there's more space in it than before.\n\n\n    if (!wereItemsGrouped && this.groupedItems.length) {\n      // Ungroup items as long as none are overflowing or there are none to ungroup left.\n      while (this.groupedItems.length && !this._areItemsOverflowing) {\n        this._ungroupFirstItem();\n      } // If the ungrouping ended up with some item wrapping to the next row,\n      // put it back to the group toolbar (\"undo the last ungroup\"). We don't know whether\n      // an item will wrap or not until we ungroup it (that's a DOM/CSS thing) so this\n      // clean–up is vital for the algorithm.\n\n\n      if (this._areItemsOverflowing) {\n        this._groupLastItem();\n      }\n    }\n\n    if (this.groupedItems.length !== initialGroupedItemsCount) {\n      this.view.fire('groupedItemsUpdate');\n    }\n  }\n  /**\n   * Returns `true` when {@link module:ui/toolbar/toolbarview~ToolbarView#element} children visually overflow,\n   * for instance if the toolbar is narrower than its members. Returns `false` otherwise.\n   *\n   * @private\n   * @type {Boolean}\n   */\n\n\n  get _areItemsOverflowing() {\n    // An empty toolbar cannot overflow.\n    if (!this.ungroupedItems.length) {\n      return false;\n    }\n\n    const element = this.viewElement;\n    const uiLanguageDirection = this.viewLocale.uiLanguageDirection;\n    const lastChildRect = new Rect(element.lastChild);\n    const toolbarRect = new Rect(element);\n\n    if (!this.cachedPadding) {\n      const computedStyle = global.window.getComputedStyle(element);\n      const paddingProperty = uiLanguageDirection === 'ltr' ? 'paddingRight' : 'paddingLeft'; // parseInt() is essential because of quirky floating point numbers logic and DOM.\n      // If the padding turned out too big because of that, the grouped items dropdown would\n      // always look (from the Rect perspective) like it overflows (while it's not).\n\n      this.cachedPadding = Number.parseInt(computedStyle[paddingProperty]);\n    }\n\n    if (uiLanguageDirection === 'ltr') {\n      return lastChildRect.right > toolbarRect.right - this.cachedPadding;\n    } else {\n      return lastChildRect.left < toolbarRect.left + this.cachedPadding;\n    }\n  }\n  /**\n   * Enables the functionality that prevents {@link #ungroupedItems} from overflowing (wrapping to the next row)\n   * upon resize when there is little space available. Instead, the toolbar items are moved to the\n   * {@link #groupedItems} collection and displayed in a dropdown at the end of the row (which has its own nested toolbar).\n   *\n   * When called, the toolbar will automatically analyze the location of its {@link #ungroupedItems} and \"group\"\n   * them in the dropdown if necessary. It will also observe the browser window for size changes in\n   * the future and respond to them by grouping more items or reverting already grouped back, depending\n   * on the visual space available.\n   *\n   * @private\n   */\n\n\n  _enableGroupingOnResize() {\n    let previousWidth; // TODO: Consider debounce.\n\n    this.resizeObserver = new ResizeObserver(this.viewElement, entry => {\n      if (!previousWidth || previousWidth !== entry.contentRect.width || this.shouldUpdateGroupingOnNextResize) {\n        this.shouldUpdateGroupingOnNextResize = false;\n\n        this._updateGrouping();\n\n        previousWidth = entry.contentRect.width;\n      }\n    });\n\n    this._updateGrouping();\n  }\n  /**\n   * Enables the grouping functionality, just like {@link #_enableGroupingOnResize} but the difference is that\n   * it listens to the changes of {@link module:ui/toolbar/toolbarview~ToolbarView#maxWidth} instead.\n   *\n   * @private\n   */\n\n\n  _enableGroupingOnMaxWidthChange(view) {\n    view.on('change:maxWidth', () => {\n      this._updateGrouping();\n    });\n  }\n  /**\n   * When called, it will remove the last item from {@link #ungroupedItems} and move it back\n   * to the {@link #groupedItems} collection.\n   *\n   * The opposite of {@link #_ungroupFirstItem}.\n   *\n   * @private\n   */\n\n\n  _groupLastItem() {\n    if (!this.groupedItems.length) {\n      this.viewChildren.add(new ToolbarSeparatorView());\n      this.viewChildren.add(this.groupedItemsDropdown);\n      this.viewFocusTracker.add(this.groupedItemsDropdown.element);\n    }\n\n    this.groupedItems.add(this.ungroupedItems.remove(this.ungroupedItems.last), 0);\n  }\n  /**\n   * Moves the very first item belonging to {@link #groupedItems} back\n   * to the {@link #ungroupedItems} collection.\n   *\n   * The opposite of {@link #_groupLastItem}.\n   *\n   * @private\n   */\n\n\n  _ungroupFirstItem() {\n    this.ungroupedItems.add(this.groupedItems.remove(this.groupedItems.first));\n\n    if (!this.groupedItems.length) {\n      this.viewChildren.remove(this.groupedItemsDropdown);\n      this.viewChildren.remove(this.viewChildren.last);\n      this.viewFocusTracker.remove(this.groupedItemsDropdown.element);\n    }\n  }\n  /**\n   * Creates the {@link #groupedItemsDropdown} that hosts the members of the {@link #groupedItems}\n   * collection when there is not enough space in the toolbar to display all items in a single row.\n   *\n   * @private\n   * @returns {module:ui/dropdown/dropdownview~DropdownView}\n   */\n\n\n  _createGroupedItemsDropdown() {\n    const locale = this.viewLocale;\n    const t = locale.t;\n    const dropdown = createDropdown(locale);\n    dropdown.class = 'ck-toolbar__grouped-dropdown'; // Make sure the dropdown never sticks out to the left/right. It should be under the main toolbar.\n    // (https://github.com/ckeditor/ckeditor5/issues/5608)\n\n    dropdown.panelPosition = locale.uiLanguageDirection === 'ltr' ? 'sw' : 'se';\n    addToolbarToDropdown(dropdown, []);\n    dropdown.buttonView.set({\n      label: t('Show more items'),\n      tooltip: true,\n      tooltipPosition: locale.uiLanguageDirection === 'rtl' ? 'se' : 'sw',\n      icon: threeVerticalDots\n    }); // 1:1 pass–through binding.\n\n    dropdown.toolbarView.items.bindTo(this.groupedItems).using(item => item);\n    return dropdown;\n  }\n  /**\n   * Updates the {@link module:ui/toolbar/toolbarview~ToolbarView#focusables focus–cycleable items}\n   * collection so it represents the up–to–date state of the UI from the perspective of the user.\n   *\n   * For instance, the {@link #groupedItemsDropdown} can show up and hide but when it is visible,\n   * it must be subject to focus cycling in the toolbar.\n   *\n   * See the {@link module:ui/toolbar/toolbarview~ToolbarView#focusables collection} documentation\n   * to learn more about the purpose of this method.\n   *\n   * @private\n   */\n\n\n  _updateFocusCycleableItems() {\n    this.viewFocusables.clear();\n    this.ungroupedItems.map(item => {\n      this.viewFocusables.add(item);\n    });\n\n    if (this.groupedItems.length) {\n      this.viewFocusables.add(this.groupedItemsDropdown);\n    }\n  }\n\n}\n/**\n * Options passed to the {@link module:ui/toolbar/toolbarview~ToolbarView#constructor} of the toolbar.\n *\n * @interface module:ui/toolbar/toolbarview~ToolbarOptions\n */\n\n/**\n * When set to `true`, the toolbar will automatically group {@link module:ui/toolbar/toolbarview~ToolbarView#items} that\n * would normally wrap to the next line when there is not enough space to display them in a single row, for\n * instance, if the parent container of the toolbar is narrow. For toolbars in absolutely positioned containers\n * without width restrictions also the {@link module:ui/toolbar/toolbarview~ToolbarOptions#isFloating} option is required to be `true`.\n *\n * See also: {@link module:ui/toolbar/toolbarview~ToolbarView#maxWidth}.\n *\n * @member {Boolean} module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull\n */\n\n/**\n * This option should be enabled for toolbars in absolutely positioned containers without width restrictions\n * to enable automatic {@link module:ui/toolbar/toolbarview~ToolbarView#items} grouping.\n * When this option is set to `true`, the items will stop wrapping to the next line\n * and together with {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull},\n * this will allow grouping them when there is not enough space in a single row.\n *\n * @member {Boolean} module:ui/toolbar/toolbarview~ToolbarOptions#isFloating\n */\n\n/**\n * A class interface defining the behavior of the {@link module:ui/toolbar/toolbarview~ToolbarView}.\n *\n * Toolbar behaviors extend its look and functionality and have an impact on the\n * {@link module:ui/toolbar/toolbarview~ToolbarView#element} template or\n * {@link module:ui/toolbar/toolbarview~ToolbarView#render rendering}. They can be enabled\n * conditionally, e.g. depending on the configuration of the toolbar.\n *\n * @private\n * @interface module:ui/toolbar/toolbarview~ToolbarBehavior\n */\n\n/**\n * Creates a new toolbar behavior instance.\n *\n * The instance is created in the {@link module:ui/toolbar/toolbarview~ToolbarView#constructor} of the toolbar.\n * This is the right place to extend the {@link module:ui/toolbar/toolbarview~ToolbarView#template} of\n * the toolbar, define extra toolbar properties, etc.\n *\n * @method #constructor\n * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior is added to.\n */\n\n/**\n * A method called after the toolbar has been {@link module:ui/toolbar/toolbarview~ToolbarView#render rendered}.\n * It can be used to, for example, customize the behavior of the toolbar when its {@link module:ui/toolbar/toolbarview~ToolbarView#element}\n * is available.\n *\n * @readonly\n * @member {Function} #render\n * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar being rendered.\n */\n\n/**\n * A method called after the toolbar has been {@link module:ui/toolbar/toolbarview~ToolbarView#destroy destroyed}.\n * It allows cleaning up after the toolbar behavior, for instance, this is the right place to detach\n * event listeners, free up references, etc.\n *\n * @readonly\n * @member {Function} #destroy\n */","map":{"version":3,"sources":["D:/Project/nhap_mon_cnpm/my-app/node_modules/@ckeditor/ckeditor5-ui/src/toolbar/toolbarview.js"],"names":["View","FocusTracker","FocusCycler","KeystrokeHandler","ToolbarSeparatorView","ToolbarLineBreakView","ResizeObserver","preventDefault","Rect","global","createDropdown","addToolbarToDropdown","logWarning","normalizeToolbarConfig","threeVerticalDots","ToolbarView","constructor","locale","options","bind","bindTemplate","t","set","items","createCollection","focusTracker","keystrokes","itemsView","ItemsView","children","add","focusables","isRtl","uiLanguageDirection","_focusCycler","keystrokeHandler","actions","focusPrevious","focusNext","classes","to","if","shouldGroupWhenFull","isFloating","push","setTemplate","tag","attributes","class","role","style","maxWidth","on","mousedown","_behavior","DynamicGrouping","StaticLayout","render","item","element","evt","remove","listenTo","destroy","focus","focusFirst","focusLast","fillFromConfig","itemsOrConfig","factory","config","itemsToClean","filter","name","idx","removeItems","indexOf","has","itemsToAdd","_cleanSeparators","map","create","addMany","nonSeparatorPredicate","count","length","firstCommandItem","findIndex","lastCommandItem","slice","reverse","isDuplicated","view","bindTo","using","extendTemplate","viewChildren","viewFocusables","viewItemsView","viewFocusTracker","viewLocale","ungroupedItems","groupedItems","groupedItemsDropdown","_createGroupedItemsDropdown","resizeObserver","cachedPadding","shouldUpdateGroupingOnNextResize","_updateFocusCycleableItems","changeData","index","removedItem","removed","currentIndex","added","addedItem","_updateGrouping","viewElement","_enableGroupingOnResize","_enableGroupingOnMaxWidthChange","ownerDocument","body","contains","offsetParent","initialGroupedItemsCount","wereItemsGrouped","_areItemsOverflowing","_groupLastItem","_ungroupFirstItem","fire","lastChildRect","lastChild","toolbarRect","computedStyle","window","getComputedStyle","paddingProperty","Number","parseInt","right","left","previousWidth","entry","contentRect","width","last","first","dropdown","panelPosition","buttonView","label","tooltip","tooltipPosition","icon","toolbarView","clear"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module ui/toolbar/toolbarview\n */\n\nimport View from '../view';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport FocusCycler from '../focuscycler';\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\nimport ToolbarSeparatorView from './toolbarseparatorview';\nimport ToolbarLineBreakView from './toolbarlinebreakview';\nimport ResizeObserver from '@ckeditor/ckeditor5-utils/src/dom/resizeobserver';\nimport preventDefault from '../bindings/preventdefault.js';\nimport Rect from '@ckeditor/ckeditor5-utils/src/dom/rect';\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\nimport { createDropdown, addToolbarToDropdown } from '../dropdown/utils';\nimport { logWarning } from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport normalizeToolbarConfig from './normalizetoolbarconfig';\nimport threeVerticalDots from '@ckeditor/ckeditor5-core/theme/icons/three-vertical-dots.svg';\n\nimport '../../theme/components/toolbar/toolbar.css';\n\n/**\n * The toolbar view class.\n *\n * @extends module:ui/view~View\n * @implements module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable\n */\nexport default class ToolbarView extends View {\n\t/**\n\t * Creates an instance of the {@link module:ui/toolbar/toolbarview~ToolbarView} class.\n\t *\n\t * Also see {@link #render}.\n\t *\n\t * @param {module:utils/locale~Locale} locale The localization services instance.\n\t * @param {module:ui/toolbar/toolbarview~ToolbarOptions} [options] Configuration options of the toolbar.\n\t */\n\tconstructor( locale, options ) {\n\t\tsuper( locale );\n\n\t\tconst bind = this.bindTemplate;\n\t\tconst t = this.t;\n\n\t\t/**\n\t\t * A reference to the options object passed to the constructor.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ToolbarOptions}\n\t\t */\n\t\tthis.options = options || {};\n\n\t\t/**\n\t\t * Label used by assistive technologies to describe this toolbar element.\n\t\t *\n\t\t * @default 'Editor toolbar'\n\t\t * @member {String} #ariaLabel\n\t\t */\n\t\tthis.set( 'ariaLabel', t( 'Editor toolbar' ) );\n\n\t\t/**\n\t\t * The maximum width of the toolbar element.\n\t\t *\n\t\t * **Note**: When set to a specific value (e.g. `'200px'`), the value will affect the behavior of the\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull}\n\t\t * option by changing the number of {@link #items} that will be displayed in the toolbar at a time.\n\t\t *\n\t\t * @observable\n\t\t * @default 'auto'\n\t\t * @member {String} #maxWidth\n\t\t */\n\t\tthis.set( 'maxWidth', 'auto' );\n\n\t\t/**\n\t\t * A collection of toolbar items (buttons, dropdowns, etc.).\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.items = this.createCollection();\n\n\t\t/**\n\t\t * Tracks information about the DOM focus in the toolbar.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/focustracker~FocusTracker}\n\t\t */\n\t\tthis.focusTracker = new FocusTracker();\n\n\t\t/**\n\t\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}\n\t\t * to handle keyboard navigation in the toolbar.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\n\t\t */\n\t\tthis.keystrokes = new KeystrokeHandler();\n\n\t\t/**\n\t\t * An additional CSS class added to the {@link #element}.\n\t\t *\n\t\t * @observable\n\t\t * @member {String} #class\n\t\t */\n\t\tthis.set( 'class' );\n\n\t\t/**\n\t\t * When set true, makes the toolbar look compact with {@link #element}.\n\t\t *\n\t\t * @observable\n\t\t * @default false\n\t\t * @member {String} #isCompact\n\t\t */\n\t\tthis.set( 'isCompact', false );\n\n\t\t/**\n\t\t * A (child) view containing {@link #items toolbar items}.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ItemsView}\n\t\t */\n\t\tthis.itemsView = new ItemsView( locale );\n\n\t\t/**\n\t\t * A top–level collection aggregating building blocks of the toolbar.\n\t\t *\n\t\t *\t┌───────────────── ToolbarView ─────────────────┐\n\t\t *\t| ┌──────────────── #children ────────────────┐ |\n\t\t *\t| |   ┌──────────── #itemsView ───────────┐   | |\n\t\t *\t| |   | [ item1 ] [ item2 ] ... [ itemN ] |   | |\n\t\t *\t| |   └──────────────────────────────────-┘   | |\n\t\t *\t| └───────────────────────────────────────────┘ |\n\t\t *\t└───────────────────────────────────────────────┘\n\t\t *\n\t\t * By default, it contains the {@link #itemsView} but it can be extended with additional\n\t\t * UI elements when necessary.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.children = this.createCollection();\n\t\tthis.children.add( this.itemsView );\n\n\t\t/**\n\t\t * A collection of {@link #items} that take part in the focus cycling\n\t\t * (i.e. navigation using the keyboard). Usually, it contains a subset of {@link #items} with\n\t\t * some optional UI elements that also belong to the toolbar and should be focusable\n\t\t * by the user.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.focusables = this.createCollection();\n\n\t\t/**\n\t\t * Controls the orientation of toolbar items. Only available when\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull dynamic items grouping}\n\t\t * is **disabled**.\n\t\t *\n\t\t * @observable\n\t\t * @member {Boolean} #isVertical\n\t\t */\n\n\t\t/**\n\t\t * Helps cycling over {@link #focusables focusable items} in the toolbar.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {module:ui/focuscycler~FocusCycler}\n\t\t */\n\n\t\tconst isRtl = locale.uiLanguageDirection === 'rtl';\n\n\t\tthis._focusCycler = new FocusCycler( {\n\t\t\tfocusables: this.focusables,\n\t\t\tfocusTracker: this.focusTracker,\n\t\t\tkeystrokeHandler: this.keystrokes,\n\t\t\tactions: {\n\t\t\t\t// Navigate toolbar items backwards using the arrow[left,up] keys.\n\t\t\t\tfocusPrevious: [ isRtl ? 'arrowright' : 'arrowleft', 'arrowup' ],\n\n\t\t\t\t// Navigate toolbar items forwards using the arrow[right,down] keys.\n\t\t\t\tfocusNext: [ isRtl ? 'arrowleft' : 'arrowright', 'arrowdown' ]\n\t\t\t}\n\t\t} );\n\n\t\tconst classes = [\n\t\t\t'ck',\n\t\t\t'ck-toolbar',\n\t\t\tbind.to( 'class' ),\n\t\t\tbind.if( 'isCompact', 'ck-toolbar_compact' )\n\t\t];\n\n\t\tif ( this.options.shouldGroupWhenFull && this.options.isFloating ) {\n\t\t\tclasses.push( 'ck-toolbar_floating' );\n\t\t}\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'div',\n\t\t\tattributes: {\n\t\t\t\tclass: classes,\n\t\t\t\trole: 'toolbar',\n\t\t\t\t'aria-label': bind.to( 'ariaLabel' ),\n\t\t\t\tstyle: {\n\t\t\t\t\tmaxWidth: bind.to( 'maxWidth' )\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchildren: this.children,\n\n\t\t\ton: {\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-ui/issues/206\n\t\t\t\tmousedown: preventDefault( this )\n\t\t\t}\n\t\t} );\n\n\t\t/**\n\t\t * An instance of the active toolbar behavior that shapes its look and functionality.\n\t\t *\n\t\t * See {@link module:ui/toolbar/toolbarview~ToolbarBehavior} to learn more.\n\t\t *\n\t\t * @protected\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ToolbarBehavior}\n\t\t */\n\t\tthis._behavior = this.options.shouldGroupWhenFull ? new DynamicGrouping( this ) : new StaticLayout( this );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trender() {\n\t\tsuper.render();\n\n\t\t// Children added before rendering should be known to the #focusTracker.\n\t\tfor ( const item of this.items ) {\n\t\t\tthis.focusTracker.add( item.element );\n\t\t}\n\n\t\tthis.items.on( 'add', ( evt, item ) => {\n\t\t\tthis.focusTracker.add( item.element );\n\t\t} );\n\n\t\tthis.items.on( 'remove', ( evt, item ) => {\n\t\t\tthis.focusTracker.remove( item.element );\n\t\t} );\n\n\t\t// Start listening for the keystrokes coming from #element.\n\t\tthis.keystrokes.listenTo( this.element );\n\n\t\tthis._behavior.render( this );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {\n\t\tthis._behavior.destroy();\n\n\t\treturn super.destroy();\n\t}\n\n\t/**\n\t * Focuses the first focusable in {@link #focusables}.\n\t */\n\tfocus() {\n\t\tthis._focusCycler.focusFirst();\n\t}\n\n\t/**\n\t * Focuses the last focusable in {@link #focusables}.\n\t */\n\tfocusLast() {\n\t\tthis._focusCycler.focusLast();\n\t}\n\n\t/**\n\t * A utility that expands the plain toolbar configuration into\n\t * {@link module:ui/toolbar/toolbarview~ToolbarView#items} using a given component factory.\n\t *\n\t * @param {Array.<String>|Object} itemsOrConfig The toolbar items or the entire toolbar configuration object.\n\t * @param {module:ui/componentfactory~ComponentFactory} factory A factory producing toolbar items.\n\t */\n\tfillFromConfig( itemsOrConfig, factory ) {\n\t\tconst config = normalizeToolbarConfig( itemsOrConfig );\n\n\t\tconst itemsToClean = config.items\n\t\t\t.filter( ( name, idx, items ) => {\n\t\t\t\tif ( name === '|' ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Items listed in `config.removeItems` should not be added to the toolbar.\n\t\t\t\tif ( config.removeItems.indexOf( name ) !== -1 ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif ( name === '-' ) {\n\t\t\t\t\t// The toolbar line breaks must not be rendered when toolbar grouping is enabled.\n\t\t\t\t\t// (https://github.com/ckeditor/ckeditor5/issues/8582)\n\t\t\t\t\tif ( this.options.shouldGroupWhenFull ) {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * The toolbar multiline breaks (`-` items) only work when the automatic button grouping\n\t\t\t\t\t\t * is disabled in the toolbar configuration.\n\t\t\t\t\t\t * To do this, set the `shouldNotGroupWhenFull` option to `true` in the editor configuration:\n\t\t\t\t\t\t *\n\t\t\t\t\t\t *\t\tconst config = {\n\t\t\t\t\t\t *\t\t\ttoolbar: {\n\t\t\t\t\t\t *\t\t\t\titems: [ ... ],\n\t\t\t\t\t\t *\t\t\t\tshouldNotGroupWhenFull: true\n\t\t\t\t\t\t *\t\t\t}\n\t\t\t\t\t\t *\t\t}\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * Learn more about {@link module:core/editor/editorconfig~EditorConfig#toolbar toolbar configuration}.\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @error toolbarview-line-break-ignored-when-grouping-items\n\t\t\t\t\t\t */\n\t\t\t\t\t\tlogWarning( 'toolbarview-line-break-ignored-when-grouping-items', items );\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// For the items that cannot be instantiated we are sending warning message. We also filter them out.\n\t\t\t\tif ( !factory.has( name ) ) {\n\t\t\t\t\t/**\n\t\t\t\t\t * There was a problem processing the configuration of the toolbar. The item with the given\n\t\t\t\t\t * name does not exist so it was omitted when rendering the toolbar.\n\t\t\t\t\t *\n\t\t\t\t\t * This warning usually shows up when the {@link module:core/plugin~Plugin} which is supposed\n\t\t\t\t\t * to provide a toolbar item has not been loaded or there is a typo in the configuration.\n\t\t\t\t\t *\n\t\t\t\t\t * Make sure the plugin responsible for this toolbar item is loaded and the toolbar configuration\n\t\t\t\t\t * is correct, e.g. {@link module:basic-styles/bold~Bold} is loaded for the `'bold'` toolbar item.\n\t\t\t\t\t *\n\t\t\t\t\t * You can use the following snippet to retrieve all available toolbar items:\n\t\t\t\t\t *\n\t\t\t\t\t *\t\tArray.from( editor.ui.componentFactory.names() );\n\t\t\t\t\t *\n\t\t\t\t\t * @error toolbarview-item-unavailable\n\t\t\t\t\t * @param {String} name The name of the component.\n\t\t\t\t\t */\n\t\t\t\t\tlogWarning( 'toolbarview-item-unavailable', { name } );\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t} );\n\n\t\tconst itemsToAdd = this._cleanSeparators( itemsToClean )\n\t\t\t// Instantiate toolbar items.\n\t\t\t.map( name => {\n\t\t\t\tif ( name === '|' ) {\n\t\t\t\t\treturn new ToolbarSeparatorView();\n\t\t\t\t} else if ( name === '-' ) {\n\t\t\t\t\treturn new ToolbarLineBreakView();\n\t\t\t\t}\n\n\t\t\t\treturn factory.create( name );\n\t\t\t} );\n\n\t\tthis.items.addMany( itemsToAdd );\n\t}\n\n\t/**\n\t * Remove leading, trailing, and duplicated separators (`-` and `|`).\n\t *\n\t * @private\n\t * @param {Array.<String>} items\n\t */\n\t_cleanSeparators( items ) {\n\t\tconst nonSeparatorPredicate = item => ( item !== '-' && item !== '|' );\n\t\tconst count = items.length;\n\n\t\t// Find an index of the first item that is not a separator.\n\t\tconst firstCommandItem = items.findIndex( nonSeparatorPredicate );\n\n\t\t// Search from the end of the list, then convert found index back to the original direction.\n\t\tconst lastCommandItem = count - items\n\t\t\t.slice()\n\t\t\t.reverse()\n\t\t\t.findIndex( nonSeparatorPredicate );\n\n\t\treturn items\n\t\t\t// Return items without the leading and trailing separators.\n\t\t\t.slice( firstCommandItem, lastCommandItem )\n\t\t\t// Remove duplicated separators.\n\t\t\t.filter( ( name, idx, items ) => {\n\t\t\t\t// Filter only separators.\n\t\t\t\tif ( nonSeparatorPredicate( name ) ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tconst isDuplicated = idx > 0 && items[ idx - 1 ] === name;\n\n\t\t\t\treturn !isDuplicated;\n\t\t\t} );\n\t}\n\n\t/**\n\t * Fired when some toolbar {@link #items} were grouped or ungrouped as a result of some change\n\t * in the toolbar geometry.\n\t *\n\t * **Note**: This event is always fired **once** regardless of the number of items that were be\n\t * grouped or ungrouped at a time.\n\t *\n\t * **Note**: This event is fired only if the items grouping functionality was enabled in\n\t * the first place (see {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull}).\n\t *\n\t * @event groupedItemsUpdate\n\t */\n}\n\n/**\n * An inner block of the {@link module:ui/toolbar/toolbarview~ToolbarView} hosting its\n * {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n *\n * @private\n * @extends module:ui/view~View\n */\nclass ItemsView extends View {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( locale ) {\n\t\tsuper( locale );\n\n\t\t/**\n\t\t * A collection of items (buttons, dropdowns, etc.).\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.children = this.createCollection();\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'div',\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck',\n\t\t\t\t\t'ck-toolbar__items'\n\t\t\t\t]\n\t\t\t},\n\t\t\tchildren: this.children\n\t\t} );\n\t}\n}\n\n/**\n * A toolbar behavior that makes it static and unresponsive to the changes of the environment.\n * At the same time, it also makes it possible to display a toolbar with a vertical layout\n * using the {@link module:ui/toolbar/toolbarview~ToolbarView#isVertical} property.\n *\n * @private\n * @implements module:ui/toolbar/toolbarview~ToolbarBehavior\n */\nclass StaticLayout {\n\t/**\n\t * Creates an instance of the {@link module:ui/toolbar/toolbarview~StaticLayout} toolbar\n\t * behavior.\n\t *\n\t * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n\t * is added to.\n\t */\n\tconstructor( view ) {\n\t\tconst bind = view.bindTemplate;\n\n\t\t// Static toolbar can be vertical when needed.\n\t\tview.set( 'isVertical', false );\n\n\t\t// 1:1 pass–through binding, all ToolbarView#items are visible.\n\t\tview.itemsView.children.bindTo( view.items ).using( item => item );\n\n\t\t// 1:1 pass–through binding, all ToolbarView#items are focusable.\n\t\tview.focusables.bindTo( view.items ).using( item => item );\n\n\t\tview.extendTemplate( {\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t// When vertical, the toolbar has an additional CSS class.\n\t\t\t\t\tbind.if( 'isVertical', 'ck-toolbar_vertical' )\n\t\t\t\t]\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trender() {}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {}\n}\n\n/**\n * A toolbar behavior that makes the items respond to changes in the geometry.\n *\n * In a nutshell, it groups {@link module:ui/toolbar/toolbarview~ToolbarView#items}\n * that do not fit visually into a single row of the toolbar (due to limited space).\n * Items that do not fit are aggregated in a dropdown displayed at the end of the toolbar.\n *\n *\t┌──────────────────────────────────────── ToolbarView ──────────────────────────────────────────┐\n *\t| ┌─────────────────────────────────────── #children ─────────────────────────────────────────┐ |\n *\t| |   ┌─────── #itemsView ────────┐ ┌──────────────────────┐ ┌── #groupedItemsDropdown ───┐   | |\n *\t| |   |       #ungroupedItems     | | ToolbarSeparatorView | |        #groupedItems       |   | |\n *\t| |   └──────────────────────────-┘ └──────────────────────┘ └────────────────────────────┘   | |\n *\t| |                                  \\---------- only when toolbar items overflow --------/    | |\n *\t| └───────────────────────────────────────────────────────────────────────────────────────────┘ |\n *\t└───────────────────────────────────────────────────────────────────────────────────────────────┘\n *\n * @private\n * @implements module:ui/toolbar/toolbarview~ToolbarBehavior\n */\nclass DynamicGrouping {\n\t/**\n\t * Creates an instance of the {@link module:ui/toolbar/toolbarview~DynamicGrouping} toolbar\n\t * behavior.\n\t *\n\t * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n\t * is added to.\n\t */\n\tconstructor( view ) {\n\t\t/**\n\t\t * A toolbar view this behavior belongs to.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar~ToolbarView}\n\t\t */\n\t\tthis.view = view;\n\n\t\t/**\n\t\t * A collection of toolbar children.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.viewChildren = view.children;\n\n\t\t/**\n\t\t * A collection of focusable toolbar elements.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.viewFocusables = view.focusables;\n\n\t\t/**\n\t\t * A view containing toolbar items.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ItemsView}\n\t\t */\n\t\tthis.viewItemsView = view.itemsView;\n\n\t\t/**\n\t\t * Toolbar focus tracker.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/focustracker~FocusTracker}\n\t\t */\n\t\tthis.viewFocusTracker = view.focusTracker;\n\n\t\t/**\n\t\t * Toolbar locale.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/locale~Locale}\n\t\t */\n\t\tthis.viewLocale = view.locale;\n\n\t\t/**\n\t\t * Toolbar element.\n\t\t *\n\t\t * @readonly\n\t\t * @member {HTMLElement} #viewElement\n\t\t */\n\n\t\t/**\n\t\t * A subset of toolbar {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n\t\t * Aggregates items that fit into a single row of the toolbar and were not {@link #groupedItems grouped}\n\t\t * into a {@link #groupedItemsDropdown dropdown}. Items of this collection are displayed in the\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarView#itemsView}.\n\t\t *\n\t\t * When none of the {@link module:ui/toolbar/toolbarview~ToolbarView#items} were grouped, it\n\t\t * matches the {@link module:ui/toolbar/toolbarview~ToolbarView#items} collection in size and order.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.ungroupedItems = view.createCollection();\n\n\t\t/**\n\t\t * A subset of toolbar {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n\t\t * A collection of the toolbar items that do not fit into a single row of the toolbar.\n\t\t * Grouped items are displayed in a dedicated {@link #groupedItemsDropdown dropdown}.\n\t\t *\n\t\t * When none of the {@link module:ui/toolbar/toolbarview~ToolbarView#items} were grouped,\n\t\t * this collection is empty.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.groupedItems = view.createCollection();\n\n\t\t/**\n\t\t * The dropdown that aggregates {@link #groupedItems grouped items} that do not fit into a single\n\t\t * row of the toolbar. It is displayed on demand as the last of\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarView#children toolbar children} and offers another\n\t\t * (nested) toolbar which displays items that would normally overflow.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/dropdown/dropdownview~DropdownView}\n\t\t */\n\t\tthis.groupedItemsDropdown = this._createGroupedItemsDropdown();\n\n\t\t/**\n\t\t * An instance of the resize observer that helps dynamically determine the geometry of the toolbar\n\t\t * and manage items that do not fit into a single row.\n\t\t *\n\t\t * **Note:** Created in {@link #_enableGroupingOnResize}.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/dom/resizeobserver~ResizeObserver}\n\t\t */\n\t\tthis.resizeObserver = null;\n\n\t\t/**\n\t\t * A cached value of the horizontal padding style used by {@link #_updateGrouping}\n\t\t * to manage the {@link module:ui/toolbar/toolbarview~ToolbarView#items} that do not fit into\n\t\t * a single toolbar line. This value can be reused between updates because it is unlikely that\n\t\t * the padding will change and re–using `Window.getComputedStyle()` is expensive.\n\t\t *\n\t\t * @readonly\n\t\t * @member {Number}\n\t\t */\n\t\tthis.cachedPadding = null;\n\n\t\t/**\n\t\t * A flag indicating that an items grouping update has been queued (e.g. due to the toolbar being visible)\n\t\t * and should be executed immediately the next time the toolbar shows up.\n\t\t *\n\t\t * @readonly\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis.shouldUpdateGroupingOnNextResize = false;\n\n\t\t// Only those items that were not grouped are visible to the user.\n\t\tview.itemsView.children.bindTo( this.ungroupedItems ).using( item => item );\n\n\t\t// Make sure all #items visible in the main space of the toolbar are \"focuscycleable\".\n\t\tthis.ungroupedItems.on( 'add', this._updateFocusCycleableItems.bind( this ) );\n\t\tthis.ungroupedItems.on( 'remove', this._updateFocusCycleableItems.bind( this ) );\n\n\t\t// Make sure the #groupedItemsDropdown is also included in cycling when it appears.\n\t\tview.children.on( 'add', this._updateFocusCycleableItems.bind( this ) );\n\t\tview.children.on( 'remove', this._updateFocusCycleableItems.bind( this ) );\n\n\t\t// ToolbarView#items is dynamic. When an item is added or removed, it should be automatically\n\t\t// represented in either grouped or ungrouped items at the right index.\n\t\t// In other words #items == concat( #ungroupedItems, #groupedItems )\n\t\t// (in length and order).\n\t\tview.items.on( 'change', ( evt, changeData ) => {\n\t\t\tconst index = changeData.index;\n\n\t\t\t// Removing.\n\t\t\tfor ( const removedItem of changeData.removed ) {\n\t\t\t\tif ( index >= this.ungroupedItems.length ) {\n\t\t\t\t\tthis.groupedItems.remove( removedItem );\n\t\t\t\t} else {\n\t\t\t\t\tthis.ungroupedItems.remove( removedItem );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Adding.\n\t\t\tfor ( let currentIndex = index; currentIndex < index + changeData.added.length; currentIndex++ ) {\n\t\t\t\tconst addedItem = changeData.added[ currentIndex - index ];\n\n\t\t\t\tif ( currentIndex > this.ungroupedItems.length ) {\n\t\t\t\t\tthis.groupedItems.add( addedItem, currentIndex - this.ungroupedItems.length );\n\t\t\t\t} else {\n\t\t\t\t\tthis.ungroupedItems.add( addedItem, currentIndex );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// When new ungrouped items join in and land in #ungroupedItems, there's a chance it causes\n\t\t\t// the toolbar to overflow.\n\t\t\t// Consequently if removed from grouped or ungrouped items, there is a chance\n\t\t\t// some new space is available and we could do some ungrouping.\n\t\t\tthis._updateGrouping();\n\t\t} );\n\n\t\tview.extendTemplate( {\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t// To group items dynamically, the toolbar needs a dedicated CSS class.\n\t\t\t\t\t'ck-toolbar_grouping'\n\t\t\t\t]\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Enables dynamic items grouping based on the dimensions of the toolbar.\n\t *\n\t * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n\t * is added to.\n\t */\n\trender( view ) {\n\t\tthis.viewElement = view.element;\n\n\t\tthis._enableGroupingOnResize();\n\t\tthis._enableGroupingOnMaxWidthChange( view );\n\t}\n\n\t/**\n\t * Cleans up the internals used by this behavior.\n\t */\n\tdestroy() {\n\t\t// The dropdown may not be in ToolbarView#children at the moment of toolbar destruction\n\t\t// so let's make sure it's actually destroyed along with the toolbar.\n\t\tthis.groupedItemsDropdown.destroy();\n\n\t\tthis.resizeObserver.destroy();\n\t}\n\n\t/**\n\t * When called, it will check if any of the {@link #ungroupedItems} do not fit into a single row of the toolbar,\n\t * and it will move them to the {@link #groupedItems} when it happens.\n\t *\n\t * At the same time, it will also check if there is enough space in the toolbar for the first of the\n\t * {@link #groupedItems} to be returned back to {@link #ungroupedItems} and still fit into a single row\n\t * without the toolbar wrapping.\n\t *\n\t * @protected\n\t */\n\t_updateGrouping() {\n\t\t// Do no grouping–related geometry analysis when the toolbar is detached from visible DOM,\n\t\t// for instance before #render(), or after render but without a parent or a parent detached\n\t\t// from DOM. DOMRects won't work anyway and there will be tons of warning in the console and\n\t\t// nothing else. This happens, for instance, when the toolbar is detached from DOM and\n\t\t// some logic adds or removes its #items.\n\t\tif ( !this.viewElement.ownerDocument.body.contains( this.viewElement ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Do not update grouping when the element is invisible. Such toolbar has DOMRect filled with zeros\n\t\t// and that would cause all items to be grouped. Instead, queue the grouping so it runs next time\n\t\t// the toolbar is visible (the next ResizeObserver callback execution). This is handy because\n\t\t// the grouping could be caused by increasing the #maxWidth when the toolbar was invisible and the next\n\t\t// time it shows up, some items could actually be ungrouped (https://github.com/ckeditor/ckeditor5/issues/6575).\n\t\tif ( !this.viewElement.offsetParent ) {\n\t\t\tthis.shouldUpdateGroupingOnNextResize = true;\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Remember how many items were initially grouped so at the it is possible to figure out if the number\n\t\t// of grouped items has changed. If the number has changed, geometry of the toolbar has also changed.\n\t\tconst initialGroupedItemsCount = this.groupedItems.length;\n\t\tlet wereItemsGrouped;\n\n\t\t// Group #items as long as some wrap to the next row. This will happen, for instance,\n\t\t// when the toolbar is getting narrow and there is not enough space to display all items in\n\t\t// a single row.\n\t\twhile ( this._areItemsOverflowing ) {\n\t\t\tthis._groupLastItem();\n\n\t\t\twereItemsGrouped = true;\n\t\t}\n\n\t\t// If none were grouped now but there were some items already grouped before,\n\t\t// then, what the hell, maybe let's see if some of them can be ungrouped. This happens when,\n\t\t// for instance, the toolbar is stretching and there's more space in it than before.\n\t\tif ( !wereItemsGrouped && this.groupedItems.length ) {\n\t\t\t// Ungroup items as long as none are overflowing or there are none to ungroup left.\n\t\t\twhile ( this.groupedItems.length && !this._areItemsOverflowing ) {\n\t\t\t\tthis._ungroupFirstItem();\n\t\t\t}\n\n\t\t\t// If the ungrouping ended up with some item wrapping to the next row,\n\t\t\t// put it back to the group toolbar (\"undo the last ungroup\"). We don't know whether\n\t\t\t// an item will wrap or not until we ungroup it (that's a DOM/CSS thing) so this\n\t\t\t// clean–up is vital for the algorithm.\n\t\t\tif ( this._areItemsOverflowing ) {\n\t\t\t\tthis._groupLastItem();\n\t\t\t}\n\t\t}\n\n\t\tif ( this.groupedItems.length !== initialGroupedItemsCount ) {\n\t\t\tthis.view.fire( 'groupedItemsUpdate' );\n\t\t}\n\t}\n\n\t/**\n\t * Returns `true` when {@link module:ui/toolbar/toolbarview~ToolbarView#element} children visually overflow,\n\t * for instance if the toolbar is narrower than its members. Returns `false` otherwise.\n\t *\n\t * @private\n\t * @type {Boolean}\n\t */\n\tget _areItemsOverflowing() {\n\t\t// An empty toolbar cannot overflow.\n\t\tif ( !this.ungroupedItems.length ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst element = this.viewElement;\n\t\tconst uiLanguageDirection = this.viewLocale.uiLanguageDirection;\n\t\tconst lastChildRect = new Rect( element.lastChild );\n\t\tconst toolbarRect = new Rect( element );\n\n\t\tif ( !this.cachedPadding ) {\n\t\t\tconst computedStyle = global.window.getComputedStyle( element );\n\t\t\tconst paddingProperty = uiLanguageDirection === 'ltr' ? 'paddingRight' : 'paddingLeft';\n\n\t\t\t// parseInt() is essential because of quirky floating point numbers logic and DOM.\n\t\t\t// If the padding turned out too big because of that, the grouped items dropdown would\n\t\t\t// always look (from the Rect perspective) like it overflows (while it's not).\n\t\t\tthis.cachedPadding = Number.parseInt( computedStyle[ paddingProperty ] );\n\t\t}\n\n\t\tif ( uiLanguageDirection === 'ltr' ) {\n\t\t\treturn lastChildRect.right > toolbarRect.right - this.cachedPadding;\n\t\t} else {\n\t\t\treturn lastChildRect.left < toolbarRect.left + this.cachedPadding;\n\t\t}\n\t}\n\n\t/**\n\t * Enables the functionality that prevents {@link #ungroupedItems} from overflowing (wrapping to the next row)\n\t * upon resize when there is little space available. Instead, the toolbar items are moved to the\n\t * {@link #groupedItems} collection and displayed in a dropdown at the end of the row (which has its own nested toolbar).\n\t *\n\t * When called, the toolbar will automatically analyze the location of its {@link #ungroupedItems} and \"group\"\n\t * them in the dropdown if necessary. It will also observe the browser window for size changes in\n\t * the future and respond to them by grouping more items or reverting already grouped back, depending\n\t * on the visual space available.\n\t *\n\t * @private\n\t */\n\t_enableGroupingOnResize() {\n\t\tlet previousWidth;\n\n\t\t// TODO: Consider debounce.\n\t\tthis.resizeObserver = new ResizeObserver( this.viewElement, entry => {\n\t\t\tif ( !previousWidth || previousWidth !== entry.contentRect.width || this.shouldUpdateGroupingOnNextResize ) {\n\t\t\t\tthis.shouldUpdateGroupingOnNextResize = false;\n\n\t\t\t\tthis._updateGrouping();\n\n\t\t\t\tpreviousWidth = entry.contentRect.width;\n\t\t\t}\n\t\t} );\n\n\t\tthis._updateGrouping();\n\t}\n\n\t/**\n\t * Enables the grouping functionality, just like {@link #_enableGroupingOnResize} but the difference is that\n\t * it listens to the changes of {@link module:ui/toolbar/toolbarview~ToolbarView#maxWidth} instead.\n\t *\n\t * @private\n\t */\n\t_enableGroupingOnMaxWidthChange( view ) {\n\t\tview.on( 'change:maxWidth', () => {\n\t\t\tthis._updateGrouping();\n\t\t} );\n\t}\n\n\t/**\n\t * When called, it will remove the last item from {@link #ungroupedItems} and move it back\n\t * to the {@link #groupedItems} collection.\n\t *\n\t * The opposite of {@link #_ungroupFirstItem}.\n\t *\n\t * @private\n\t */\n\t_groupLastItem() {\n\t\tif ( !this.groupedItems.length ) {\n\t\t\tthis.viewChildren.add( new ToolbarSeparatorView() );\n\t\t\tthis.viewChildren.add( this.groupedItemsDropdown );\n\t\t\tthis.viewFocusTracker.add( this.groupedItemsDropdown.element );\n\t\t}\n\n\t\tthis.groupedItems.add( this.ungroupedItems.remove( this.ungroupedItems.last ), 0 );\n\t}\n\n\t/**\n\t * Moves the very first item belonging to {@link #groupedItems} back\n\t * to the {@link #ungroupedItems} collection.\n\t *\n\t * The opposite of {@link #_groupLastItem}.\n\t *\n\t * @private\n\t */\n\t_ungroupFirstItem() {\n\t\tthis.ungroupedItems.add( this.groupedItems.remove( this.groupedItems.first ) );\n\n\t\tif ( !this.groupedItems.length ) {\n\t\t\tthis.viewChildren.remove( this.groupedItemsDropdown );\n\t\t\tthis.viewChildren.remove( this.viewChildren.last );\n\t\t\tthis.viewFocusTracker.remove( this.groupedItemsDropdown.element );\n\t\t}\n\t}\n\n\t/**\n\t * Creates the {@link #groupedItemsDropdown} that hosts the members of the {@link #groupedItems}\n\t * collection when there is not enough space in the toolbar to display all items in a single row.\n\t *\n\t * @private\n\t * @returns {module:ui/dropdown/dropdownview~DropdownView}\n\t */\n\t_createGroupedItemsDropdown() {\n\t\tconst locale = this.viewLocale;\n\t\tconst t = locale.t;\n\t\tconst dropdown = createDropdown( locale );\n\n\t\tdropdown.class = 'ck-toolbar__grouped-dropdown';\n\n\t\t// Make sure the dropdown never sticks out to the left/right. It should be under the main toolbar.\n\t\t// (https://github.com/ckeditor/ckeditor5/issues/5608)\n\t\tdropdown.panelPosition = locale.uiLanguageDirection === 'ltr' ? 'sw' : 'se';\n\n\t\taddToolbarToDropdown( dropdown, [] );\n\n\t\tdropdown.buttonView.set( {\n\t\t\tlabel: t( 'Show more items' ),\n\t\t\ttooltip: true,\n\t\t\ttooltipPosition: locale.uiLanguageDirection === 'rtl' ? 'se' : 'sw',\n\t\t\ticon: threeVerticalDots\n\t\t} );\n\n\t\t// 1:1 pass–through binding.\n\t\tdropdown.toolbarView.items.bindTo( this.groupedItems ).using( item => item );\n\n\t\treturn dropdown;\n\t}\n\n\t/**\n\t * Updates the {@link module:ui/toolbar/toolbarview~ToolbarView#focusables focus–cycleable items}\n\t * collection so it represents the up–to–date state of the UI from the perspective of the user.\n\t *\n\t * For instance, the {@link #groupedItemsDropdown} can show up and hide but when it is visible,\n\t * it must be subject to focus cycling in the toolbar.\n\t *\n\t * See the {@link module:ui/toolbar/toolbarview~ToolbarView#focusables collection} documentation\n\t * to learn more about the purpose of this method.\n\t *\n\t * @private\n\t */\n\t_updateFocusCycleableItems() {\n\t\tthis.viewFocusables.clear();\n\n\t\tthis.ungroupedItems.map( item => {\n\t\t\tthis.viewFocusables.add( item );\n\t\t} );\n\n\t\tif ( this.groupedItems.length ) {\n\t\t\tthis.viewFocusables.add( this.groupedItemsDropdown );\n\t\t}\n\t}\n}\n\n/**\n * Options passed to the {@link module:ui/toolbar/toolbarview~ToolbarView#constructor} of the toolbar.\n *\n * @interface module:ui/toolbar/toolbarview~ToolbarOptions\n */\n\n/**\n * When set to `true`, the toolbar will automatically group {@link module:ui/toolbar/toolbarview~ToolbarView#items} that\n * would normally wrap to the next line when there is not enough space to display them in a single row, for\n * instance, if the parent container of the toolbar is narrow. For toolbars in absolutely positioned containers\n * without width restrictions also the {@link module:ui/toolbar/toolbarview~ToolbarOptions#isFloating} option is required to be `true`.\n *\n * See also: {@link module:ui/toolbar/toolbarview~ToolbarView#maxWidth}.\n *\n * @member {Boolean} module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull\n */\n\n/**\n * This option should be enabled for toolbars in absolutely positioned containers without width restrictions\n * to enable automatic {@link module:ui/toolbar/toolbarview~ToolbarView#items} grouping.\n * When this option is set to `true`, the items will stop wrapping to the next line\n * and together with {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull},\n * this will allow grouping them when there is not enough space in a single row.\n *\n * @member {Boolean} module:ui/toolbar/toolbarview~ToolbarOptions#isFloating\n */\n\n/**\n * A class interface defining the behavior of the {@link module:ui/toolbar/toolbarview~ToolbarView}.\n *\n * Toolbar behaviors extend its look and functionality and have an impact on the\n * {@link module:ui/toolbar/toolbarview~ToolbarView#element} template or\n * {@link module:ui/toolbar/toolbarview~ToolbarView#render rendering}. They can be enabled\n * conditionally, e.g. depending on the configuration of the toolbar.\n *\n * @private\n * @interface module:ui/toolbar/toolbarview~ToolbarBehavior\n */\n\n/**\n * Creates a new toolbar behavior instance.\n *\n * The instance is created in the {@link module:ui/toolbar/toolbarview~ToolbarView#constructor} of the toolbar.\n * This is the right place to extend the {@link module:ui/toolbar/toolbarview~ToolbarView#template} of\n * the toolbar, define extra toolbar properties, etc.\n *\n * @method #constructor\n * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior is added to.\n */\n\n/**\n * A method called after the toolbar has been {@link module:ui/toolbar/toolbarview~ToolbarView#render rendered}.\n * It can be used to, for example, customize the behavior of the toolbar when its {@link module:ui/toolbar/toolbarview~ToolbarView#element}\n * is available.\n *\n * @readonly\n * @member {Function} #render\n * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar being rendered.\n */\n\n/**\n * A method called after the toolbar has been {@link module:ui/toolbar/toolbarview~ToolbarView#destroy destroyed}.\n * It allows cleaning up after the toolbar behavior, for instance, this is the right place to detach\n * event listeners, free up references, etc.\n *\n * @readonly\n * @member {Function} #destroy\n */\n"]},"metadata":{},"sourceType":"module"}